{"version":3,"file":"static/js/89.6c4bf26b.chunk.js","mappings":"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","sources":["app/models/reserved-fields.constant.ts","app/models/project/project.declarations.ts","app/libs/tools/date-tools.class.ts","app/models/project/syncing/project-comparator.ts","app/workers/comparator.worker.ts","../webpack/bootstrap","../webpack/runtime/chunk loaded","../webpack/runtime/define property getters","../webpack/runtime/ensure chunk","../webpack/runtime/get javascript chunk filename","../webpack/runtime/get mini-css chunk filename","../webpack/runtime/global","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/publicPath","../webpack/runtime/importScripts chunk loading","../webpack/runtime/startup chunk dependencies","../webpack/startup"],"sourcesContent":["/**\n * Defines the fields name that are reserved for the functioning of Anita.\n * These fields names cannot be assigned as the value of the `fieldName` of sections' fields.\n */\nexport enum RESERVED_FIELDS {\n  id = 'id',\n  createdAt = 'createdAt',\n  parentsInfo = 'parentsInfo',\n  updatedAt = 'updatedAt',\n  createdBy = 'createdBy'\n}\n","import { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum'\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model'\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api'\nimport { ISection } from 'app/models/section/section.declarations'\nimport { ISectionElement } from 'app/models/section-element/section-element.declarations'\nimport { RESERVED_FIELDS } from 'app/models/reserved-fields.constant'\n\n/**\n * Reserved keys are needed to store system required properties.\n *\n * @remarks\n * Users can still pick any of these as section names as sections are stored using their system-generated `id` as key.\n */\nexport enum RESERVED_AUDS_KEYS {\n  _settings = '_settings',\n  _sections = '_sections'\n}\n\n/**\n * Data structure of Anita, composed of both SystemData and UserData.\n */\nexport type TAnitaUniversalDataStorage = TSystemData & UserData;\n\n/**\n * Store for system required properties. Includes general settings and Sections declarations. The reserved keys define system required properties.\n */\nexport type TSystemData = {\n  [RESERVED_AUDS_KEYS._settings]: Array<IProjectSettings>\n  [RESERVED_AUDS_KEYS._sections]: Array<ISection>\n};\n\n/**\n * Sections' data, stored in a Object, where the key is the section `id` and the value is a `Array<SectionElement>`.\n */\nexport type UserData = {\n  [sectionId: string]: Array<ISectionElement>\n};\n\n/**\n * Defines the structure of the general information on a project.\n */\nexport interface IProjectSettings {\n  id: string\n  title: string\n  description: string\n  [RESERVED_FIELDS.createdAt]: string\n  [RESERVED_FIELDS.updatedAt]?: string\n  localStorage?: LOCAL_STORAGE_SYSTEMS\n  encrypted?: boolean\n  cloudSync?: {\n    dropbox?: string\n  }\n}\n\nexport interface AdditionalInfoForLocalStorage {\n  fileHandle?: FileSystemFileHandle\n  dexieInfoForUpgrade?: {\n    previousVersions: Array<Array<string>>\n    DS: AbstractModel\n  }\n}\n\n/**\n * Info on Projects saved locally to know what project are on the device.\n *\n * @property [fileHandle] - The file handle of the project file (only if the project is saved on the file system)\n * @property [sections] - The sections of the project to load the IndexedDB database with Dexie\n */\nexport interface LocalProjectSettings extends IProjectSettings, AdditionalInfoForLocalStorage {\n}\n","export class DateTools {\n  public static getUtcIsoString (date: Date = new Date()): string {\n    return new Date(date.toUTCString()).toISOString()\n  }\n\n  public static areEqual (date1: Date | string | undefined, date2: Date | string | undefined): boolean {\n    const d1 = new Date(date1 || 0)\n    const d2 = new Date(date2 || 0)\n    return d1.getTime() === d2.getTime()\n  }\n\n  public static firstIsAfterSecond (date1: Date | string | undefined, date2: Date | string | undefined): boolean {\n    const d1 = new Date(date1 || 0)\n    const d2 = new Date(date2 || 0)\n    return d1.getTime() > d2.getTime()\n  }\n}\n","import { DateTools } from 'app/libs/tools/date-tools.class'\nimport { RESERVED_AUDS_KEYS, TAnitaUniversalDataStorage } from 'app/models/project/project.declarations'\nimport { RESERVED_FIELDS } from 'app/models/reserved-fields.constant'\nimport { ISectionElement } from 'app/models/section-element/section-element.declarations'\n\nexport interface IComparisonResult {\n  remote: IElesForScope\n  remoteData: TAnitaUniversalDataStorage\n  local: IElesForScope\n  localData: TAnitaUniversalDataStorage\n}\n\ninterface IElesForScope {\n  delete: Partial<TAnitaUniversalDataStorage>\n  insert: Partial<TAnitaUniversalDataStorage>\n  update: Partial<TAnitaUniversalDataStorage>\n}\n\nexport class Comparator {\n  private static nonDeletableSections = Object.values(RESERVED_AUDS_KEYS)\n  private delta: IComparisonResult = {\n    remote: {\n      delete: {},\n      insert: {},\n      update: {}\n    },\n    remoteData: {} as TAnitaUniversalDataStorage,\n    local: {\n      delete: {},\n      insert: {},\n      update: {}\n    },\n    localData: {} as TAnitaUniversalDataStorage\n  }\n\n  private localElementsMerged: { [key: keyof TAnitaUniversalDataStorage]: Array<string> } = {}\n\n  constructor (\n    private lastSync: string | undefined,\n    private localData: TAnitaUniversalDataStorage,\n    private remoteData: TAnitaUniversalDataStorage\n  ) { }\n\n  public compare (): IComparisonResult {\n    if (!this.remoteData) {\n      this.remoteData = {} as TAnitaUniversalDataStorage\n    }\n    for (const section in this.remoteData) {\n      this.compareSectionStartingFromRemoteElements(section)\n    }\n    this.handleAllLocalElementsNotInRemote()\n    this.delta.remoteData = this.applyDeltaToData('remote', this.remoteData)\n    this.delta.localData = this.applyDeltaToData('local', this.localData)\n    return this.delta\n  }\n\n  private compareSectionStartingFromRemoteElements (section: keyof TAnitaUniversalDataStorage): void {\n    this.localElementsMerged[section] = []\n    const pkKey = RESERVED_FIELDS.id\n    if (this.remoteData[section] && this.remoteData[section].length > 0) {\n      for (let remElesCounter = 0, remElesLen = this.remoteData[section].length; remElesCounter < remElesLen; remElesCounter++) {\n        try {\n          const element = this.localData[section].find((ele) => ele[pkKey] === this.remoteData[section][remElesCounter][pkKey])\n          this.toDoIfLocalElementExistsOrNot(remElesCounter, section, element)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n  }\n\n  private toDoIfLocalElementExistsOrNot (remElesCounter: number, section: keyof TAnitaUniversalDataStorage, localElement?: ISectionElement): void {\n    if (localElement) {\n      this.checkWhatToUpdateBetweenRemoteAndLocalElement(section, localElement, remElesCounter)\n    } else {\n      this.checkIfShouldInsertRemoteInLocalOrDeleteFromRemote(section, remElesCounter)\n    }\n  }\n\n  /**\n   * @description The element exist both remotely and locally\n   *              Here we need to determine which one has been edited for last, if updatedAt is different\n   *              Either we update the local one, or store in a temp var the value to push it to the db\n   *              after we drop the localelement from the localElementsList, to see what's left at the end\n   */\n  private checkWhatToUpdateBetweenRemoteAndLocalElement (section: keyof TAnitaUniversalDataStorage, localElement: ISectionElement, remElesCounter: number): void {\n    const pkKey = RESERVED_FIELDS.id\n    const remoteElement = this.remoteData[section][remElesCounter]\n    const dateCompareField = this.getDateCompareField(this.remoteData[section][remElesCounter], localElement)\n    if (!DateTools.areEqual(remoteElement[dateCompareField], localElement[dateCompareField])) {\n      const target = DateTools.firstIsAfterSecond(remoteElement[dateCompareField], localElement[dateCompareField]) ? 'local' : 'remote'\n      const newestElement = target === 'local' ? remoteElement : localElement\n      this.addElesForScope(target, 'update', section, newestElement)\n    }\n    if (localElement[pkKey]) {\n      this.addToLocalElementsMerged(section, localElement)\n    }\n  }\n\n  /**\n   * @description The element exist only remotely\n   *              Here we need to determine if the elements has been added remotely, or removed locally\n   *              If the updatedAt is after the lastSync, or the lastSync is null, the element has to be added locally\n   *              otherwise, the element has to be deleted from the remote db\n   */\n  private checkIfShouldInsertRemoteInLocalOrDeleteFromRemote (section: keyof TAnitaUniversalDataStorage, remElesCounter: number): void {\n    const dateCompareField = this.remoteData[section][remElesCounter][RESERVED_FIELDS.updatedAt] ? RESERVED_FIELDS.updatedAt : RESERVED_FIELDS.createdAt\n    const target = DateTools.firstIsAfterSecond(this.remoteData[section][remElesCounter][dateCompareField], this.lastSync) || !this.lastSync ? 'local' : 'remote'\n    const action = target === 'local' ? 'insert' : 'delete'\n    this.addElesForScope(target, action, section, this.remoteData[section][remElesCounter])\n    if (target === 'remote') {\n      this.addToLocalElementsMerged(section, this.remoteData[section][remElesCounter])\n    }\n  }\n\n  private handleAllLocalElementsNotInRemote (): void {\n    for (const section in this.localData) {\n      this.handleLocalElementsNotInRemoteBySection(section)\n    }\n  }\n\n  private handleLocalElementsNotInRemoteBySection (section: keyof TAnitaUniversalDataStorage): void {\n    const pkKey = RESERVED_FIELDS.id\n    const localElementsNotProcessedWithRemote = this.localElementsMerged?.[section]?.length\n      ? this.localData[section].filter((ele) => ele[pkKey] && !this.localElementsMerged[section].includes(ele[pkKey]))\n      : this.localData[section]\n    this.shouldElementsOnlyInLocalBeDeletedOrAddedToRemote(section, localElementsNotProcessedWithRemote)\n  }\n\n  /**\n   * @description Here we analyze the remaining local elements (if any)\n   *              If the updatedAt is after the lastSync, or the lastSync is null, the element has to be pushed to the remote db\n   *              otherwise, the element has to be deleted from the local db\n   */\n  private shouldElementsOnlyInLocalBeDeletedOrAddedToRemote (section: keyof TAnitaUniversalDataStorage, localElementsNotProcessedWithRemote: ISectionElement): void {\n    if (localElementsNotProcessedWithRemote) {\n      for (let localElesOnlyCounter = 0, localElementsOnlyLength = localElementsNotProcessedWithRemote.length; localElesOnlyCounter < localElementsOnlyLength; localElesOnlyCounter++) {\n        const dateCompareField = localElementsNotProcessedWithRemote[localElesOnlyCounter][RESERVED_FIELDS.updatedAt] ? RESERVED_FIELDS.updatedAt : RESERVED_FIELDS.createdAt\n        const target = (DateTools.firstIsAfterSecond(localElementsNotProcessedWithRemote[localElesOnlyCounter][dateCompareField], this.lastSync) || !this.lastSync) ? 'remote' : 'local'\n        const action = target === 'remote' ? 'insert' : 'delete'\n        this.addElesForScope(target, action, section, localElementsNotProcessedWithRemote[localElesOnlyCounter])\n      }\n    }\n  }\n\n  private addToLocalElementsMerged (section: keyof TAnitaUniversalDataStorage, element: ISectionElement): void {\n    const pkKey = RESERVED_FIELDS.id\n    if (element[pkKey]) {\n      this.localElementsMerged[section].push(element[pkKey])\n    }\n  }\n\n  private addElesForScope (target: 'remote' | 'local', action: 'delete' | 'insert' | 'update', section: keyof TAnitaUniversalDataStorage, element: ISectionElement): void {\n    if (action === 'delete' && Comparator.nonDeletableSections.includes(section as unknown as RESERVED_AUDS_KEYS)) {\n      return\n    }\n    if (!this.delta[target][action]) {\n      this.delta[target][action] = {}\n    }\n    if (!this.delta[target][action]) {\n      this.delta[target][action] = {}\n    }\n    if (!this.delta[target][action][section]) {\n      this.delta[target][action][section] = []\n    }\n    this.delta[target][action][section]!.push(element)\n  }\n\n  private getDateCompareField (remoteElement: ISectionElement, localElement: ISectionElement): string {\n    if (remoteElement[RESERVED_FIELDS.updatedAt] || localElement[RESERVED_FIELDS.updatedAt]) {\n      return RESERVED_FIELDS.updatedAt\n    }\n    return RESERVED_FIELDS.createdAt\n  }\n\n  private applyDeltaToData (scope: 'local' | 'remote', dataToUpdate: TAnitaUniversalDataStorage): TAnitaUniversalDataStorage {\n    for (const action in this.delta[scope]) {\n      const actionAsKey = action as keyof IElesForScope\n      const deltaRemoteActionData = this.delta[scope][actionAsKey]\n      for (const section in deltaRemoteActionData) {\n        const sectionAsKey = section as keyof TAnitaUniversalDataStorage\n        if (typeof deltaRemoteActionData[sectionAsKey] === 'object') {\n          for (const element of deltaRemoteActionData[sectionAsKey]!) {\n            if (actionAsKey === 'delete') {\n              dataToUpdate[sectionAsKey] = dataToUpdate?.[sectionAsKey]?.filter((ele) => ele[RESERVED_FIELDS.id] !== element[RESERVED_FIELDS.id])\n            } else if (actionAsKey === 'insert') {\n              if (!dataToUpdate[sectionAsKey]) {\n                dataToUpdate[sectionAsKey] = []\n              }\n              dataToUpdate[sectionAsKey].push(element)\n            } else if (actionAsKey === 'update') {\n              const indexElement = dataToUpdate[sectionAsKey].findIndex((ele) => ele[RESERVED_FIELDS.id] === element[RESERVED_FIELDS.id])\n              if (indexElement !== -1) {\n                dataToUpdate[sectionAsKey][indexElement] = element\n              }\n            }\n          }\n        }\n      }\n    }\n    return dataToUpdate\n  }\n}\n","import { TAnitaUniversalDataStorage } from 'app/models/project/project.declarations'\nimport { Comparator } from 'app/models/project/syncing/project-comparator'\n\ninterface IComparatorWorkerPayload {\n  lastSync: string | undefined\n  localData: TAnitaUniversalDataStorage\n  remoteData: TAnitaUniversalDataStorage\n}\n\nself.onmessage = async (event: MessageEvent<IComparatorWorkerPayload>) => {\n  const { lastSync, localData, remoteData } = event.data\n  const comparisonResult = new Comparator(lastSync, localData, remoteData).compare()\n  self.postMessage(comparisonResult)\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = function() {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [60], function() { return __webpack_require__(8089); })\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"static/js/\" + chunkId + \".\" + \"57375fec\" + \".chunk.js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = function(chunkId) {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.p = \"/app/\";","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t89: 1\n};\n\n// importScripts chunk loading\nvar installChunk = function(data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = function(chunkId, promises) {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkanita_app\"] = self[\"webpackChunkanita_app\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = function() {\n\treturn __webpack_require__.e(60).then(next);\n};","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["RESERVED_FIELDS","RESERVED_AUDS_KEYS","DateTools","date","Date","toUTCString","toISOString","date1","date2","d1","d2","getTime","Comparator","lastSync","localData","remoteData","delta","remote","delete","insert","update","local","localElementsMerged","section","this","compareSectionStartingFromRemoteElements","handleAllLocalElementsNotInRemote","applyDeltaToData","pkKey","id","length","remElesCounter","remElesLen","element","find","ele","toDoIfLocalElementExistsOrNot","error","console","localElement","checkWhatToUpdateBetweenRemoteAndLocalElement","checkIfShouldInsertRemoteInLocalOrDeleteFromRemote","remoteElement","dateCompareField","getDateCompareField","areEqual","target","firstIsAfterSecond","newestElement","addElesForScope","addToLocalElementsMerged","updatedAt","createdAt","action","handleLocalElementsNotInRemoteBySection","localElementsNotProcessedWithRemote","filter","includes","shouldElementsOnlyInLocalBeDeletedOrAddedToRemote","localElesOnlyCounter","localElementsOnlyLength","push","nonDeletableSections","scope","dataToUpdate","actionAsKey","deltaRemoteActionData","sectionAsKey","indexElement","findIndex","Object","values","self","onmessage","event","data","comparisonResult","compare","postMessage","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","x","__webpack_exports__","O","deferred","result","chunkIds","fn","priority","notFulfilled","Infinity","i","fulfilled","j","keys","every","key","splice","r","d","definition","o","defineProperty","enumerable","get","f","e","chunkId","Promise","all","reduce","promises","u","miniCssF","g","globalThis","Function","window","obj","prop","prototype","hasOwnProperty","call","p","installedChunks","importScripts","chunkLoadingGlobal","parentChunkLoadingFunction","bind","moreModules","runtime","pop","next","then"],"sourceRoot":""}