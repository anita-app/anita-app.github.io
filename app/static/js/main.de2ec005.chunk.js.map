{"version":3,"sources":["app/libs/redux/redux-actions.const.ts","app/libs/redux/reducers/form-element.reducer.ts","app/ui-react-components/shared-components/forms-automator/form-component-codes.enum.ts","app/libs/redux/reducers/form-eles-valid-state.reducer.ts","app/ui-react-components/shared-components/forms-automator/input-supported-types.const.ts","app/data/local-dbs/local-storage-systems.enum.ts","app/data/project-structure/reserved-fields.constant.ts","app/data/project-form-builder/options-builder.constant.ts","app/data/project-form-builder/project-info-builder.constant.ts","app/data/project-form-builder/project-editor-form-builder.const.ts","app/data/project-form-builder/section-fields-builder.constant.ts","app/data/project-form-builder/section-info-builder.constant.ts","app/data/project-structure/project-info.ts","app/data/system-local-db/sections/local-settings.const.ts","app/libs/id-creator/id-creator.class.ts","app/libs/redux/reducers/form-project.reducer.ts","app/libs/redux/reducers/layout.reducer.ts","app/libs/redux/reducers/sections-for-child-of-selector.reducer.ts","app/libs/redux/reducers.const.ts","app/libs/redux/reducers/project.reducer.ts","app/libs/redux/reducers/projects.reducer.ts","app/libs/redux/state.store.ts","app/data/local-dbs/db-instances.const.ts","app/data/system-local-db/sections/projects.const.ts","app/data/system-local-db/auds-system-sections.enum.ts","app/data/system-local-db/client-sections.enum.ts","app/data/system-local-db/sections/auds-sections.const.ts","app/data/system-local-db/sections/auds-settings.const.ts","app/libs/db-connector/db-builder/default-values.constant.ts","app/libs/logger/logger.class.ts","app/libs/db-connector/db-builder/sez-builder.class.ts","app/libs/db-connector/db-builder/data-structure-builder.class.ts","app/libs/db-connector/db-connector.class.ts","app/data/system-local-db/data-structure-extender.class.ts","app/libs/db-connector/plugins/indexed-db/db-store/dbstore.class.ts","app/libs/db-connector/plugins/indexed-db/query-makers/query-helper.class.ts","app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class.ts","app/libs/db-connector/plugins/indexed-db/db-deletor/db-deletor.class.ts","app/libs/db-connector/plugins/indexed-db/db-insertor/db-insertor.class.ts","app/libs/db-connector/plugins/indexed-db/db-selector/db-selector.class.ts","app/libs/db-connector/plugins/indexed-db/exporter.constant.ts","app/libs/db-connector/plugins/indexed-db/db-updator/db-updator.class.ts","app/libs/redux/store-dispatcher.function.ts","app/libs/projects-helpers/projects-handlers/projects-list-loader.class.ts","app/ui-react-components/editor-mode.enum.ts","app/anita-routes/anita-routes.constant.ts","app/libs/startupper/startupper.class.ts","app/libs/db-connector/plugins/file-handles/helpers/fs-helper.ts","app/libs/db-connector/plugins/file-handles/helpers/project-file-handle-saver.class.ts","app/libs/db-connector/plugins/file-handles/db-deletor/db-deletor.class.ts","app/libs/db-connector/crypter/options.constant.ts","app/libs/db-connector/crypter/string-crypter.function.ts","app/libs/db-connector/crypter/string-decrypter.function.ts","app/libs/db-connector/crypter/crypt-helper.class.ts","app/libs/db-connector/crypter/encrypter.class.ts","app/libs/db-connector/plugins/file-handles/helpers/element-adder-to-collection.class.ts","app/libs/db-connector/plugins/file-handles/db-insertor/db-insertor.class.ts","app/libs/db-connector/crypter/decrypter.class.ts","app/libs/db-connector/plugins/file-handles/db-selector/db-selector.class.ts","app/libs/db-connector/plugins/file-handles/helpers/file-handle-checker.function.ts","app/libs/db-connector/plugins/file-handles/db-store/dbstore.class.ts","app/libs/db-connector/plugins/file-handles/db-updator/db-updator.class.ts","app/libs/db-connector/plugins/file-handles/exporter.constant.ts","app/libs/db-connector/common-helpers/query-maker.class.ts","app/libs/db-connector/common-helpers/where-builder.class.ts","app/libs/db-connector/plugins/sqlite/helpers/execute-query-no-return.function.ts","app/libs/db-connector/plugins/sqlite/helpers/schema-exporter.function.ts","app/libs/db-connector/plugins/sqlite/db-deletor/db-deletor.class.ts","app/libs/db-connector/plugins/sqlite/db-insertor/db-insertor.class.ts","app/libs/db-connector/plugins/sqlite/helpers/execute-query-with-return.function.ts","app/libs/db-connector/plugins/sqlite/helpers/serializer.function.ts","app/libs/db-connector/plugins/sqlite/db-selector/db-selector.class.ts","app/libs/db-connector/plugins/sqlite/helpers/schema-creator.class.tsx","app/libs/db-connector/plugins/sqlite/db-store/dbstore.class.ts","app/libs/db-connector/plugins/sqlite/db-updator/db-updator.class.ts","app/libs/db-connector/plugins/sqlite/exporter.constant.ts","app/data/local-dbs/db-initializer.class.ts","app/libs/project-helpers/project-handlers/current-project-setter.class.ts","app/libs/project-helpers/project-handlers/project-loader.class.ts","app/libs/project-helpers/project-handlers/is-project-loaded.function.ts","app/libs/project-helpers/parent-info-form-ele-builder/parent-info-form-ele-builder.class.ts","app/libs/tools/find-section-by-id.function.ts","app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum.ts","app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component.tsx","app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component.tsx","app/ui-react-components/shared-components/forms-automator/form-validation/validators/email-format.component.tsx","app/ui-react-components/shared-components/forms-automator/form-validation/validators/required-field.component.tsx","app/ui-react-components/shared-components/forms-automator/form-validation/validators/telephone-number.component.tsx","app/ui-react-components/shared-components/forms-automator/form-validation/validators/url-format.component.tsx","app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component.tsx","app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook.ts","app/ui-react-components/shared-components/forms-automator/form-fields/basic-checkbox.component.tsx","app/ui-react-components/shared-components/forms-automator/form-builder/calc-width.function.ts","app/ui-react-components/shared-components/forms-automator/form-layout/fom-elements-css-classes.const.ts","app/ui-react-components/shared-components/forms-automator/form-fields/basic-input.component.tsx","app/ui-react-components/shared-components/forms-automator/form-fields/basic-radio.component.tsx","app/ui-react-components/shared-components/forms-automator/form-fields/basic-select.component.tsx","app/ui-react-components/shared-components/forms-automator/hooks/use-set-default-value.ts","app/ui-react-components/shared-components/forms-automator/form-fields/basic-textarea.component.tsx","app/libs/project-helpers/parent-info-form-ele-builder/parent-info-obj-to-string.function.ts","app/libs/project-helpers/parent-info-form-ele-builder/parent-info-string-to-obj.function.ts","app/ui-react-components/shared-components/forms-automator/form-fields/child-of-selector-for-section.component.tsx","app/ui-react-components/shared-components/forms-automator/form-fields/hidden-input.component.tsx","app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const.ts","app/ui-react-components/shared-components/forms-automator/form-fields/options-maker-single-option.component.tsx","app/ui-react-components/shared-components/forms-automator/form-fields/options-maker.component.tsx","app/libs/tools/find-first-user-defined-field.function.ts","app/libs/tools/tools.ts","app/libs/project-helpers/parent-info-form-ele-builder/options-for-parents-selector.class.ts","app/ui-react-components/shared-components/forms-automator/form-fields/parents-selector.component.tsx","app/ui-react-components/shared-components/forms-automator/form-builder/prerequisites-checker.class.ts","app/ui-react-components/shared-components/forms-automator/form-layout/field-selector.component.tsx","app/ui-react-components/shared-components/forms-automator/form-builder/form-eles-switcher.function.tsx","app/ui-react-components/shared-components/forms-automator/form-automator.component.tsx","app/ui-react-components/project/add-edit-components/form-element-manager.component.tsx","app/libs/project-helpers/section-elements-handlers/element-saver.class.ts","app/ui-react-components/project/add-edit-components/save-element.component.tsx","app/ui-react-components/shared-components/common-ui-eles/main-content-container.component.tsx","app/ui-react-components/shared-components/loader/loader.component.tsx","app/ui-react-components/project/add-edit-section-element.component.tsx","app/libs/project-helpers/txt-by-field-value.function.ts","app/libs/project-helpers/project-handlers/project-deletor.class.ts","app/ui-react-components/shared-components/modals/modal-body.component.tsx","app/ui-react-components/shared-components/modals/modal-content.component.tsx","app/ui-react-components/shared-components/modals/modal-footer.component.tsx","app/ui-react-components/shared-components/modals/modal-header.component.tsx","app/ui-react-components/shared-components/modals/modal.component.tsx","app/ui-react-components/shared-components/buttons/delete-project.component.tsx","app/anita-routes/url-param-fillers.function.ts","app/ui-react-components/shared-components/buttons/edit-project-button.component.tsx","app/ui-react-components/shared-components/common-ui-eles/card-footer-items-end.component.tsx","app/ui-react-components/project/project-details.component.tsx","app/ui-react-components/project/details-components/delete-section-element-button.component.tsx","app/libs/project-helpers/get-parent-info-for-details-view.class.ts","app/ui-react-components/project/details-components/parents-link-shower.component.tsx","app/ui-react-components/project/values-renderers/basic-text.component.tsx","app/ui-react-components/project/values-renderers/check-box-as-check.component.tsx","app/ui-react-components/project/values-renderers/color.component.tsx","app/ui-react-components/project/values-renderers/email.component.tsx","app/ui-react-components/project/values-renderers/formatted-date-time.component.tsx","app/ui-react-components/project/values-renderers/formatted-date.component.tsx","app/ui-react-components/project/values-renderers/month.component.tsx","app/ui-react-components/project/values-renderers/password.component.tsx","app/ui-react-components/project/values-renderers/range.component.tsx","app/ui-react-components/project/values-renderers/tel.component.tsx","app/ui-react-components/project/values-renderers/text-from-options-by-value.component.tsx","app/ui-react-components/project/values-renderers/url.component.tsx","app/libs/tools/remove-protocol-from-url.function.ts","app/ui-react-components/project/values-renderers/week.component.tsx","app/ui-react-components/project/values-renderers/custom-render-picker.component.tsx","app/ui-react-components/shared-components/buttons/add-edit-element-button.component.tsx","app/ui-react-components/project/section-element-details.component.tsx","app/ui-react-components/project/list-components/td-with-link-to-details.component.tsx","app/ui-react-components/project/list-components/tableList.component.tsx","app/ui-react-components/project/no-section-data.component.tsx","app/ui-react-components/project/section-elements-list.component.tsx","app/libs/project-helpers/project-handlers/save-project-settings-in-indexeddb.class.ts","app/libs/project-helpers/project-handlers/project-saver.class.ts","app/ui-react-components/projects/add-edit-project-components/section-form-model-manager.component.tsx","app/libs/project-helpers/auto-generate-field-name.function.ts","app/ui-react-components/projects/add-edit-project-components/section-manager.component.tsx","app/ui-react-components/projects/add-edit-project-components/form-project-manager.component.tsx","app/ui-react-components/projects/add-edit-project-components/project-editor-mode-toggle.component.tsx","app/ui-react-components/projects/add-edit-project.component.tsx","app/libs/projects-helpers/project-importers/project-data-importer.class.ts","app/libs/projects-helpers/project-importers/project-file-importer.class.ts","app/ui-react-components/projects/project-importer-components/import-project-button.component.tsx","app/ui-react-components/projects/no-projects.component.tsx","app/ui-react-components/projects/project-card-components/project-loaded-footer.component.tsx","app/ui-react-components/projects/project-card-components/project-not-loaded-footer.component.tsx","app/ui-react-components/projects/project-card.component.tsx","app/ui-react-components/projects/projects-list.component.tsx","app/anita-routes/anita-routes.component.tsx","app/ui-react-components/admin-layout/components/project-picker.component.tsx","app/ui-react-components/hooks/click-outside.hook.tsx","app/ui-react-components/admin-layout/components/sidebar-menu.component.tsx","app/ui-react-components/admin-layout/content.component.tsx","app/ui-react-components/admin-layout/header.component.tsx","app/ui-react-components/admin-layout/sidebar.component.tsx","app/version.ts","app/ui-react-components/admin-layout/admin-layout.component.tsx","serviceWorkerRegistration.ts","index.tsx"],"names":["REDUX_ACTIONS","FORM_COMPONENTS_CODES","formElementState","element","initialState","TextInputSupportedTypes","DateInputSupportedTypes","DateTimeInputSupportedTypes","SELECTABLE_FORM_ELES","value","basicInput","label","basicTextarea","basicCheckbox","basicSelect","basicRadio","datePicker","dateTimePicker","LOCAL_STORAGE_SYSTEMS","RESERVED_FIELDS","TEXT_INPUT_SUPPORTED_TYPES_OPTIONS","text","email","number","password","color","range","tel","url","DATE_INPUT_SUPPORTED_TYPES_OPTIONS","date","month","week","DATE_TIME_INPUT_SUPPORTED_TYPES_OPTIONS","datetimeLocal","time","commonFieldsAdvanced","componentCode","fieldName","type","required","width","commonFieldsBasic","optionsBuilderForAddingAdvanced","optionsBuilderForAddingBasic","hiddenInput","optionsBuilderForEditingAdvanced","disabled","optionsBuilderForEditingBasic","PROJECT_EDITOR_MODE","hintFsNotSupported","commonFieldsForProjectInfo","id","createdAt","availableSystems","fileSystem","window","hint","IndexedDB","SQLite","projectInfoNewItem","options","projectInfoForEditing","allFieldsExceptBasicInput","childOfSelectorForSection","Object","entries","map","filter","includes","labelsForBasicAndAdvanced","sizeWithoutInputType","sizeWithtInputType","toString","prerequisites","undefined","componentSelectorForBasicAndAdvanced","size","inputTypeSelectors","commonAddAndEditFields","optionsMaker","sectionElesNewItemAdvanced","sectionElesNewItemBasic","sectionElesForEditingAdvanced","sectionElesForEditingBasic","sectionDetailsFormFieldsModel","RESERVED_AUDS_KEYS","PROJECT_EDITOR_FORM_BUILDER","advanced","projectInfo","newItem","existingItem","sectionInfo","sectionEles","optionEles","basic","LOCAL_SETTINGS_KEYS","IdCreator","name","aliasDate","Date","toUTCString","toISOString","randNumber","Math","floor","random","CryptoES","SHA256","original","_settings","_sections","project","mode","sidebar","sectionsForChildOfSelectorState","REDUCERS","state","action","setCurrentProject","payload","resetCurrentProject","projects","addProjectToList","concat","setProjectList","sectionsForChildOfSelector","addSectionForChildOfSelector","editableState","length","index","findIndex","sectionDeclaration","position","push","formElesValidState","setValidStateForEle","formEleId","valid","unsetValidStateForEle","copyState","formElement","updateFormElement","updateFormElementKey","formProject","setProjectEditorMode","setFormProject","cloneDeep","updateFormProjectSettings","updateFormProjectAddSection","title","formModel","updateFormProjectUpdateSection","stateCopy","originalSection","updateFormProjectUpdateFormModelOfSection","elementReference","indexSection","indexFormElement","newElement","identifierAutoVal","updateFormProjectAddFieldToSection","updateFormProjectRemoveFieldFromSection","sectionIndex","splice","fieldIndex","updateFormProjectRemoveSection","updateFormProjectUpdateFormModelAddOption","defaultValue","updateFormProjectUpdateFormModelDeleteOption","indexOptions","updateFormProjectUpdateFormModelOptionValue","layout","toggleSidebar","newState","combinedReducers","combineReducers","store","createStore","dbInstances","system","localSettings","fields","AUDS_SYSTEM_SECTIONS","CLIENT_SECTIONS","previousVersions","CLIENT_SEZ_DEFINITIONS","auds_sections","pk","jsonFields","auds_settings","AUDS_SYSTEM_SECTIONS_DEFINITIONS","DEFAULT_PK","DEFAULT_PARENTS_IDENTIFIER","parentsInfo","DEFAULT_OWNER_IDENTIFIER","createdBy","Logger","desc","arrMsg","JSON","stringify","doLog","list","isEmptyList","stringList","Array","isArray","listFromArray","listFromObject","substring","keys","forEach","line","spacesForListeles","formatValueForList","key","txt","extra","isPrimitiveValue","data","methodName","debug","console","join","SezBuilder","allSez","indexes","orderBy","childOf","parentsIdentifiers","ownerIdentifier","section","this","addPkToFields","addPkToIndexes","addSpecialFieldsToFields","setOwnerIdentifier","checkOrderByExists","checkRelations","checkParentIdentifier","buildSez","unshift","scope","loopAllRelations","sezName","checkRelationsExist","getSezByName","indexInScope","indexOf","error","foundIndex","counter","addChildOf","DataStructureBuilder","ds","sez","sezParams","make","addToTempDs","DbConnector","executers","addSystemSections","dbStore","DS","assign","initDB","Error","insertor","args","selector","updator","deletor","DataStructureExtender","sections","datastructure","buildSectionDefinition","sezDefinition","buildAndAddAllSections","values","field","addToTempTs","DbStore","db","deletedSections","indexedDbName","setDb","handlePreviousVersion","buildDb","makeDexieInfoForUpgrade","newSections","oldSections","sectionsToDelete","sectionsToAdd","extend","close","open","delete","dexieInfoForUpgrade","Dexie","versionSezs","version","tables","stores","QueryHelper","arraysWhere","arraysWhereLen","dexieWhere","whereArr","objFieldsNValues","arrSearch","includeLower","includeUpper","lowerBound","upperBound","operator","item","where","logic","result","QueryMaker","dbConnector","table","collection","dexieFilters","arrWhere","new_where","order","complexSelect","methodToExecute","handleDebug","objSearch","get","res","eleToReturn","fieldNValues","buildArrayFildsNValues","toArray","betweenSearchParams","buildBetweenSearchParams","between","buildFilter4Dexie","all_records","toCollection","chainFilters","and","sortBy","put","update","count","promises","clear","Promise","all","typeToShow","toShow","raw","DbDeletor","aliasElementToDelete","addWhere","clearTable","DbInsertor","insertMany","insertOne","bulkPut","insert","catch","err","DbSelector","qe","setUpSelect","setQuery","executeSelect","setOrder","setOrderBy","select","INDEXEDDB_PLUGIN","storeDispatcher","dispatch","EDITOR_MODE","URL_PARAMS","ProjectsListLoader","projectList","loadFromLocalDB","dispatchProjectList","callSelector","multiple","Startupper","systemDbName","info","initSystemIndexedDb","setLoggerDebug","loadProjectList","init","React","createElement","isReactDev","load","ANITA_URLS","projectsNone","projectsList","projectAdd","add","projectEdit","edit","projectId","projectDetails","projectSectionElesList","sectionId","projectSectionAddEle","projectSectionEditEle","elementId","projectSectionEleDetails","getDirectoryHandle","showDirectoryPicker","readFileHandleAsText","fileHandle","a","getFile","file","readDirFileAsUint8Array","dirHandle","fileName","getFileHandle","create","arrayBuffer","Uint8Array","getNewFileHandle","description","accept","opts","types","showSaveFilePicker","contents","createWritable","writable","write","verifyPermission","withWrite","queryPermission","requestPermission","ProjectFileHandleSaver","setData","saveDataToDisk","writeFile","indexElement","ele","save","securePassEncrypter","stringCrypter","keyToUse","AES","encrypt","stringDecrypter","decrypt","CryptHelper","owner","undecryptedKey","keyIdentifier","setOwner","setUndecryptedKey","makeKeyIdentifier","userKeys","decryptUserKey","returnUserUnencryptedKey","encryptionKeys","keyToEncrypt","Encrypter","getUserKey","logNoKeyError","ElementAdderToCollection","elements","setSectionStore","processElement","checkIfElementInStoreAndSetIndex","addToStore","check","encrypted","handleEncryption","do","Decrypter","results","doSelect","find","filterKeys","eleToCheck","handleDecryption","i","fileHandleChecker","dirHandleChecker","initializeExistingProject","doReadFile","parseFileContents","makedDS","parse","DbUpdator","FILE_HANDLES_PLUGIN","whereArgs","obj","squel","autoQuoteTableNames","autoQuoteFieldNames","from","whereArg","prop","fieldsRemoverIfThereIsNoColumn","into","setFields","setFieldsRows","warn","WhereBuilder","addWhereFromObj","params","executeQueryNoReturn","query","run","schemaExporter","binaryArray","export","keepExistingData","handleJsonFields","handleJsonField","jsonField","executeQueryWithReturn","exec","serializer","columns","row","objData","cell","parseJsonFields","SchemaCreator","sql","handleTable","createFields","onProjectCreation","makeDSFromDB","loadDB","createSchema","initSqlJs","locateFile","process","SQL","Database","buildQuery","copyEle","SQLITE_PLUGIN","DbInitializer","projectSections","localStorage","doFileSystem","doSQLite","doIndexedDb","dsExpander","CurrentProjectSetter","projectSettings","sectionsDefinitions","ProjectLoader","setProject","setProjectInfoFromIndexedDB","createNewInstanceOfDbConnectorForrProject","loadProjectSettings","loadProjectSections","callCurrentProjectSetter","single","set","isProjectLoaded","loadProject","ParentInfoFormEleBuilder","parentInfoFormModel","setOptions","setParentSelector","sectionName","parentsSelector","findSectionById","toFindId","SUPPORTED_VALIDATORS","FormEleContainer","children","className","FormElementLabel","EmailFormat","memo","formEle","updateValidatorState","isValidEmail","test","useEffect","emailFormat","prevProps","nextProps","touched","RequiredField","TelephoneNumber","isValidTelephonenumber","telephoneNumber","UrlFormat","isValidUrl","urlFormat","ValidatorsContainer","props","validators","setFieldValidatorsState","useState","validatorName","isValid","currentValue","newValue","allValid","every","setIsValidForField","useValidators","fieldId","setIsValid","BasicCheckbox","handleChange","setTouched","useRef","uniqueId","current","checked","Reflect","has","onChange","event","target","onBlur","calcWidth","FORM_ELEMENTS_CSS_CLASSES","FORM_ELEMENTS_CSS_CLASSES_ERR","BasicInput","placeholder","BasicRadio","option","indexOption","effect","BasicSelect","valueSetter","currentValueIfValidOrNull","some","prereqisiteValuesAreEqual","prerequisite","flat","array","BasicTextarea","parentInfoObjToString","parentInfoObj","parentInfo","parentInfoStringToObjForOptionsGroup","selectOptions","group","opt","parentInfoStringToObj","ChildOfSelectorForSection","currentEditedProjectSections","useSelector","setSelectOptions","isMounted","selectableSections","sectionDec","buildOptions","isMulti","HiddenInput","SUCCESS_BTN_OUTLINE","DANGER_BTN_OUTLINE","OptionsMakerSingleOption","handleOptionsChange","handleClickDeleteOption","optionElement","projectEditorMode","formModelToUse","useMemo","getCanEdit","bind","onClick","OptionsMaker","handleClickAddOption","findFirstUserDefinedField","sectionFormModel","firstUserDefinedFieldInfo","cleanString","source","r","toLowerCase","non_asciis","ae","c","e","n","o","oe","u","y","replace","RegExp","asyncForEach","callback","totalLength","OptionsForParentsSelector","optionsGroups","createGroupOption","sectionLabel","indexFirstUserFiield","ParentsSelector","getSelectOptions","PrerequisitesChecker","objValues","isIntegrated","loopPrerequisites","checkPrerequisites","prereq","prereqValue","setIsIntegrated","FieldSelector","integrates","formElesSwitcher","FormAutomator","FormElementManager","build","ElementSaver","sectionModelInDS","setSectionModel","checkAndSetPk","setcreatedAt","deleteEmptyProps","callInsertor","autoInsert","setupdatedAtValueIfInEditMode","callUpdator","autoUpdate","updatedAt","SaveElement","validObj","navigate","useNavigate","handleClick","MainContentContainer","headerText","Loader","xmlns","fill","viewBox","cx","cy","stroke","strokeWidth","d","AddEditSectionElement","useParams","setElement","fetchElement","canProceed","to","txtByFieldValue","optionToReturn","ProjectDeletor","callOnProjectDeleted","doDelete","reloadProjectList","callDeletor","autoDelete","onProjectDeleted","ModalBody","ModalContent","icon","ModalFooter","ModalHeader","bgClasses","confirm","normal","hover","focus","alert","Modal","actionText","handleClickAction","closeFn","animationClass","disableAction","role","DeleteProjectButton","isModalOpen","setIsModalOpen","setAnimationClass","currentProject","handleClickModal","setTimeout","urlParamFiller","paramsToFill","EditButton","CardFooterItemsEnd","LoadedProject","dateFormat","ProjectDetails","style","minHeight","DeleteSectionElementButton","GetParentInfoForDetailsView","listOfParents","parentInfoForDetailsView","sectionIdElementId","arrInfo","split","ParentsLinkShower","parents","setParents","getParents","parent","BasicText","CheckBoxAsCheck","Color","backgroundColor","Email","href","rel","FormattedDateTime","FormattedDate","Month","toLocaleString","year","Password","showPassword","setShowPassword","Percentage","Tel","TextFromOptionsByValue","Url","Week","reverse","customRenderPicker","parseInt","handleInputType","handleDateType","handleDateTimeType","AddEditElementButton","urlParamsToFill","SectionElementDetails","fetchData","formModels","ElementValuesViewer","ValueWithLabel","TdWithLinkToDetails","tdProps","navigation","tagName","TableList","sectionData","colsToShoww","Header","accessor","Cell","useSectionInfo","useTable","useSortBy","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","headerGroup","getHeaderGroupProps","headers","column","getHeaderProps","getSortByToggleProps","render","getRowProps","cells","getCellProps","NoSectionData","sectionTitle","SectionElementsList","setSectionData","getSectionData","SaveProjectSettingsInIndexedDB","localSettingAdditionalKeys","copyOfProjectSettings","setProjectSettingsCloneWithAdditionalKeys","doStoreProjectSettings","ProjectSaver","log","setupdatedAt","initDbInstance","saveSettings","saveSections","postSaveActions","clearSection","SectionFormModelManager","alreadyExists","getAlreadyExists","labelValue","SectionManager","customFields","handleClickDeleteField","FormProjectManager","handleClickSave","projectFormModel","ProjectEditorModeToggle","htmlFor","AddEditProject","fetchEProject","ProjectDataImporter","projectData","initializeDb","setLocalProjectSettings","dispatchProject","saveDataToDb","postProjectCreation","ProjectFileImporter","fileContents","askForFileHandle","importFromFile","showOpenFilePicker","fileHandles","fileDialog","files","ImportProjectButton","btnType","setProjectData","projectFileHandle","setProjectFileHandle","setProjectSettings","import","handleClickImport","ProjectsNone","ProjectLoadedFooter","ProjectNotLoadedFooter","ProjectCard","projectState","ProjectsList","hasLoaded","setHasLoaded","projectsLenght","loadProjectsList","AnitaRoutes","path","ProjectPicker","parentElement","dropdownOpen","setDropdownOpen","dropDownRef","onClickOutside","contains","document","addEventListener","removeEventListener","fn","goToDetails","ref","projectFromList","baseStyleOfSidebarLinks","addActiveClassNameToBaseStyle","currentPath","linkPath","nonProjectRoutes","ProjectMenu","location","useLocation","pathname","SidebarMenu","route","Content","sidebarHideClass","handleClickSidebar","strokeLinecap","strokeLinejoin","src","height","alt","fontVariant","Sidebar","toggledClass","AdminLayout","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","StrictMode","getElementById","URL","origin","fetch","response","contentType","status","ready","unregister","reload","checkValidServiceWorker","serviceWorkerRegistration"],"mappings":"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","file":"static/js/main.de2ec005.chunk.js","sourcesContent":["/**\r\n * Supported reducer actions\r\n */\r\nexport enum REDUX_ACTIONS {\r\n  // LAYOUT\r\n  toggleSidebar = 1,\r\n  // PROJECTS\r\n  addProjectToList,\r\n  setProjectList,\r\n  // PROJECT\r\n  setCurrentProject,\r\n  resetCurrentProject,\r\n  // SECTIONS_FOR_CHILD_OF_SELECTOR\r\n  addSectionForChildOfSelector,\r\n  resetSectionForChildOfSelector,\r\n  // FORMS\r\n  setValidStateForEle,\r\n  unsetValidStateForEle,\r\n  updateFormElement,\r\n  updateFormElementKey,\r\n  setFormProject,\r\n  setProjectEditorMode,\r\n  updateFormProjectSettings,\r\n  updateFormProjectAddSection,\r\n  updateFormProjectUpdateSection,\r\n  updateFormProjectUpdateFormModelOfSection,\r\n  updateFormProjectRemoveSection,\r\n  updateFormProjectAddFieldToSection,\r\n  updateFormProjectRemoveFieldFromSection,\r\n  updateFormProjectUpdateFormModelAddOption,\r\n  updateFormProjectUpdateFormModelDeleteOption,\r\n  updateFormProjectUpdateFormModelOptionValue\r\n};\r\n","import { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { Action } from 'app/libs/redux/action.type'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\n\r\nexport interface IFormElementState {\r\n  element: SectionElement | undefined | null;\r\n}\r\n\r\n/**\r\n * The initial state of the container of the current project\r\n */\r\nconst formElementState: IFormElementState = {\r\n  element: null\r\n};\r\n\r\n/**\r\n * Updates the projectState\r\n */\r\nexport const formElementReducer = (state: IFormElementState = formElementState, action: Action<REDUX_ACTIONS>): IFormElementState => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.updateFormElement:\r\n      return {\r\n        element: { ...action.payload }\r\n      }\r\n    case REDUX_ACTIONS.updateFormElementKey:\r\n      return {\r\n        element: { ...state.element, [action.payload.fieldName]: action.payload.value }\r\n      }\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\n\r\n/**\r\n * Values to identify the form component to dynamically load.\r\n *\r\n * @remarks\r\n * These values are stored in each `Section` in `AnitaUniversalDataStorage['sections']` so their number __must__ not be changed. Element can be added freely.\r\n */\r\nexport enum FORM_COMPONENTS_CODES {\r\n  basicInput = 1,\r\n  basicTextarea = 2,\r\n  basicCheckbox = 3,\r\n  basicSelect = 4,\r\n  basicRadio = 5,\r\n  hiddenInput = 6,\r\n  optionsMaker = 7,\r\n  datePicker = 8,\r\n  dateTimePicker = 9,\r\n  childOfSelectorForSection = 10,\r\n  parentsSelector = 11\r\n}\r\n\r\n\r\n/**\r\n * Defines the value of the Select element for picking the type of Component for a field.\r\n */\r\nexport const SELECTABLE_FORM_ELES: Array<OptionKeysModel> = [\r\n  {\r\n    value: FORM_COMPONENTS_CODES.basicInput,\r\n    label: 'Short text'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.basicTextarea,\r\n    label: 'Long text'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.basicCheckbox,\r\n    label: 'Check box'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.basicSelect,\r\n    label: 'Drop-down list'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.basicRadio,\r\n    label: 'Alternative choice'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.datePicker,\r\n    label: 'Date picker'\r\n  },\r\n  {\r\n    value: FORM_COMPONENTS_CODES.dateTimePicker,\r\n    label: 'Date & time'\r\n  }\r\n];\r\n","import { Action } from 'app/libs/redux/action.type'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\n\r\nexport interface IFormElesValidState {\r\n  [formEleUniqueId: string]: boolean;\r\n}\r\n\r\n/**\r\n * The initial state of the form-eles-valid-state reducer\r\n */\r\nconst initialState: IFormElesValidState = {};\r\n\r\n/**\r\n * The reducer function that sets the valid state of the form elements\r\n */\r\nexport const formElesValidStateReducer = (state: IFormElesValidState = initialState, action: Action<REDUX_ACTIONS>): IFormElesValidState => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.setValidStateForEle:\r\n      return { ...state, [action.payload.formEleId]: action.payload.valid };\r\n    case REDUX_ACTIONS.unsetValidStateForEle:\r\n      const copyState = { ...state };\r\n      delete copyState[action.payload];\r\n      return copyState;\r\n    default:\r\n      return state;\r\n  }\r\n}","import { OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\n\r\nexport enum TextInputSupportedTypes {\r\n  color = 'color',\r\n  email = 'email',\r\n  number = 'number',\r\n  password = 'password',\r\n  range = 'range',\r\n  tel = 'tel',\r\n  text = 'text',\r\n  url = 'url'\r\n}\r\n\r\nexport enum DateInputSupportedTypes {\r\n  date = 'date',\r\n  month = 'month',\r\n  week = 'week'\r\n}\r\n\r\nexport enum DateTimeInputSupportedTypes {\r\n  datetimeLocal = 'datetime-local',\r\n  time = 'time',\r\n}\r\n\r\nexport const TEXT_INPUT_SUPPORTED_TYPES_OPTIONS: Array<OptionKeysModel> = [\r\n  {\r\n    value: TextInputSupportedTypes.text,\r\n    label: 'Text'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.email,\r\n    label: 'Email'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.number,\r\n    label: 'Number'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.password,\r\n    label: 'Password'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.color,\r\n    label: 'Color'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.range,\r\n    label: 'Range'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.tel,\r\n    label: 'Tel'\r\n  },\r\n  {\r\n    value: TextInputSupportedTypes.url,\r\n    label: 'Url'\r\n  }\r\n]\r\n\r\nexport const DATE_INPUT_SUPPORTED_TYPES_OPTIONS: Array<OptionKeysModel> = [\r\n  {\r\n    value: DateInputSupportedTypes.date,\r\n    label: 'Date'\r\n  },\r\n  {\r\n    value: DateInputSupportedTypes.month,\r\n    label: 'Month'\r\n  },\r\n  {\r\n    value: DateInputSupportedTypes.week,\r\n    label: 'Week'\r\n  }\r\n]\r\n\r\nexport const DATE_TIME_INPUT_SUPPORTED_TYPES_OPTIONS: Array<OptionKeysModel> = [\r\n  {\r\n    value: DateTimeInputSupportedTypes.datetimeLocal,\r\n    label: 'Date & time'\r\n  },\r\n  {\r\n    value: DateTimeInputSupportedTypes.time,\r\n    label: 'Time only'\r\n  }\r\n]","export enum LOCAL_STORAGE_SYSTEMS {\r\n  fileSystem = 1,\r\n  IndexedDB = 2,\r\n  SQLite = 3,\r\n}","/**\r\n * Defines the fields name that are reserved for the functioning of Anita.\r\n * These fields names cannot be assigned as the value of the `fieldName` of sections' fields.\r\n */\r\nexport enum RESERVED_FIELDS {\r\n  id = 'id',\r\n  createdAt = 'createdAt',\r\n  parentsInfo = 'parentsInfo',\r\n  updatedAt = 'updatedAt',\r\n  createdBy = 'createdBy'\r\n}\r\n","import { FormFieldsModel, OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\nconst commonFieldsAdvanced: FormFieldsModel<OptionKeysModel> = {\r\n  componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n  fieldName: 'label',\r\n  type: TextInputSupportedTypes.text,\r\n  label: 'Label',\r\n  required: true,\r\n  width: \"8\"\r\n};\r\n\r\nconst commonFieldsBasic: FormFieldsModel<OptionKeysModel> = {\r\n  componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n  fieldName: 'label',\r\n  type: TextInputSupportedTypes.text,\r\n  label: 'Label',\r\n  required: true,\r\n  width: \"11\"\r\n};\r\n\r\n/**\r\n * Defines the Form model to create the options of a `select` or `radio` element.\r\n *\r\n * @remarks\r\n * For adding options only, some properties can't be changed after the filed has been created. Existing items must use `optionsBuilderForEditingAdvanced` instead.\r\n */\r\nexport const optionsBuilderForAddingAdvanced: Array<FormFieldsModel<OptionKeysModel>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'value',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Value',\r\n    required: true,\r\n    width: \"3\"\r\n  },\r\n  commonFieldsAdvanced\r\n];\r\n\r\nexport const optionsBuilderForAddingBasic: Array<FormFieldsModel<OptionKeysModel>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: 'value'\r\n  },\r\n  commonFieldsBasic\r\n];\r\n\r\n/**\r\n * Defines the Form model to edit the options of a `select` or `radio` element.\r\n *\r\n * @remarks\r\n * For existing fields only, some properties can't be changed after the filed has been created. New items must use `optionsBuilderForAddingAdvanced` instead.\r\n */\r\nexport const optionsBuilderForEditingAdvanced: Array<FormFieldsModel<OptionKeysModel>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'value',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Value',\r\n    disabled: true,\r\n    required: true,\r\n    width: \"3\"\r\n  },\r\n  commonFieldsAdvanced\r\n\r\n];\r\nexport const optionsBuilderForEditingBasic: Array<FormFieldsModel<OptionKeysModel>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: 'value'\r\n  },\r\n  commonFieldsBasic\r\n\r\n];\r\n","import { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum'\r\nimport { ProjectSettings } from 'app/data/project-structure/project-info'\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant'\r\nimport { FormFieldsModel, OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\n\r\nconst hintFileSystem = 'The Project is saved in a file on your computer in JSON. Data is updated automatically every time you make any change.\\nYou can chose the name and the location of the file when you click \"Save\" at the bottom of this form.';\r\nconst hintFsNotSupported = 'Not supported in this browser.\\nAvailable only on the Desktop version of Chrome, Edge and Opera.';\r\nconst indexedDB = 'The Project is saved on your computer in the IndexedDB database of your Browser.\\nYou can export data in a JSON file at any time.';\r\nconst sqLite = 'The Project is saved on your computer in a SQLite database.\\nThe database is stored in a file in your File System.';\r\n\r\nconst commonFieldsForProjectInfo: Array<FormFieldsModel<ProjectSettings>> = [{\r\n  componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n  fieldName: RESERVED_FIELDS.id\r\n},\r\n{\r\n  componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n  fieldName: RESERVED_FIELDS.createdAt\r\n},\r\n{\r\n  componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n  fieldName: 'title',\r\n  type: TextInputSupportedTypes.text,\r\n  value: '',\r\n  label: 'Project',\r\n  required: true\r\n},\r\n{\r\n  componentCode: FORM_COMPONENTS_CODES.basicTextarea,\r\n  fieldName: 'description',\r\n  value: '',\r\n  label: 'Description',\r\n  required: true\r\n}];\r\n\r\nexport const availableSystems: Array<OptionKeysModel> = [\r\n  {\r\n    label: 'File system',\r\n    value: LOCAL_STORAGE_SYSTEMS.fileSystem,\r\n    disabled: typeof window['showOpenFilePicker'] === 'undefined',\r\n    hint: typeof window['showOpenFilePicker'] === 'function' ? hintFileSystem : hintFsNotSupported\r\n  },\r\n  {\r\n    label: 'Local database (IndexedDB)',\r\n    value: LOCAL_STORAGE_SYSTEMS.IndexedDB,\r\n    hint: indexedDB\r\n  },\r\n  {\r\n    label: 'Local database (SQLite)',\r\n    value: LOCAL_STORAGE_SYSTEMS.SQLite,\r\n    disabled: typeof window['showOpenFilePicker'] === 'undefined',\r\n    hint: typeof window['showOpenFilePicker'] === 'function' ? sqLite : hintFsNotSupported\r\n  }\r\n]\r\n\r\n/**\r\n * Defines the Form model to set the field properties of `ProjectSettings`.\r\n * Empty project template used when creating new projects.\r\n */\r\nexport const projectInfoNewItem: Array<FormFieldsModel<ProjectSettings>> = [\r\n  ...commonFieldsForProjectInfo,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicRadio,\r\n    fieldName: 'localStorage',\r\n    value: LOCAL_STORAGE_SYSTEMS.IndexedDB,\r\n    label: 'Local storage',\r\n    required: true,\r\n    options: availableSystems\r\n  }\r\n];\r\n\r\nexport const projectInfoForEditing: Array<FormFieldsModel<ProjectSettings>> = [\r\n  ...commonFieldsForProjectInfo,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicRadio,\r\n    fieldName: 'localStorage',\r\n    value: LOCAL_STORAGE_SYSTEMS.IndexedDB,\r\n    label: 'Local storage',\r\n    required: true,\r\n    disabled: true,\r\n    options: availableSystems\r\n  }\r\n];\r\n","import {\r\n  optionsBuilderForAddingAdvanced,\r\n  optionsBuilderForAddingBasic,\r\n  optionsBuilderForEditingAdvanced,\r\n  optionsBuilderForEditingBasic\r\n  } from 'app/data/project-form-builder/options-builder.constant';\r\nimport { projectInfoForEditing, projectInfoNewItem } from 'app/data/project-form-builder/project-info-builder.constant';\r\nimport {\r\n  sectionElesForEditingAdvanced,\r\n  sectionElesForEditingBasic,\r\n  sectionElesNewItemAdvanced,\r\n  sectionElesNewItemBasic\r\n  } from 'app/data/project-form-builder/section-fields-builder.constant';\r\nimport { sectionDetailsFormFieldsModel } from 'app/data/project-form-builder/section-info-builder.constant';\r\n\r\nexport enum PROJECT_EDITOR_MODE {\r\n  advanced = 1,\r\n  basic\r\n};\r\n\r\nexport const PROJECT_EDITOR_FORM_BUILDER = {\r\n  [PROJECT_EDITOR_MODE.advanced]: {\r\n    projectInfo: {\r\n      newItem: projectInfoNewItem,\r\n      existingItem: projectInfoForEditing\r\n    },\r\n    sectionInfo: sectionDetailsFormFieldsModel,\r\n    sectionEles: {\r\n      newItem: sectionElesNewItemAdvanced,\r\n      existingItem: sectionElesForEditingAdvanced\r\n    },\r\n    optionEles: {\r\n      newItem: optionsBuilderForAddingAdvanced,\r\n      existingItem: optionsBuilderForEditingAdvanced\r\n    }\r\n  },\r\n  [PROJECT_EDITOR_MODE.basic]: {\r\n    projectInfo: {\r\n      newItem: projectInfoNewItem,\r\n      existingItem: projectInfoForEditing\r\n    },\r\n    sectionInfo: sectionDetailsFormFieldsModel,\r\n    sectionEles: {\r\n      newItem: sectionElesNewItemBasic,\r\n      existingItem: sectionElesForEditingBasic\r\n    },\r\n    optionEles: {\r\n      newItem: optionsBuilderForAddingBasic,\r\n      existingItem: optionsBuilderForEditingBasic\r\n    }\r\n  }\r\n};\r\n","import { SectionCustomFieldProperties, SectionDetailsDeclaration } from 'app/data/project-structure/project-info'\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant'\r\nimport { FormFieldsModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES, SELECTABLE_FORM_ELES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport {\r\n  DATE_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n  DATE_TIME_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n  DateInputSupportedTypes,\r\n  DateTimeInputSupportedTypes,\r\n  TEXT_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n  TextInputSupportedTypes\r\n  } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\nexport const sectionDetailsFormFieldsModel: Array<FormFieldsModel<SectionDetailsDeclaration>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: RESERVED_FIELDS.id\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'title',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Section name',\r\n    required: true\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.childOfSelectorForSection,\r\n    fieldName: 'childOf',\r\n    label: 'Parent sections:',\r\n    options: []\r\n  }\r\n];\r\n\r\nconst allFieldsExceptBasicInput = Object.entries(FORM_COMPONENTS_CODES).map(([key, value]) => value).filter((value: FORM_COMPONENTS_CODES) => ![FORM_COMPONENTS_CODES.basicInput, FORM_COMPONENTS_CODES.datePicker, FORM_COMPONENTS_CODES.dateTimePicker].includes(value) && typeof value === 'number')\r\n\r\nconst labelsForBasicAndAdvanced = (sizeWithoutInputType: number, sizeWithtInputType: number): Array<FormFieldsModel<SectionCustomFieldProperties>> => [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'label',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Field label',\r\n    required: true,\r\n    width: sizeWithoutInputType.toString(),\r\n    prerequisites: [{\r\n      componentCode: [undefined, \"\", ...allFieldsExceptBasicInput],\r\n    }]\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'label',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Field label',\r\n    required: true,\r\n    width: sizeWithtInputType.toString(),\r\n    prerequisites: [{ componentCode: [FORM_COMPONENTS_CODES.basicInput] }, { componentCode: [FORM_COMPONENTS_CODES.datePicker] }, { componentCode: [FORM_COMPONENTS_CODES.dateTimePicker] }]\r\n\r\n  },\r\n]\r\n\r\nconst componentSelectorForBasicAndAdvanced = (size: number): FormFieldsModel<SectionCustomFieldProperties> => ({\r\n  componentCode: FORM_COMPONENTS_CODES.basicSelect,\r\n  fieldName: 'componentCode',\r\n  options: SELECTABLE_FORM_ELES,\r\n  value: SELECTABLE_FORM_ELES[0].value,\r\n  label: 'Data type',\r\n  required: true,\r\n  width: size.toString()\r\n})\r\n\r\n/**\r\n * Show the select options for the type of Input element\r\n */\r\nconst inputTypeSelectors: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicSelect,\r\n    fieldName: 'type',\r\n    options: TEXT_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n    value: TextInputSupportedTypes.text,\r\n    label: 'Content type',\r\n    required: true,\r\n    width: \"2\",\r\n    prerequisites: [{ componentCode: [FORM_COMPONENTS_CODES.basicInput] }]\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicSelect,\r\n    fieldName: 'type',\r\n    options: DATE_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n    value: DateInputSupportedTypes.date,\r\n    label: 'Date format',\r\n    required: true,\r\n    width: \"2\",\r\n    prerequisites: [{ componentCode: [FORM_COMPONENTS_CODES.datePicker] }]\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicSelect,\r\n    fieldName: 'type',\r\n    options: DATE_TIME_INPUT_SUPPORTED_TYPES_OPTIONS,\r\n    value: DateTimeInputSupportedTypes.datetimeLocal,\r\n    label: 'Time format',\r\n    required: true,\r\n    width: \"2\",\r\n    prerequisites: [{ componentCode: [FORM_COMPONENTS_CODES.dateTimePicker] }]\r\n  }\r\n]\r\n\r\n/**\r\n * Defines common fields that are used both when creating and editing fields of a `Section`.\r\n */\r\nconst commonAddAndEditFields: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.optionsMaker,\r\n    fieldName: 'options',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Possible values',\r\n    prerequisites: [{ componentCode: [FORM_COMPONENTS_CODES.basicSelect, FORM_COMPONENTS_CODES.basicRadio] }],\r\n    required: true\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicCheckbox,\r\n    fieldName: 'required',\r\n    value: false,\r\n    label: 'Required'\r\n  }\r\n];\r\n\r\n/**\r\n * Defines the Form model to set the field properties of a `Section`.\r\n * All the values specified in each field of `sectionElesNewItemAdvanced` are necessary for creating each field.\r\n *\r\n * @remarks\r\n * For new fields only. Existing items must use `sectionElesForEditingAdvanced` as some properties can't be changed after the filed has been created.\r\n */\r\nexport const sectionElesNewItemAdvanced: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  ...labelsForBasicAndAdvanced(7, 5),\r\n  componentSelectorForBasicAndAdvanced(3),\r\n  ...inputTypeSelectors,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'fieldName',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Identifier',\r\n    required: true,\r\n    width: \"2\"\r\n  },\r\n  ...commonAddAndEditFields\r\n];\r\n\r\nexport const sectionElesNewItemBasic: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  ...labelsForBasicAndAdvanced(8, 6),\r\n  componentSelectorForBasicAndAdvanced(4),\r\n  ...inputTypeSelectors,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: 'fieldName'\r\n  },\r\n  ...commonAddAndEditFields\r\n];\r\n\r\n/**\r\n * Defines the Form model to edit the properties of an existing field of a `Section`.\r\n *\r\n * @remarks\r\n * For existing fields only, some properties can't be changed after the filed has been created. New items must use `sectionElesNewItemAdvanced` instead.\r\n */\r\nexport const sectionElesForEditingAdvanced: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  ...labelsForBasicAndAdvanced(7, 5),\r\n  componentSelectorForBasicAndAdvanced(3),\r\n  ...inputTypeSelectors,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'fieldName',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Identifier',\r\n    disabled: true,\r\n    required: true,\r\n    width: \"2\"\r\n  },\r\n  ...commonAddAndEditFields\r\n];\r\n\r\nexport const sectionElesForEditingBasic: Array<FormFieldsModel<SectionCustomFieldProperties>> = [\r\n  ...labelsForBasicAndAdvanced(8, 6),\r\n  componentSelectorForBasicAndAdvanced(4),\r\n  ...inputTypeSelectors,\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: 'fieldName'\r\n  },\r\n  ...commonAddAndEditFields\r\n];\r\n","import { SectionDetailsDeclaration } from 'app/data/project-structure/project-info'\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant'\r\nimport { FormFieldsModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\nexport const sectionDetailsFormFieldsModel: Array<FormFieldsModel<SectionDetailsDeclaration>> = [\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.hiddenInput,\r\n    fieldName: RESERVED_FIELDS.id\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.basicInput,\r\n    fieldName: 'title',\r\n    type: TextInputSupportedTypes.text,\r\n    label: 'Section name',\r\n    required: true\r\n  },\r\n  {\r\n    componentCode: FORM_COMPONENTS_CODES.childOfSelectorForSection,\r\n    fieldName: 'childOf',\r\n    label: 'Parent sections:',\r\n    options: []\r\n  }\r\n];\r\n","import { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum'\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant'\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model'\r\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api'\r\nimport { FormFieldsModel, OptionKeysModel, SupportedFormsTypes } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\n/**\r\n * Reserved keys are needed to store system required properties.\r\n *\r\n * @remarks\r\n * Users can still pick any of these as section names as sections are stored using their system-generated `id` as key.\r\n */\r\nexport enum RESERVED_AUDS_KEYS {\r\n  _settings = '_settings',\r\n  _sections = '_sections'\r\n}\r\n\r\n/**\r\n * Data structure of Anita, composed of both SystemData and UserData.\r\n */\r\nexport type AnitaUniversalDataStorage = SystemData & UserData;\r\n\r\n/**\r\n * Store for system required properties. Includes general settings and Sections declarations. The reserved keys define system required properties.\r\n */\r\nexport type SystemData = {\r\n  [RESERVED_AUDS_KEYS._settings]: Array<ProjectSettings>;\r\n  [RESERVED_AUDS_KEYS._sections]: Array<Section>;\r\n};\r\n\r\n/**\r\n * Sections' data, stored in a Object, where the key is the section `id` and the value is a `Array<SectionElement>`.\r\n */\r\nexport type UserData = {\r\n  [sectionId: string]: Array<SectionElement>;\r\n};\r\n\r\n/**\r\n * Defines the structure of the general information on a project.\r\n */\r\nexport interface ProjectSettings {\r\n  id: string;\r\n  title: string;\r\n  description: string;\r\n  createdAt: string;\r\n  localStorage: LOCAL_STORAGE_SYSTEMS;\r\n  updatedAt?: string;\r\n  encrypted?: boolean;\r\n}\r\n\r\nexport interface AdditionalInfoForLocalStorage {\r\n  fileHandle?: FileSystemFileHandle;\r\n  dexieInfoForUpgrade?: {\r\n    previousVersions: Array<Array<string>>;\r\n    DS: AbstractModel;\r\n  }\r\n}\r\n\r\n/**\r\n * Info on Projects saved locally to know what project are on the device.\r\n * \r\n * @property [fileHandle] - The file handle of the project file (only if the project is saved on the file system)\r\n * @property [sections] - The sections of the project to load the IndexedDB database with Dexie\r\n */\r\nexport interface LocalProjectSettings extends ProjectSettings, AdditionalInfoForLocalStorage {\r\n}\r\n\r\n/**\r\n * Defines the properties of user defined fields of a `Section`\r\n *\r\n * @remarks\r\n * These fields are for the object to be stored in `sections.formModel[]` of the `AnitaUniversalDataStorage` store.\r\n */\r\nexport interface SectionCustomFieldProperties {\r\n  componentCode: FORM_COMPONENTS_CODES;\r\n  type?: TextInputSupportedTypes;\r\n  fieldName: string;\r\n  label?: string;\r\n  options?: Array<OptionKeysModel>;\r\n  required?: boolean;\r\n  externalLabel?: boolean;\r\n  value?: any;\r\n  width?: number;\r\n  [RESERVED_FIELDS.id]?: never;\r\n  [RESERVED_FIELDS.createdAt]?: never;\r\n}\r\n\r\n/**\r\n * Defines the bare minimum properties of a `Section` of a Project.\r\n */\r\nexport interface SectionDetailsDeclaration {\r\n  id: string;\r\n  title: string;\r\n  childOf?: Array<string>;\r\n  [RESERVED_FIELDS.createdAt]?: never;\r\n}\r\n\r\n/**\r\n * Defines the full properties of a Section.\r\n */\r\nexport interface Section extends SectionDetailsDeclaration {\r\n  formModel: Array<FormFieldsModel<SupportedFormsTypes>>;\r\n}\r\n\r\n/**\r\n * Defines the properties of each parent to which a element is connected.\r\n */\r\nexport interface ParentInfoForDetailsView {\r\n  txt: string;\r\n  sectionId: string;\r\n  element: SectionElement;\r\n}\r\n\r\n/**\r\n * Defines the bare minimum fields of an `Element` of a `Section`.\r\n */\r\nexport interface SectionElement {\r\n  [RESERVED_FIELDS.id]?: string;\r\n  [RESERVED_FIELDS.createdAt]?: string;\r\n  [RESERVED_FIELDS.createdBy]?: string;\r\n  [RESERVED_FIELDS.parentsInfo]?: Array<string>;\r\n  [RESERVED_FIELDS.updatedAt]?: string;\r\n  [key: string]: any;\r\n}\r\n","import { SectionDefinition } from 'app/libs/db-connector/db-builder/sez-definition';\r\n\r\n/**\r\n * Defines the table localSettings and its fields for the `indexedDb` plugin of `db-connector`\r\n */\r\nexport const localSettings: SectionDefinition<LocalSettingsData<LOCAL_SETTINGS_KEYS>> = {\r\n  name: 'localSettings',\r\n  fields: [\r\n    'data'\r\n  ]\r\n};\r\n\r\n/**\r\n * Constant to uniquely identify values of local settings.\r\n * As of now there are no settings yet to save, so we keep `testData`.\r\n */\r\nexport enum LOCAL_SETTINGS_KEYS {\r\n  testData = 1\r\n}\r\n\r\n/**\r\n * Defines the expected data structure to be saved in `localSettings`.\r\n */\r\nexport interface LocalSettingsData<T extends LOCAL_SETTINGS_KEYS> {\r\n  id: T;\r\n  data: DataByKey[T];\r\n}\r\n\r\n/**\r\n * Identifies the data type saved in `localSettings` by the enum value of `LOCAL_SETTINGS_KEYS`.\r\n */\r\ninterface DataByKey {\r\n  [LOCAL_SETTINGS_KEYS.testData]: unknown;\r\n}\r\n\r\n/**\r\n * Example of the method to store data in localSettings:\r\n *\r\n * private saveLocalSettings<T extends LOCAL_SETTINGS_KEYS>(id: T, data: DataByKey[T]): void {\r\n *   dbInsertor(CLIENT_SECTIONS.localSettings, { id, data }).autoInsert();\r\n * }\r\n */\r\n","import CryptoES from 'crypto-es';\r\n\r\n/**\r\n * Randomly generated strings hasehd with sha256 to be used as unique identifiers\r\n */\r\nexport class IdCreator {\r\n\r\n  /**\r\n   * Makes a unique random string with the a name \r\n   */\r\n  public static make(name: string): string {\r\n\r\n    const aliasDate = new Date(new Date().toUTCString()).toISOString();\r\n    const randNumber = Math.floor(Math.random() * (9999 - 1000 + 1)) + 1000;\r\n\r\n    const id = `${name}${aliasDate}${randNumber}`;\r\n\r\n    return CryptoES.SHA256(id).toString();\r\n  }\r\n\r\n  /**\r\n   * Makes a unique completely random string\r\n   */\r\n  public static random(): string {\r\n\r\n    const aliasDate = new Date(new Date().toUTCString()).toISOString();\r\n    const randNumber = Math.floor(Math.random() * (9999 - 1000 + 1)) + 1000;\r\n\r\n    const id = `${aliasDate}${randNumber}`;\r\n\r\n    return CryptoES.SHA256(id).toString();\r\n  }\r\n\r\n}\r\n","import { PROJECT_EDITOR_MODE } from 'app/data/project-form-builder/project-editor-form-builder.const'\r\nimport { RESERVED_AUDS_KEYS, SectionCustomFieldProperties, SystemData } from 'app/data/project-structure/project-info'\r\nimport { IdCreator } from 'app/libs/id-creator/id-creator.class'\r\nimport { Action } from 'app/libs/redux/action.type'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { FormFieldsModel, OptionKeysModel, SupportedFormsTypes } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport cloneDeep from 'lodash.clonedeep'\r\n\r\nexport interface IFormProjectState {\r\n  original: Partial<SystemData>;\r\n  project: Partial<SystemData>;\r\n  mode: PROJECT_EDITOR_MODE\r\n}\r\n\r\n/**\r\n * The initial state of the container of the current project\r\n */\r\nconst formElementState: IFormProjectState = {\r\n  original: {\r\n    [RESERVED_AUDS_KEYS._settings]: [],\r\n    [RESERVED_AUDS_KEYS._sections]: []\r\n  },\r\n  project: {\r\n    [RESERVED_AUDS_KEYS._settings]: [],\r\n    [RESERVED_AUDS_KEYS._sections]: []\r\n  },\r\n  mode: PROJECT_EDITOR_MODE.basic\r\n};\r\n\r\n/**\r\n * Updates the projectState\r\n */\r\nexport const formProjectReducer = (state: IFormProjectState = formElementState, action: Action<REDUX_ACTIONS>): IFormProjectState => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.setProjectEditorMode:\r\n      return {\r\n        original: state.original, project: state.project,\r\n        mode: state.mode === PROJECT_EDITOR_MODE.basic ? PROJECT_EDITOR_MODE.advanced : PROJECT_EDITOR_MODE.basic\r\n      };\r\n    case REDUX_ACTIONS.setFormProject:\r\n      // Here we need a deep copy of the project to leave the source unchanged in case the user cancel the edits, \r\n      // and to \"unlink\" the Object set on the `project` key from the one set on the `original` key.\r\n      return { original: cloneDeep(action.payload), mode: state.mode, project: cloneDeep(action.payload) };\r\n    case REDUX_ACTIONS.updateFormProjectSettings:\r\n      return {\r\n        original: state.original, mode: state.mode,\r\n        project: {\r\n          ...state.project,\r\n          [RESERVED_AUDS_KEYS._settings]: [{ ...state.project[RESERVED_AUDS_KEYS._settings][0], [action.payload.fieldName]: action.payload.value }]\r\n        }\r\n      };\r\n    case REDUX_ACTIONS.updateFormProjectAddSection:\r\n      return {\r\n        original: state.original, mode: state.mode,\r\n        project: {\r\n          ...state.project,\r\n          [RESERVED_AUDS_KEYS._sections]: state.project[RESERVED_AUDS_KEYS._sections].concat({\r\n            id: IdCreator.random(),\r\n            title: \"\",\r\n            formModel: [{} as any]\r\n          })\r\n        }\r\n      };\r\n    case REDUX_ACTIONS.updateFormProjectUpdateSection: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      const originalSection = stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.index];\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.index] = { ...originalSection, [action.payload.fieldName]: action.payload.value };\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectUpdateFormModelOfSection: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      const elementReference = stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement] as unknown as SectionCustomFieldProperties;\r\n      const newElement = { ...elementReference, [action.payload.fieldName]: action.payload.value };\r\n      if (action.payload.identifierAutoVal)\r\n        newElement.fieldName = action.payload.identifierAutoVal;\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement] = newElement as unknown as FormFieldsModel<SupportedFormsTypes>;\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectAddFieldToSection: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload].formModel.push({} as any);\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectRemoveFieldFromSection: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.sectionIndex].formModel.splice(action.payload.fieldIndex, 1);\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectRemoveSection: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections].splice(action.payload, 1);\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectUpdateFormModelAddOption: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      const defaultValue = stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement]['options'].length + 1;\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement]['options'].push({ label: \"\", value: defaultValue } as OptionKeysModel);\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectUpdateFormModelDeleteOption: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement]['options'].splice(action.payload.indexOptions, 1);\r\n      return stateCopy;\r\n    } case REDUX_ACTIONS.updateFormProjectUpdateFormModelOptionValue: {\r\n      const stateCopy = { original: state.original, mode: state.mode, project: { ...state.project } };\r\n      stateCopy.project[RESERVED_AUDS_KEYS._sections][action.payload.indexSection].formModel[action.payload.indexFormElement]['options'][action.payload.indexOptions] = action.payload.formElement;\r\n      return stateCopy;\r\n    } default:\r\n      return state;\r\n  }\r\n}\r\n","import { Action } from 'app/libs/redux/action.type';\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const';\r\n\r\nexport interface ILayoutState {\r\n  sidebar: \"-translate-x-full\" | \"\";\r\n}\r\n\r\n/**\r\n * The initial state of the container of the current project\r\n */\r\nconst formElementState: ILayoutState = {\r\n  sidebar: '-translate-x-full'\r\n};\r\n\r\n/**\r\n * Updates the projectState\r\n */\r\nexport const layoutReducer = (state: ILayoutState = formElementState, action: Action<REDUX_ACTIONS>): ILayoutState => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.toggleSidebar:\r\n      const newState = { ...state };\r\n      newState.sidebar = newState.sidebar === '-translate-x-full' ? '' : '-translate-x-full';\r\n      return newState;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { SectionDetailsDeclaration } from 'app/data/project-structure/project-info';\r\nimport { Action } from 'app/libs/redux/action.type';\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const';\r\n\r\n/**\r\n * The initial state of the container of the sections selectable by the child of selector\r\n */\r\nconst sectionsForChildOfSelectorState: Array<SectionDetailsDeclaration> = [];\r\n\r\n/**\r\n * Updates the sections selectable by the child of selector component\r\n * \r\n * @see ChildOfSelectorForSectionComponent\r\n */\r\nexport const sectionsForChildOfSelectorReducer = (state: Array<SectionDetailsDeclaration> = sectionsForChildOfSelectorState, action: Action<REDUX_ACTIONS>) => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.addSectionForChildOfSelector:\r\n      const editableState = state.concat();\r\n\r\n      if (!editableState.length)\r\n        editableState.push(action.payload);\r\n      else {\r\n        const index = editableState.findIndex(sectionDeclaration => sectionDeclaration.id === action.payload.id);\r\n        const position = index >= 0 ? index : editableState.length;\r\n        editableState[position] = action.payload;\r\n      }\r\n      return editableState;\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { LocalProjectSettings, SectionDetailsDeclaration, SystemData } from 'app/data/project-structure/project-info';\r\nimport { formElementReducer, IFormElementState } from 'app/libs/redux/reducers/form-element.reducer';\r\nimport { formElesValidStateReducer, IFormElesValidState } from 'app/libs/redux/reducers/form-eles-valid-state.reducer';\r\nimport { formProjectReducer, IFormProjectState } from 'app/libs/redux/reducers/form-project.reducer';\r\nimport { ILayoutState, layoutReducer } from 'app/libs/redux/reducers/layout.reducer';\r\nimport { projectReducer } from 'app/libs/redux/reducers/project.reducer';\r\nimport { projectsReducer } from 'app/libs/redux/reducers/projects.reducer';\r\nimport { sectionsForChildOfSelectorReducer } from 'app/libs/redux/reducers/sections-for-child-of-selector.reducer';\r\n\r\n/**\r\n * Supported reducers\r\n */\r\nexport const REDUCERS = {\r\n  project: projectReducer,\r\n  projects: projectsReducer,\r\n  sectionsForChildOfSelector: sectionsForChildOfSelectorReducer,\r\n  formElesValidState: formElesValidStateReducer,\r\n  formElement: formElementReducer,\r\n  formProject: formProjectReducer,\r\n  layout: layoutReducer\r\n};\r\n\r\n/**\r\n * Types managed by reducers\r\n */\r\nexport interface AnitaStore {\r\n  project: SystemData;\r\n  projects: Array<LocalProjectSettings>;\r\n  sectionsForChildOfSelector: Array<SectionDetailsDeclaration>;\r\n  formElesValidState: IFormElesValidState;\r\n  formElement: IFormElementState;\r\n  formProject: IFormProjectState;\r\n  layout: ILayoutState;\r\n}\r\n","import { SystemData } from 'app/data/project-structure/project-info';\r\nimport { Action } from 'app/libs/redux/action.type';\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const';\r\n\r\n/**\r\n * The initial state of the container of the current project\r\n */\r\nconst projectState: SystemData | void = null;\r\n\r\n/**\r\n * Updates the projectState\r\n */\r\nexport const projectReducer = (state: SystemData | void = projectState, action: Action<REDUX_ACTIONS>): SystemData | void => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.setCurrentProject:\r\n      return action.payload\r\n    case REDUX_ACTIONS.resetCurrentProject:\r\n      return null\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { LocalProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { Action } from 'app/libs/redux/action.type';\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const';\r\n\r\n/**\r\n * The initial state of the container of the current project\r\n */\r\nexport const projectsState: Array<LocalProjectSettings> | void = null;\r\n\r\n/**\r\n * Updates the projectsState\r\n */\r\nexport const projectsReducer = (state: Array<LocalProjectSettings> | void = projectsState, action: Action<REDUX_ACTIONS>) => {\r\n  switch (action.type) {\r\n    case REDUX_ACTIONS.addProjectToList:\r\n      return state ? state.concat(action.payload) : [action.payload];\r\n    case REDUX_ACTIONS.setProjectList:\r\n      return action.payload;\r\n    default:\r\n      return state;\r\n  }\r\n};","import { REDUCERS } from 'app/libs/redux/reducers.const';\r\nimport { combineReducers, createStore } from 'redux';\r\n\r\nconst combinedReducers = combineReducers(REDUCERS)\r\n\r\nexport const store = createStore(combinedReducers);","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport Dexie from 'dexie';\r\nimport { Db } from 'mongodb';\r\nimport * as mysql from 'mysql';\r\nimport { Database } from 'sql.js';\r\n\r\ninterface DbInstances {\r\n  system: DbConnectorInstance<Dexie>;\r\n  [projectIdentifier: string]: DbConnectorInstance<Dexie | Db | mysql.Connection | AnitaUniversalDataStorage | Database>;\r\n}\r\n\r\nexport const dbInstances: DbInstances = {\r\n  system: undefined\r\n};\r\n","import { LocalProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { SectionDefinition } from 'app/libs/db-connector/db-builder/sez-definition';\r\n\r\n/**\r\n * Defines the table projects and its fields for the `indexedDb` plugin of `db-connector`.\r\n * In the table `projects` are stored only the essential information needed to load the project from its data source.\r\n */\r\nexport const projects: SectionDefinition<LocalProjectSettings> = {\r\n  name: 'projects',\r\n  fields: [\r\n    'title',\r\n    'fileHandle',\r\n    'description',\r\n    RESERVED_FIELDS.createdAt\r\n  ]\r\n};\r\n","import { auds_sections } from 'app/data/system-local-db/sections/auds-sections.const';\r\nimport { auds_settings } from 'app/data/system-local-db/sections/auds-settings.const';\r\n\r\n/**\r\n * Identifies the table on which run the query with `db-connector`.\r\n */\r\nexport enum AUDS_SYSTEM_SECTIONS {\r\n  auds_settings = 1,\r\n  auds_sections\r\n}\r\n\r\n/**\r\n * Array to be passed to `db-connector` to initialize the DB with Dexie, via the IndexedDb plugin.\r\n */\r\nexport const AUDS_SYSTEM_SECTIONS_DEFINITIONS = [auds_settings, auds_sections];\r\n","import { localSettings } from 'app/data/system-local-db/sections/local-settings.const';\r\nimport { projects } from 'app/data/system-local-db/sections/projects.const';\r\n\r\n/**\r\n * Identifies the table on which run the query with `db-connector`.\r\n */\r\nexport const CLIENT_SECTIONS = {\r\n  projects: projects.name,\r\n  localSettings: localSettings.name\r\n};\r\n\r\n/**\r\n * Optional on first version, required for changes to the structure of the DB\r\n * Must contain on Array for each previous version\r\n * Each array must contain the unaltered SezDefinitions of that version\r\n * \r\n * TODO with Dexie 3.x.x upgrading has been simplified, probably no longer needed.\r\n */\r\nexport const previousVersions: Array<Array<string>> = [\r\n  // insert here previous version on DB structure change\r\n];\r\n\r\n/**\r\n * Array to be passed to `db-connector` to initialize the DB with Dexie, via the IndexedDb plugin.\r\n */\r\nexport const CLIENT_SEZ_DEFINITIONS = [projects, localSettings];\r\n","import { RESERVED_AUDS_KEYS, Section } from 'app/data/project-structure/project-info';\r\nimport { SectionDefinition } from 'app/libs/db-connector/db-builder/sez-definition';\r\n\r\n/**\r\n * Defines the table _sections and its fields for system data of the AnitaUniversalDataStorage structure.\r\n * This is needed to work on system sections with DbConnector.\r\n */\r\nexport const auds_sections: SectionDefinition<Section> = {\r\n  name: RESERVED_AUDS_KEYS._sections,\r\n  pk: 'id',\r\n  fields: ['title'],\r\n  jsonFields: ['childOf', 'formModel'],\r\n};\r\n","import { ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { SectionDefinition } from 'app/libs/db-connector/db-builder/sez-definition';\r\n\r\n/**\r\n * Defines the table _settings and its fields for system data of the AnitaUniversalDataStorage structure.\r\n * This is needed to work on system sections with DbConnector.\r\n */\r\nexport const auds_settings: SectionDefinition<ProjectSettings> = {\r\n  name: RESERVED_AUDS_KEYS._settings,\r\n  pk: 'id',\r\n  fields: ['title', 'localStorage', 'createdAt', 'description']\r\n};\r\n","import { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\n\r\n/**\r\n * Default primary key if none is specified.\r\n */\r\nexport const DEFAULT_PK = RESERVED_FIELDS.id;\r\n\r\n/**\r\n * Default parent identifier if none is specified.\r\n */\r\nexport const DEFAULT_PARENTS_IDENTIFIER = RESERVED_FIELDS.parentsInfo;\r\n\r\n/**\r\n * Default owner identifier if none is specified.\r\n */\r\nexport const DEFAULT_OWNER_IDENTIFIER = RESERVED_FIELDS.createdBy;\r\n","export class Logger {\r\n\r\n  /**\r\n   * Whether to print to the console debug info\r\n   */\r\n  public static debug = true;\r\n\r\n  /**\r\n   * Spaces to format list elements\r\n   */\r\n  private static spacesForListeles = '\\n                            - ';\r\n\r\n  // INFO\r\n\r\n  /**\r\n   * Formats in one line a description and a value\r\n   */\r\n  public static info<T>(desc: string, value?: T): string {\r\n    const arrMsg = (value) ? [`${desc}: ${JSON.stringify(value)}`] : [desc];\r\n    return Logger.doLog(arrMsg);\r\n  }\r\n\r\n  // LIST\r\n\r\n  /**\r\n   * Generates a list in the console for an array of strings\r\n   */\r\n  public static list(desc: string, list: Array<string> | Object): string {\r\n\r\n    if (Logger.isEmptyList(list))\r\n      Logger.doLog([desc, 'none']);\r\n\r\n    let stringList = (Array.isArray(list)) ? Logger.listFromArray(list) : Logger.listFromObject(list);\r\n\r\n    stringList = stringList.substring(0, stringList.length - 1);\r\n    stringList += '.';\r\n\r\n    return Logger.doLog([`${desc} ${stringList}`]);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a list is empty\r\n   */\r\n  private static isEmptyList(list: Array<string> | Object): boolean {\r\n    return (Array.isArray(list) && !list.length) || (typeof list === 'object' && !Object.keys(list).length);\r\n  }\r\n\r\n  /**\r\n   * Creates a list from an array\r\n   */\r\n  private static listFromArray(list: Array<string>): string {\r\n    let stringList = '';\r\n    list.forEach(line => { stringList += `${Logger.spacesForListeles}${Logger.formatValueForList(line)};`; });\r\n    return stringList;\r\n  }\r\n\r\n  /**\r\n   * Creates a list from a object \r\n   */\r\n  private static listFromObject(list: Object): string {\r\n    let stringList = '';\r\n    for (const key in list)\r\n      stringList += `${Logger.spacesForListeles}${key}: ${Logger.formatValueForList(list[key])};`;\r\n    return stringList;\r\n  }\r\n\r\n  // RAW\r\n\r\n  /**\r\n   * Same as console.log\r\n   */\r\n  public static raw(desc: string, txt?: any): string {\r\n    return Logger.doLog([`${desc}: `, txt]);\r\n  }\r\n\r\n  // ERROR\r\n\r\n  /**\r\n   * Same as console.error\r\n   */\r\n  public static error(desc: string, txt?: string, extra?: any): string {\r\n    return Logger.doLog([desc, txt, extra], 'error');\r\n  }\r\n\r\n  /**\r\n   * Same as console.warn\r\n   */\r\n  public static warn(desc: string, txt?: string, extra?: any): string {\r\n    return Logger.doLog([desc, txt, extra], 'warn');\r\n  }\r\n\r\n  // COMMON\r\n\r\n  /**\r\n   * Converts non primitive values to string \r\n   */\r\n  private static formatValueForList<T>(value: T): T | string {\r\n    return (Logger.isPrimitiveValue(value) || value === null) ? value : JSON.stringify(value);\r\n  }\r\n\r\n  /**\r\n   * Determines whether a value is a primitive\r\n   */\r\n  private static isPrimitiveValue<T>(value: T): boolean {\r\n    switch (typeof value) {\r\n      case 'string':\r\n      case 'number':\r\n      case 'boolean':\r\n      case 'undefined':\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Logs text to the console if debug is `true`\r\n   */\r\n  private static doLog(data: Array<string | number>, methodName: 'log' | 'error' | 'warn' = 'log'): string {\r\n\r\n    const date = new Date().toISOString();\r\n    data[0] = `[${date}] ${data[0]}`;\r\n\r\n    if (Logger.debug === true)\r\n      console[methodName](...data);\r\n\r\n    return data.join('. ');\r\n  }\r\n\r\n}\r\n","import { DEFAULT_OWNER_IDENTIFIER, DEFAULT_PARENTS_IDENTIFIER, DEFAULT_PK } from 'app/libs/db-connector/db-builder/default-values.constant';\r\nimport { SectionDefinition, SectionModel, SectionName } from 'app/libs/db-connector/db-builder/sez-definition';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\n\r\n/**\r\n * Builds a Section model\r\n */\r\nexport class SezBuilder<T> {\r\n\r\n  /**\r\n   * The section model\r\n   */\r\n  private section: SectionModel<T>;\r\n\r\n  /**\r\n   * Creates an instance of sez builder.\r\n   * @param allSez all the sections definitions of the data structure.\r\n   * @param name the section name to build.\r\n   * @param [fields] all fields. Optional as a section can have only the system fields.\r\n   * @param [pk] the primary key.\r\n   * @param [indexes] the indexes of the section (aka table).\r\n   * @param [orderBy] default sorting order.\r\n   * @param [childOf] list of sections of which the current section is child. Needed for the UI, to add the parent delector.\r\n   * @param [parentsIdentifiers] name of the field identifying the parent id value.\r\n   * @param [ownerIdentifier] name of the field identifying the id of the owner.\r\n   */\r\n  constructor(\r\n    private allSez: Array<SectionDefinition<any>>,\r\n    private name: SectionName,\r\n    private fields: Array<keyof T & string> = [],\r\n    private jsonFields: Array<keyof T & string> = [],\r\n    private pk: keyof T & string = DEFAULT_PK as keyof T & string,\r\n    private indexes: Array<keyof T> = [DEFAULT_PK] as Array<keyof T>,\r\n    private orderBy: keyof T & string = DEFAULT_PK as keyof T & string,\r\n    private childOf?: Array<SectionName>,\r\n    private parentsIdentifiers?: keyof T,\r\n    private ownerIdentifier?: keyof T & string\r\n  ) { }\r\n\r\n  /**\r\n   * Makes the section and returns it.\r\n   */\r\n  public make(): SectionModel<T> {\r\n    this.addPkToFields();\r\n    this.addPkToIndexes();\r\n    this.addSpecialFieldsToFields('indexes');\r\n    this.addSpecialFieldsToFields('jsonFields');\r\n    this.setOwnerIdentifier();\r\n    this.checkOrderByExists();\r\n    this.checkRelations();\r\n    this.checkParentIdentifier();\r\n    this.buildSez();\r\n    return this.section;\r\n  }\r\n\r\n  /**\r\n   * Adds the pk field name to fields if not already included.\r\n   */\r\n  private addPkToFields(): void {\r\n    if (!this.fields.includes(this.pk))\r\n      this.fields.unshift(this.pk);\r\n  }\r\n\r\n  /**\r\n   * Adds the pk field name to indexes if not already included.\r\n   */\r\n  private addPkToIndexes(): void {\r\n    if (!this.indexes.includes(this.pk))\r\n      this.indexes.unshift(this.pk);\r\n  }\r\n\r\n  /**\r\n   * Adds the fields specified in `indexes` to the fields, if not already included.\r\n   */\r\n  private addSpecialFieldsToFields(scope: 'indexes' | 'jsonFields'): void {\r\n    this[scope].forEach(fieldName => {\r\n      if (!this.fields.includes(fieldName))\r\n        this.fields.push(fieldName);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets the owneridentifier value and adds it to the fields if not already included.\r\n   */\r\n  private setOwnerIdentifier(): void {\r\n    if (!this.ownerIdentifier)\r\n      this.ownerIdentifier = DEFAULT_OWNER_IDENTIFIER as keyof T & string;\r\n    if (!this.fields.includes(this.ownerIdentifier))\r\n      this.fields.push(this.ownerIdentifier);\r\n  }\r\n\r\n  /**\r\n   * Adds the orderBy value to fields if not already included.\r\n   */\r\n  private checkOrderByExists(): void {\r\n    if (!this.fields.includes(this.orderBy))\r\n      this.fields.push(this.orderBy);\r\n  }\r\n\r\n  /**\r\n   * Checks that the values of `childOf` correspond to valid section names.\r\n   */\r\n  private checkRelations(): void {\r\n    if (this.childOf)\r\n      this.loopAllRelations();\r\n  }\r\n\r\n  /**\r\n   * Loops all relations for a given scope and calls checkRelationsExist to check if the value is valid.\r\n   * Sets the scope to undefined if there are no valid relationships.\r\n   *\r\n   * @see checkRelationsExist\r\n   */\r\n  private loopAllRelations(): void {\r\n    this.childOf.forEach((sezName: SectionName) => this.checkRelationsExist(sezName));\r\n    if (!this.childOf.length)\r\n      this.childOf = undefined;\r\n  }\r\n\r\n  /**\r\n   * Checks that the section name found in `childOf` correponds to an actual section.\r\n   * If not, removes the section name from the list of sections in `childOf`.\r\n   * @param sezName the name of the section to look for\r\n   */\r\n  private checkRelationsExist(sezName: SectionName): void {\r\n    const indexSez = this.getSezByName(sezName);\r\n    if (indexSez >= 0)\r\n      return;\r\n\r\n    const indexInScope = this.childOf.indexOf(sezName as string);\r\n    this.childOf.splice(indexInScope, 1);\r\n\r\n    Logger.error(`Error in .childOf list`, `Section '${sezName}' does not exist in the sections list and has hence been removed from the .childOf list`);\r\n  }\r\n\r\n  /**\r\n   * Finds the section number by its name from the list of all the section definitions.\r\n   * @param sezName the name to look for\r\n   * @returns the section number\r\n   */\r\n  private getSezByName(sezName: SectionName): number {\r\n    let foundIndex = -1;\r\n    let counter = 0;\r\n    const length = this.allSez.length;\r\n    while (foundIndex === -1 && counter < length) {\r\n      if (this.allSez[counter].name === sezName)\r\n        foundIndex = counter;\r\n      counter++;\r\n    }\r\n    return foundIndex;\r\n  }\r\n\r\n  /**\r\n   * Checks that parentsIdentifiers is set if `childOf` has any section.\r\n   */\r\n  private checkParentIdentifier(): void {\r\n    if (this.childOf && !this.parentsIdentifiers)\r\n      this.parentsIdentifiers = DEFAULT_PARENTS_IDENTIFIER as keyof T;\r\n  }\r\n\r\n  /**\r\n   * Builds the section\r\n   */\r\n  private buildSez(): void {\r\n    this.section = {\r\n      name: this.name,\r\n      pk: this.pk,\r\n      indexes: this.indexes,\r\n      orderBy: this.orderBy,\r\n      fields: this.fields,\r\n      ownerIdentifier: this.ownerIdentifier,\r\n      jsonFields: this.jsonFields\r\n    };\r\n    this.addChildOf();\r\n  }\r\n\r\n  /**\r\n   * Adds the filed `childOf` if any\r\n   */\r\n  private addChildOf(): void {\r\n    if (!this.childOf)\r\n      return;\r\n\r\n    this.section.childOf = this.childOf;\r\n    this.section.parentsIdentifiers = this.parentsIdentifiers;\r\n  }\r\n\r\n}\r\n","import { SezBuilder } from 'app/libs/db-connector/db-builder/sez-builder.class';\r\nimport { SectionDefinition, SectionModel } from 'app/libs/db-connector/db-builder/sez-definition';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\n\r\n/**\r\n * Builds the data structure of the DB from the section definitions and returns it.\r\n */\r\nexport class DataStructureBuilder {\r\n\r\n  /**\r\n   * The data structure to be returned.\r\n   */\r\n  private ds: AbstractModel = {};\r\n\r\n  /**\r\n   * Creates an instance of DataStructureBuilder.\r\n   * @param allSez the `Array` of all the definitions of the Sections (aka tables) of the DB.\r\n   */\r\n  constructor(\r\n    private allSez: Array<SectionDefinition<any>>\r\n  ) { }\r\n\r\n  /**\r\n   * Loops all Sections and finally returns the data structure.\r\n   */\r\n  public make(): AbstractModel {\r\n    this.allSez.forEach(sez => this.buildSez<typeof sez>(sez));\r\n    return this.ds;\r\n  }\r\n\r\n  /**\r\n   * Builds the actual Section to be added to data structure.\r\n   */\r\n  private buildSez<T>(sezParams: SectionDefinition<T>): void {\r\n    const sez = new SezBuilder<T>(\r\n      this.allSez,\r\n      sezParams.name,\r\n      sezParams.fields,\r\n      sezParams.jsonFields,\r\n      sezParams.pk,\r\n      sezParams.indexes,\r\n      sezParams.orderBy,\r\n      sezParams.childOf,\r\n      sezParams.parentsIdentifiers,\r\n      sezParams.ownerIdentifier\r\n    ).make();\r\n    this.addToTempDs(sez);\r\n  }\r\n\r\n  /**\r\n   * Adds a Section to the class property `ds` using `name` as key.\r\n   */\r\n  private addToTempDs<T>(sez: SectionModel<T>): void {\r\n    this.ds[sez.name] = sez;\r\n  }\r\n\r\n}\r\n","import { AUDS_SYSTEM_SECTIONS_DEFINITIONS } from 'app/data/system-local-db/auds-system-sections.enum';\r\nimport { DataStructureBuilder } from 'app/libs/db-connector/db-builder/data-structure-builder.class';\r\nimport { SectionDefinition } from 'app/libs/db-connector/db-builder/sez-definition';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport {\r\n  DbConnectorInstance,\r\n  DbObjects,\r\n  DbStoreInterface,\r\n  Deletor,\r\n  DsDbInitOptions,\r\n  Insertor,\r\n  Selector,\r\n  Updator\r\n  } from 'app/libs/db-connector/models/executers';\r\n\r\n/**\r\n *  Initialize `db-connector` for the given storage (MySQL, IndexedDB, etc.)\r\n *\r\n * @param executers The plugin implementing the read/write operations on the DB\r\n * @param [options={}] Initialization options of the DB. These very depending on the plugin requirements (e.g. connection parameters)\r\n * @param [allSez] section definitions defining the data structure of the DB\r\n * @param [addSystemSections=true] whether to automatically build the data structure for system sections (`_settings` and `_sections`)\r\n */\r\nexport class DbConnector<DbTypes> implements DbConnectorInstance<DbTypes> {\r\n\r\n  public dbStore: DbStoreInterface<DbTypes>;\r\n  public DS: AbstractModel = {};\r\n\r\n  constructor(\r\n    private executers: DbObjects<unknown, DbTypes>,\r\n    public options: DsDbInitOptions = {},\r\n    private allSez: Array<SectionDefinition<any>> = [],\r\n    private addSystemSections: boolean = true\r\n  ) { }\r\n\r\n  public async init(): Promise<DbConnectorInstance<DbTypes>> {\r\n\r\n    if (this.addSystemSections)\r\n      this.DS = Object.assign(this.DS, new DataStructureBuilder(AUDS_SYSTEM_SECTIONS_DEFINITIONS).make());\r\n\r\n    if (this.allSez.length)\r\n      this.DS = Object.assign(this.DS, new DataStructureBuilder(this.allSez).make());\r\n\r\n    if (this.options.DS)\r\n      this.DS = Object.assign(this.DS, this.options.DS);\r\n\r\n    if (this.executers.dbStore)\r\n      this.dbStore = await new this.executers.dbStore(this.options, this.DS).initDB();\r\n    else\r\n      throw new Error('No dbStore passed to DbConnector. To initialize DbConnector, you must pass a valid dbStore');\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Ready to call function that returns an instance of the insertor of the plugin passed to DbInit.\r\n   * @param section the section on which to perform the query.\r\n   * @param element the alement to insert in the DB.\r\n   * @returns an instance of insertor (don't forget to call `autoInsert`)\r\n   */\r\n  public callInsertor<E>(section: keyof AbstractModel, element: E): Insertor<E> {\r\n    return new this.executers.insertor(this, section, element);\r\n  }\r\n\r\n  /**\r\n   * Ready to call function that returns an instance of the selector of the plugin passed to DbInit.\r\n   * @param section the section on which to perform the query.\r\n   * @param args the arguments to build the query.\r\n   * @returns an instance of selector (don't forget to call `single` or `multiple` or `count`)\r\n   */\r\n  public callSelector<E>(section: keyof AbstractModel, args?: Partial<E>): Selector<E> {\r\n    return new this.executers.selector(this, section, args) as Selector<E>;\r\n  }\r\n\r\n  /**\r\n   * Ready to call function that returns an instance of the updator of the plugin passed to DbInit.\r\n   * @param section the section on which to perform the query.\r\n   * @param args the element to update in the DB.\r\n   * @returns an instance of updator (don't forget to call `autoUpdate`)\r\n   */\r\n  public callUpdator<E>(section: keyof AbstractModel, element: Partial<E>): Updator<E> {\r\n    return new this.executers.updator(this, section, element);\r\n  }\r\n\r\n  /**\r\n   * Ready to call function that returns an instance of the deletor of the plugin passed to DbInit.\r\n   * @param section the section on which to perform the query.\r\n   * @param args the arguments to build the query.\r\n   * @returns an instance of deletor (don't forget to call `autoDelete`)\r\n   */\r\n  public callDeletor<E>(section: keyof AbstractModel, args: Partial<E>): Deletor<E> {\r\n    return new this.executers.deletor(this, section, args);\r\n  }\r\n\r\n}\r\n","import { Section, SectionElement } from 'app/data/project-structure/project-info';\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { SezBuilder } from 'app/libs/db-connector/db-builder/sez-builder.class';\r\nimport { SectionDefinition, SectionModel } from 'app/libs/db-connector/db-builder/sez-definition';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\n\r\n/**\r\n * Converts the abstract definition of a Section into a complete datastructure that can be processed by FormDataParserService\r\n *\r\n * @see FormDataParserService\r\n */\r\nexport class DataStructureExtender {\r\n\r\n  /**\r\n   * Temporarly stores all the sections defined by `buildSectionDefinition`\r\n   *\r\n   * @see buildSectionDefinition\r\n   */\r\n  public allSez: Array<SectionDefinition<SectionElement>> = [];\r\n\r\n  private datastructure: AbstractModel = {};\r\n\r\n  constructor(\r\n    private sections: Array<Section>\r\n  ) { }\r\n\r\n  /**\r\n   * First calls `cleanDataStructure` if a previous project was set.\r\n   * Then builds all sections definitions with `buildSectionDefinition`.\r\n   * Finally calls `buildAndAddAllSections` to build the full section and add it to the datastructure.\r\n   */\r\n  public extend(): AbstractModel {\r\n    this.sections.forEach(section => this.buildSectionDefinition(section));\r\n    this.allSez.forEach(sezDefinition => this.buildAndAddAllSections(sezDefinition));\r\n    return this.datastructure;\r\n  }\r\n\r\n  /**\r\n   * Builds a contant with the specifications of a Section starting from the structure defined by the user.\r\n   */\r\n  private buildSectionDefinition(section: Section): void {\r\n    const sezDefinition: SectionDefinition<SectionElement> = {\r\n      name: section.id,\r\n      fields: Object.values(RESERVED_FIELDS),\r\n      jsonFields: [RESERVED_FIELDS.parentsInfo]\r\n    };\r\n    section.formModel.forEach(field => {\r\n      sezDefinition.fields.push(field.fieldName);\r\n    });\r\n\r\n    this.allSez.push(sezDefinition);\r\n  }\r\n\r\n  /**\r\n   * Starting from the definition of the Section, builds a full model of the Section and adds it to the datastructure.\r\n   */\r\n  private buildAndAddAllSections(sezDefinition: SectionDefinition<SectionElement>): void {\r\n    const sez = new SezBuilder<SectionElement>(\r\n      this.allSez,\r\n      sezDefinition.name,\r\n      sezDefinition.fields\r\n    ).make();\r\n    this.addToTempTs(sez);\r\n  }\r\n\r\n  /**\r\n   * Creates a new key on the datastructure and sets on it the model of the section.\r\n   */\r\n  private addToTempTs(sez: SectionModel<SectionElement>): void {\r\n    this.datastructure[sez.name] = sez;\r\n  }\r\n\r\n}\r\n","import { AdditionalInfoForLocalStorage, RESERVED_AUDS_KEYS, SystemData } from 'app/data/project-structure/project-info'\r\nimport { DataStructureExtender } from 'app/data/system-local-db/data-structure-extender.class'\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model'\r\nimport { DbStoreInterface, DsDbInitOptions } from 'app/libs/db-connector/models/executers'\r\nimport Dexie, { Version } from 'dexie'\r\n\r\n/**\r\n * Implementation of DbStore for IndexedDB with Dexie.\r\n */\r\nexport class DbStore implements DbStoreInterface<Dexie> {\r\n\r\n  public db: Dexie;\r\n  private deletedSections: Array<string> = [];\r\n\r\n  constructor(\r\n    private options: DsDbInitOptions,\r\n    private DS: AbstractModel\r\n  ) { }\r\n\r\n  public async initDB(): Promise<DbStoreInterface<Dexie>> {\r\n\r\n    if (!this.options.indexedDbName)\r\n      throw Error('No name found in DsDbInitOptions. Please provide a name for the database by setting the name on the property indexedDbName in the options passed to DbConnector.');\r\n\r\n    this.setDb();\r\n\r\n    if (!this.options.previousVersions)\r\n      this.options.previousVersions = [];\r\n\r\n    this.handlePreviousVersion();\r\n\r\n    this.buildDb();\r\n\r\n    return this;\r\n  }\r\n\r\n  public async postProjectCreation(): Promise<AdditionalInfoForLocalStorage> {\r\n    return this.makeDexieInfoForUpgrade();\r\n  }\r\n\r\n  public async postProjectUpdate(project: SystemData): Promise<AdditionalInfoForLocalStorage> {\r\n    const newSections = Object.keys(project).concat(project[RESERVED_AUDS_KEYS._sections].map(section => section.id));\r\n    const oldSections = Object.keys(this.DS);\r\n\r\n    // Check if any section in oldSections has been deleted, or if any section in newSections has been added\r\n    const sectionsToDelete = oldSections.filter(section => !newSections.includes(section));\r\n    const sectionsToAdd = newSections.filter(section => !oldSections.includes(section));\r\n\r\n    // If there are sections to delete or to add, we push a new array to previousVersions\r\n    // We don't need to store the new sections as Dexie from v.3.0.0 on, will automatically create the new tables\r\n    if (sectionsToDelete.length > 0 || sectionsToAdd.length > 0) {\r\n\r\n      this.options.previousVersions.push(sectionsToDelete.concat());\r\n\r\n      // We need to delete the sections that are not in the DS anymore\r\n      sectionsToDelete.forEach(section => {\r\n        delete this.DS[section];\r\n      });\r\n\r\n      // We need to add the sections that have been added to the DS\r\n      if (sectionsToAdd.length > 0) {\r\n        const newSections = project[RESERVED_AUDS_KEYS._sections].filter(section => sectionsToAdd.includes(section.id));\r\n        Object.assign(this.DS, new DataStructureExtender(newSections).extend());\r\n      }\r\n\r\n      // We need to rebuild the database, see https://dexie.org/docs/Dexie/Dexie.close()\r\n      this.close();\r\n      this.handlePreviousVersion();\r\n      this.buildDb();\r\n      await this.db.open();\r\n    }\r\n\r\n    return this.makeDexieInfoForUpgrade();\r\n  }\r\n\r\n  public close(): void {\r\n    return this.db.close()\r\n  }\r\n\r\n  public onProjectDeleted(): Promise<void> {\r\n    return this.db.delete();\r\n  }\r\n\r\n  private makeDexieInfoForUpgrade(): AdditionalInfoForLocalStorage {\r\n    return { dexieInfoForUpgrade: { previousVersions: this.options.previousVersions, DS: this.DS } };\r\n  }\r\n\r\n\r\n  private setDb(): void {\r\n    this.db = new Dexie(this.options.indexedDbName);\r\n  }\r\n\r\n  // Adds to deletedSections the sections that are not in the DS anymore\r\n  // In buildDb we will delete the sections that are not in the DS anymore\r\n  private handlePreviousVersion(): void {\r\n    this.deletedSections = [];\r\n    this.options.previousVersions.forEach(versionSezs =>\r\n      versionSezs.forEach(section => {\r\n        if (!this.DS[section])\r\n          this.deletedSections.push(section);\r\n      })\r\n    );\r\n  }\r\n\r\n  private buildDb(): Version {\r\n    const version = this.options.previousVersions?.length + 1 || 1;\r\n    const tables = {};\r\n\r\n    for (const section in this.DS)\r\n      tables[this.DS[section].name] = this.DS[section].indexes.join();\r\n\r\n    // Removes the sections that are not in the DS anymore\r\n    // See https://dexie.org/docs/Tutorial/Understanding-the-basics#deleting-tables\r\n    this.deletedSections.forEach(section => tables[section] = null);\r\n\r\n    return this.db.version(version).stores(tables);\r\n  }\r\n\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { NewWhere } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class';\r\n\r\nexport interface BetweenSearchParams {\r\n  field: string;\r\n  lowerBound: string | number;\r\n  upperBound: string | number;\r\n  includeLower: boolean;\r\n  includeUpper: boolean;\r\n}\r\n\r\nexport type SuppoertedOperators = '===' | '!=' | '>' | '>=' | '<' | '<=' | '=';\r\n\r\nexport interface FieldNValues {\r\n  [index: string]: string | number;\r\n}\r\n\r\nexport type Filter4Dexie = (item: Object) => boolean;\r\n\r\n/**\r\n * Support methods to build queries with `QueryMaker` on IndexedDB with Dexie\r\n * \r\n * @see QueryMaker\r\n */\r\nexport class QueryHelper {\r\n\r\n  /**\r\n   * Determines the methods to execute for the select query based on the number of arguments.\r\n   */\r\n  public static methodToExecute(DS: AbstractModel, arraysWhere: Array<NewWhere>, section: keyof AbstractModel): 'dexieFullCollection' | 'dexieBetween' | 'dexieGet' | 'dexieWhere' | 'complexSelect' {\r\n\r\n    const arraysWhereLen = arraysWhere.length;\r\n\r\n    if (!arraysWhereLen)\r\n      return 'dexieFullCollection';\r\n\r\n    // tslint:disable-next-line:max-line-length\r\n    if (arraysWhereLen === 2 && (arraysWhere[0][1] === '>=' || arraysWhere[0][1] === '>') && (arraysWhere[1][1] === '<=' || arraysWhere[1][1] === '<'))\r\n      return 'dexieBetween';\r\n\r\n    if (arraysWhere[0][1] !== '=')\r\n      return 'complexSelect';\r\n\r\n    if (arraysWhereLen === 1 && arraysWhere[0][0] === DS[section].pk)\r\n      return 'dexieGet';\r\n\r\n    if (DS[section].indexes.indexOf(arraysWhere[0][0]) > -1)\r\n      return 'dexieGet';\r\n\r\n    let dexieWhere = true;\r\n\r\n    arraysWhere.forEach(whereArr => {\r\n      if (whereArr[1] !== '=')\r\n        dexieWhere = false;\r\n      if (DS[section].indexes.indexOf(whereArr[0]) < 0)\r\n        dexieWhere = false;\r\n    });\r\n\r\n    if (dexieWhere)\r\n      return 'dexieWhere';\r\n\r\n    return 'complexSelect';\r\n\r\n  }\r\n\r\n  /**\r\n   * Converts an Array of where arguments (field, operator, value) to an object with field and value\r\n   */\r\n  public static buildArrayFildsNValues(arraysWhere: Array<NewWhere>): FieldNValues {\r\n    const objFieldsNValues: FieldNValues = {};\r\n\r\n    arraysWhere.forEach(arrSearch => {\r\n      objFieldsNValues[arrSearch[0]] = arrSearch[2];\r\n    });\r\n\r\n    return objFieldsNValues;\r\n\r\n  }\r\n\r\n  /**\r\n   * Builds between search params, optionally including upper or lower boundary\r\n   */\r\n  public static buildBetweenSearchParams(arraysWhere: Array<NewWhere>): BetweenSearchParams {\r\n    const includeLower = (arraysWhere[0][1] === '>=') ? true : false;\r\n    const includeUpper = (arraysWhere[1][1] === '<=') ? true : false;\r\n    return {\r\n      field: arraysWhere[0][0],\r\n      lowerBound: arraysWhere[0][2],\r\n      upperBound: arraysWhere[1][2],\r\n      includeLower: includeLower,\r\n      includeUpper: includeUpper\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Builds the filter to select elements for complex queries not supported by Dexie due to IndexedDB limits\r\n   */\r\n  public static buildFilter4Dexie(filter: NewWhere): Filter4Dexie {\r\n    const field = filter[0];\r\n    const operator = filter[1];\r\n    const value = filter[2];\r\n    return (item): boolean => {\r\n      switch (operator) {\r\n        case '===':\r\n          return item[field] === value;\r\n        case '!=':\r\n          // eslint-disable-next-line eqeqeq\r\n          return item[field] != value;\r\n        case '>':\r\n          return item[field] > value;\r\n        case '>=':\r\n          return item[field] >= value;\r\n        case '<':\r\n          return item[field] > value;\r\n        case '<=':\r\n          return item[field] <= value;\r\n        default:\r\n          // eslint-disable-next-line eqeqeq\r\n          return item[field] == value;\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Chains filters\r\n   */\r\n  public static chainFilters(where: Array<Filter4Dexie>, logic: 'AND' | 'OR'): Filter4Dexie {\r\n    return (item): boolean => {\r\n      if (!where.length)\r\n        return true;\r\n\r\n      let result: boolean = where[0](item);\r\n\r\n      for (const filter of where)\r\n        switch (logic) {\r\n          case 'OR':\r\n            result = result || filter(item);\r\n            break;\r\n          default:\r\n            result = result && filter(item);\r\n        }\r\n\r\n      return result;\r\n    };\r\n  }\r\n\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { Filter4Dexie, QueryHelper, SuppoertedOperators } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-helper.class';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport Dexie from 'dexie';\r\n\r\nexport type NewWhere = [string, SuppoertedOperators, string | number];\r\n\r\n/**\r\n * Builds queries to be executed with Dexie\r\n */\r\nexport class QueryMaker<E> {\r\n\r\n  private logic: 'AND' | 'OR' = 'AND';\r\n  private table: string;\r\n  private collection;\r\n  private dexieFilters: Array<Filter4Dexie> = [];\r\n  private arrWhere: Array<NewWhere> = [];\r\n  private orderBy: string;\r\n  private debug = false;\r\n\r\n  /**\r\n   * Creates an instance of query maker.\r\n   * @param section the section name (aka table) on which to run the query\r\n   * @param [element] optional element on which to perform the query\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Dexie>,\r\n    private section: keyof AbstractModel,\r\n    private element?: E\r\n  ) {\r\n    this.table = this.dbConnector.DS[this.section].name;\r\n    this.collection = this.dbConnector.dbStore.db[this.table];\r\n  }\r\n\r\n  /**\r\n   * Adds a where clause to `arrWhere`\r\n   */\r\n  public addWhere(new_where: NewWhere): QueryMaker<E> {\r\n    this.arrWhere.push(new_where);\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets the logic to OR\r\n   */\r\n  public setOrLogic(): QueryMaker<E> {\r\n    this.logic = 'OR';\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets the orderBy property\r\n   */\r\n  public setOrderBy(order: string): void {\r\n    this.orderBy = order;\r\n  }\r\n\r\n  // SELECT\r\n\r\n  /**\r\n   * Determines which method to execute and then performs the select operation \r\n   */\r\n  public async select(): Promise<Array<E>> {\r\n\r\n    if (this.logic !== 'AND')\r\n      return this.complexSelect();\r\n\r\n    const methodToExecute = QueryHelper.methodToExecute(this.dbConnector.DS, this.arrWhere, this.section);\r\n\r\n    this.handleDebug('SELECT', 'methodToExecute', methodToExecute);\r\n\r\n    return this[methodToExecute]();\r\n  }\r\n\r\n  /**\r\n   * Select with Dexie.get\r\n   */\r\n  private async dexieGet(): Promise<Array<E>> {\r\n    const objSearch = {};\r\n    objSearch[this.arrWhere[0][0]] = this.arrWhere[0][2];\r\n    const res = await this.dbConnector.dbStore.db[this.table].get(objSearch);\r\n    const eleToReturn = res ? [res] : [];\r\n    return eleToReturn;\r\n  }\r\n\r\n  /**\r\n   * Selects using the where method of Dexie\r\n   */\r\n  private async dexieWhere(): Promise<Array<E>> {\r\n    const fieldNValues = QueryHelper.buildArrayFildsNValues(this.arrWhere);\r\n    return this.dbConnector.dbStore.db[this.table].where(fieldNValues).toArray();\r\n  }\r\n\r\n  /**\r\n   * Select between two values with Dexie\r\n   */\r\n  private async dexieBetween(): Promise<Array<E>> {\r\n    const betweenSearchParams = QueryHelper.buildBetweenSearchParams(this.arrWhere);\r\n    return this.dbConnector.dbStore.db[this.table].where(betweenSearchParams.field)\r\n      .between(betweenSearchParams.lowerBound, betweenSearchParams.upperBound, betweenSearchParams.includeLower, betweenSearchParams.includeUpper)\r\n      .toArray();\r\n  }\r\n\r\n  /**\r\n   * Gets entire collection with Dexie\r\n   */\r\n  private async dexieFullCollection(): Promise<Array<E>> {\r\n    return this.dbConnector.dbStore.db[this.table].toArray();\r\n  }\r\n\r\n  /**\r\n   * Performs a comples select action that is not supported natively by IndexedDB (and so Dexie)\r\n   */\r\n  private complexSelect(): Promise<Array<E>> {\r\n\r\n    this.arrWhere.forEach(arrWhere =>\r\n      this.dexieFilters.push(QueryHelper.buildFilter4Dexie(arrWhere))\r\n    );\r\n\r\n    let all_records = this.dbConnector.dbStore.db[this.table].toCollection();\r\n    const filter = QueryHelper.chainFilters(this.dexieFilters, this.logic);\r\n    all_records = all_records.and(filter);\r\n\r\n    this.handleDebug('SELECT', 'WHERE', this.arrWhere);\r\n\r\n    if (this.orderBy)\r\n      return all_records.sortBy(this.orderBy);\r\n\r\n    return all_records.toArray();\r\n  }\r\n\r\n  // INSERT\r\n\r\n  /**\r\n   * Inserts a new element using `put` method of Dexie\r\n   */\r\n  public async insert(): Promise<void> {\r\n    this.handleDebug('INSERT', 'WITH OBJECT', this.element);\r\n\r\n    await this.dbConnector.dbStore.db[this.table].put(this.element);\r\n  }\r\n\r\n  // UPDATE\r\n\r\n  /**\r\n   * Updates and element using the `update` method of Dexie\r\n   */\r\n  public async update(): Promise<void> {\r\n\r\n    this.handleDebug('UPDATE', 'WITH OBJECT', this.element);\r\n\r\n    await this.dbConnector.dbStore.db[this.table].update(this.element[this.dbConnector.DS[this.section].pk], this.element);\r\n  }\r\n\r\n  // COUNT\r\n\r\n  /**\r\n   * Counts the number of items in a collection with Dexie\r\n   */\r\n  public count(): Promise<number> {\r\n    return this.collection.count();\r\n  }\r\n\r\n  // DELETE\r\n\r\n  /**\r\n   * Deletes one or more elements with the `where` clause of Dexie\r\n   */\r\n  public async delete(): Promise<void> {\r\n\r\n    const fieldNValues = QueryHelper.buildArrayFildsNValues(this.arrWhere);\r\n\r\n    this.handleDebug('DELETE', 'WHERE', this.arrWhere);\r\n\r\n    await this.dbConnector.dbStore.db[this.table].where(fieldNValues).delete();\r\n\r\n  }\r\n\r\n  /**\r\n   * Clears the entire db!!!\r\n   */\r\n  public async clearDb(): Promise<void> {\r\n    const promises = [];\r\n    for (const section in this.dbConnector.DS)\r\n      if (this.dbConnector.DS[section].name) promises.push(this.dbConnector.dbStore.db[this.dbConnector.DS[section].name].clear());\r\n\r\n    await Promise.all(promises);\r\n  }\r\n\r\n  /**\r\n   * Clears an entire table!!!\r\n   */\r\n  public async clearTable(): Promise<void> {\r\n    await this.dbConnector.dbStore.db[this.table].clear();\r\n  }\r\n\r\n  /**\r\n   * Logs useful information in the console if `debug` is true\r\n   */\r\n  private handleDebug<T>(action: string, typeToShow: string, toShow: T): void {\r\n    if (this.debug)\r\n      Logger.raw(`EXECUTING ${action} FOR TABLE ${this.table} ${typeToShow} `, toShow);\r\n  }\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Deletor } from 'app/libs/db-connector/models/executers';\r\nimport { QueryMaker } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport Dexie from 'dexie';\r\n\r\n/**\r\n * Implements the deletor for IndexedDB\r\n */\r\nexport class DbDeletor<E> implements Deletor<E> {\r\n\r\n  /**\r\n   * Creates an instance of db deletor.\r\n   * @param section the section of the element to delete\r\n   * @param args the arguments for the query, must include the primary key (`pk`) value\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Dexie>,\r\n    private section: keyof AbstractModel,\r\n    private args: Partial<E>\r\n  ) { }\r\n\r\n  /**\r\n   * Perform the delete action on the given element.\r\n   */\r\n  public async autoDelete(): Promise<void> {\r\n    if (this.args[this.dbConnector.DS[this.section].pk]) {\r\n      const aliasElementToDelete = this.args[this.dbConnector.DS[this.section].pk];\r\n      await new QueryMaker(this.dbConnector, this.section)\r\n        .addWhere([this.dbConnector.DS[this.section].pk as string, '=', aliasElementToDelete])\r\n        .delete();\r\n    } else\r\n      Logger.error('Error in autoDelete', 'No PK value was found on the element');\r\n  }\r\n\r\n  public async clearSection(): Promise<void> {\r\n    await new QueryMaker(this.dbConnector, this.section)\r\n      .clearTable();\r\n  }\r\n\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Insertor } from 'app/libs/db-connector/models/executers';\r\nimport { QueryMaker } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport Dexie from 'dexie';\r\n\r\n/**\r\n * Implements insertor for IndexedDB\r\n */\r\nexport class DbInsertor<E> implements Insertor<E> {\r\n\r\n  /**\r\n   * Creates an instance of db insertor.\r\n   * @param section the section in which to insert the new element\r\n   * @param element the element to insert\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Dexie>,\r\n    private section: keyof AbstractModel,\r\n    private element: Array<E> | E\r\n  ) { }\r\n\r\n  /**\r\n   * Makes sure that all necessary fields are set and performs the insert\r\n   */\r\n  public autoInsert(): Promise<void> {\r\n    if (this.element instanceof Array) {\r\n      return this.insertMany();\r\n    } else {\r\n      return this.insertOne();\r\n    }\r\n  }\r\n\r\n  private insertMany(): Promise<void> {\r\n    const table = this.dbConnector.DS[this.section].name;\r\n    return this.dbConnector.dbStore.db[table].bulkPut(this.element);\r\n  }\r\n\r\n\r\n  private insertOne(): Promise<void> {\r\n    return new QueryMaker(this.dbConnector, this.section, this.element)\r\n      .insert()\r\n      .catch(err => { Logger.error('Error in autoinsert: ', err); });\r\n  }\r\n\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Selector } from 'app/libs/db-connector/models/executers';\r\nimport { QueryMaker } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class';\r\nimport Dexie from 'dexie';\r\n\r\n/**\r\n * Implements selector for IndexedDB\r\n */\r\nexport class DbSelector<E> implements Selector<E> {\r\n  private data: Array<E> = [];\r\n  private qe: QueryMaker<E>;\r\n\r\n  /**\r\n   * Creates an instance of db selector.\r\n   * @param section the section from which to query data\r\n   * @param [args] the optional arguments of the query\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Dexie>,\r\n    private section: keyof AbstractModel,\r\n    private args?: Partial<E>\r\n  ) { }\r\n\r\n  /**\r\n   * Retrieves only one element\r\n   */\r\n  public async single(): Promise<E> {\r\n    this.setUpSelect();\r\n    this.setQuery();\r\n    await this.executeSelect();\r\n\r\n    return this.data[0];\r\n  }\r\n\r\n  /**\r\n   * Retrieves multiple elements, returns them in an `Array`\r\n   */\r\n  public async multiple(): Promise<Array<E>> {\r\n    this.setUpSelect();\r\n    this.setQuery();\r\n    this.setOrder();\r\n\r\n    await this.executeSelect();\r\n\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Counts all elements in the section\r\n   * \r\n   * @remarks does not take into consideration argumeents\r\n   */\r\n  public async count(): Promise<number> {\r\n    return new QueryMaker(this.dbConnector, this.section).count();\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of `QueryMaker`\r\n   * \r\n   * @see QueryMaker\r\n   */\r\n  private setUpSelect(): void {\r\n    this.qe = new QueryMaker(this.dbConnector, this.section);\r\n  }\r\n\r\n  /**\r\n   * If the `pk` value is set, it is added as a query argument\r\n   */\r\n  private setQuery(): void {\r\n    if (!this.args)\r\n      return;\r\n\r\n    if (this.args[this.dbConnector.DS[this.section].pk])\r\n      this.qe.addWhere([this.dbConnector.DS[this.section].pk, '=', this.args[this.dbConnector.DS[this.section].pk]]);\r\n  }\r\n\r\n  /**\r\n   * Sets the order of the results\r\n   */\r\n  private setOrder(): void {\r\n    this.qe.setOrderBy(this.dbConnector.DS[this.section].orderBy);\r\n  }\r\n\r\n  /**\r\n   * Executes the select command\r\n   */\r\n  private async executeSelect(): Promise<void> {\r\n    this.data = await this.qe.select();\r\n  }\r\n\r\n}\r\n","import { DbObjects } from 'app/libs/db-connector/models/executers';\r\nimport { DbStore } from 'app/libs/db-connector/plugins/indexed-db/db-store/dbstore.class';\r\nimport Dexie from 'dexie';\r\nimport { DbDeletor } from './db-deletor/db-deletor.class';\r\nimport { DbInsertor } from './db-insertor/db-insertor.class';\r\nimport { DbSelector } from './db-selector/db-selector.class';\r\nimport { DbUpdator } from './db-updator/db-updator.class';\r\n\r\n/**\r\n * Constant to be passed to DbInit to use IndexedDB as plugin\r\n */\r\nexport const INDEXEDDB_PLUGIN: DbObjects<any, Dexie> = {\r\n  insertor: DbInsertor,\r\n  selector: DbSelector,\r\n  updator: DbUpdator,\r\n  deletor: DbDeletor,\r\n  dbStore: DbStore\r\n};\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Updator } from 'app/libs/db-connector/models/executers';\r\nimport { QueryMaker } from 'app/libs/db-connector/plugins/indexed-db/query-makers/query-maker.class';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport Dexie from 'dexie';\r\n\r\n/**\r\n * Implements updator for IndexedDb\r\n */\r\nexport class DbUpdator<E> implements Updator<E> {\r\n\r\n  /**\r\n   * Creates an instance of db updator.\r\n   * @param section the section of the element to update\r\n   * @param element the full element updated\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Dexie>,\r\n    private section: keyof AbstractModel,\r\n    private element: Partial<E>\r\n  ) { }\r\n\r\n  /**\r\n   * Calls `QueryMaker` and updates the element\r\n   */\r\n  public autoUpdate(): Promise<void> {\r\n    return new QueryMaker(this.dbConnector, this.section, this.element)\r\n      .update()\r\n      .catch(err => { Logger.error('Error in autoUpdate', err); });\r\n  }\r\n\r\n}\r\n","import { Action } from 'app/libs/redux/action.type'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { store } from 'app/libs/redux/state.store'\r\n\r\nexport function storeDispatcher<T extends REDUX_ACTIONS>(action: Action<T>): void {\r\n  store.dispatch(action);\r\n}","import { dbInstances } from 'app/data/local-dbs/db-instances.const'\r\nimport { LocalProjectSettings } from 'app/data/project-structure/project-info'\r\nimport { CLIENT_SECTIONS } from 'app/data/system-local-db/client-sections.enum'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\n\r\n/**\r\n * Loads the list of projects on the current device\r\n */\r\nexport class ProjectsListLoader {\r\n\r\n  /**\r\n   * The list of projects to sore in the current state\r\n   */\r\n  private projectList: Array<LocalProjectSettings> = [];\r\n\r\n  /**\r\n   * Loads the projects from IndexedDB and adds them to the current state\r\n   */\r\n  public async load(): Promise<void> {\r\n    await this.loadFromLocalDB();\r\n    this.dispatchProjectList(this.projectList);\r\n  }\r\n\r\n  /**\r\n   * Loads the projects from IndexedDB with db-connector\r\n   */\r\n  private async loadFromLocalDB(): Promise<void> {\r\n    this.projectList = await dbInstances.system.callSelector<LocalProjectSettings>(CLIENT_SECTIONS.projects).multiple();\r\n  }\r\n\r\n  /**\r\n   * Dispatchs the project list to the current state\r\n   */\r\n  private dispatchProjectList(payload: Array<LocalProjectSettings>): void {\r\n    storeDispatcher(({ type: REDUX_ACTIONS.setProjectList, payload }));\r\n  }\r\n\r\n}\r\n","export enum EDITOR_MODE {\r\n  add = \"add\",\r\n  edit = \"edit\"\r\n}\r\n","import { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\n\r\nexport enum URL_PARAMS {\r\n  projectId = 'projectId',\r\n  sectionId = 'sectionId',\r\n  elementId = 'elementId',\r\n  parentId = 'parentId'\r\n}\r\n\r\n/**\r\n * Lists all the routes in the application\r\n * \r\n * @remarks We can't use the enum approach here because we need to concat strings.\r\n */\r\nexport const ANITA_URLS = {\r\n  // PROJECTS\r\n  projectsNone: '/projects/none',\r\n  projectsList: '/projects/list',\r\n  projectAdd: `/projects/${EDITOR_MODE.add}`,\r\n  projectEdit: `/projects/${EDITOR_MODE.edit}/:${URL_PARAMS.projectId}`,\r\n  // PROJECT\r\n  projectDetails: `/project/:${URL_PARAMS.projectId}/info`,\r\n  projectSectionElesList: `/project/:${URL_PARAMS.projectId}/list/:${URL_PARAMS.sectionId}`,\r\n  projectSectionAddEle: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/${EDITOR_MODE.add}`,\r\n  projectSectionEditEle: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/${EDITOR_MODE.edit}/:${URL_PARAMS.elementId}`,\r\n  projectSectionEleDetails: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/details/:${URL_PARAMS.elementId}`,\r\n}\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { CLIENT_SEZ_DEFINITIONS, previousVersions } from 'app/data/system-local-db/client-sections.enum';\r\nimport { DbConnector } from 'app/libs/db-connector/db-connector.class';\r\nimport { INDEXEDDB_PLUGIN } from 'app/libs/db-connector/plugins/indexed-db/exporter.constant';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport { ProjectsListLoader } from 'app/libs/projects-helpers/projects-handlers/projects-list-loader.class';\r\nimport React from 'react';\r\n\r\nexport class Startupper {\r\n\r\n  /**\r\n   * The name of the IndexedDB for system data\r\n   */\r\n  private systemDbName = 'anitaDB';\r\n\r\n  public async init(): Promise<void> {\r\n    Logger.info('Anita web app.');\r\n    await this.initSystemIndexedDb(this.systemDbName);\r\n    this.setLoggerDebug();\r\n    this.loadProjectList();\r\n  }\r\n\r\n  /**\r\n   * Inits IndexedDB for system data\r\n   */\r\n  private async initSystemIndexedDb(indexedDbName: string): Promise<void> {\r\n    dbInstances.system = await new DbConnector(INDEXEDDB_PLUGIN, { previousVersions, indexedDbName }, CLIENT_SEZ_DEFINITIONS, false).init();\r\n  }\r\n\r\n  /**\r\n   * Detect if React is in development mode\r\n   */\r\n  private isReactDev(): boolean {\r\n    return '_self' in React.createElement('div');\r\n  }\r\n\r\n  /**\r\n   * Sets logger debug\r\n   */\r\n  private setLoggerDebug(): void {\r\n    Logger.debug = this.isReactDev();\r\n  }\r\n\r\n  /**\r\n   * We need to load the project list for the project selector\r\n   */\r\n  private loadProjectList(): void {\r\n    new ProjectsListLoader().load();\r\n  }\r\n\r\n}","import {\r\n  FileSystemDirectoryHandle,\r\n  FileSystemFileHandle,\r\n  FileSystemWriteChunkType,\r\n  WindowFS\r\n  } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\n\r\ndeclare const window: WindowFS;\r\n\r\n/**\r\n * Open a handle to an existing file on the local file system.\r\n */\r\nexport function getFileHandle(): Promise<Array<FileSystemFileHandle>> {\r\n  return window.showOpenFilePicker({ multiple: false });\r\n}\r\n\r\n/**\r\n * Open a handle to an existing file on the local file system.\r\n */\r\nexport function getDirectoryHandle(): Promise<FileSystemDirectoryHandle> {\r\n  return window.showDirectoryPicker();\r\n}\r\n\r\n/**\r\n * Reads the file content from a fileHandle and returns it as a string.\r\n */\r\nexport async function readFileHandleAsText(fileHandle: FileSystemFileHandle): Promise<string> {\r\n  const file = await fileHandle.getFile() as any; // as any because .text not yet documented in TS\r\n  return file.text();\r\n}\r\n\r\n/**\r\n * Reads the file content from a fileHandle and returns it as a Uint8Array.\r\n */\r\nexport async function readDirFileAsUint8Array(dirHandle: FileSystemDirectoryHandle, fileName: string): Promise<Uint8Array> {\r\n  const fileHandle = await dirHandle.getFileHandle(fileName, { create: true });\r\n  const file = await fileHandle.getFile();\r\n  const arrayBuffer = await file.arrayBuffer();\r\n  return new Uint8Array(arrayBuffer);\r\n}\r\n\r\n/**\r\n * Create a handle to a new (text) file on the local file system.\r\n */\r\nexport function getNewFileHandle(\r\n  name: string = '',\r\n  description: string = 'Anita project data file',\r\n  accept: { [mimeType: string]: Array<string> } = { 'application/json': ['.json'] }\r\n): Promise<FileSystemFileHandle> {\r\n  const opts = {\r\n    types: [{\r\n      name,\r\n      description,\r\n      accept\r\n    }]\r\n  };\r\n  return window.showSaveFilePicker(opts);\r\n}\r\n\r\n/**\r\n * Reads the raw text from a file.\r\n */\r\nexport function readFile(file: any): Promise<string> {\r\n  // If the new .text() reader is available, use it.\r\n  if (file.text) {\r\n    return file.text();\r\n  }\r\n  // Otherwise use the traditional file reading technique.\r\n  return _readFileLegacy(file) as Promise<string>;\r\n}\r\n\r\n/**\r\n * Reads the raw text from a file.\r\n */\r\nfunction _readFileLegacy(file: any): Promise<string> {\r\n  return new Promise(resolve => {\r\n    const reader = new FileReader();\r\n    reader.addEventListener('loadend', e => {\r\n      const text = e.target.result;\r\n      resolve(text as string);\r\n    });\r\n    reader.readAsText(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Writes the contents to disk.\r\n */\r\nexport async function writeFile(fileHandle: FileSystemFileHandle, contents: FileSystemWriteChunkType): Promise<void> {\r\n  // For Chrome 83 and later.\r\n  // Create a FileSystemWritableFileStream to write to.\r\n  const writable = await fileHandle.createWritable();\r\n  // Write the contents of the file to the stream.\r\n  await writable.write(contents);\r\n  // Close the file and write the contents to disk.\r\n  await writable.close();\r\n}\r\n\r\n/**\r\n * Verify the user has granted permission to read or write to the file, if\r\n * permission hasn't been granted, request permission.\r\n */\r\nexport async function verifyPermission(fileHandle: FileSystemFileHandle, withWrite: boolean): Promise<boolean> {\r\n  const opts = {} as any;\r\n  if (withWrite) {\r\n    opts.writable = true;\r\n    opts.mode = 'readwrite';\r\n  }\r\n  // Check if we already have permission, if so, return true.\r\n  if (await fileHandle.queryPermission(opts) === 'granted') {\r\n    return true;\r\n  }\r\n  // Request permission to the file, if the user grants permission, return true.\r\n  if (await fileHandle.requestPermission(opts) === 'granted') {\r\n    return true;\r\n  }\r\n  // The user did nt grant permission, return false.\r\n  return false;\r\n}\r\n","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { writeFile } from 'app/libs/db-connector/plugins/file-handles/helpers/fs-helper';\r\n\r\n/**\r\n * Saves the `AnitaUniversalDataStorage` to the file a file on disk by using the fileHandle stored in this.dbConnector.options.projectInfo.fileHandle.\r\n *\r\n * @see SaveProjectSettingsInIndexedDB\r\n */\r\nexport class ProjectFileHandleSaver {\r\n\r\n  /**\r\n   * The string data to sabe in the file on disk\r\n   */\r\n  private data: string;\r\n\r\n  /**\r\n   * Creates an instance of project file handle saver.\r\n   * @param projectData full data of the project to be saved\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<AnitaUniversalDataStorage>\r\n  ) { }\r\n\r\n  /**\r\n   * Saves the project both on file and in IndexedDB\r\n   */\r\n  public async save(): Promise<void> {\r\n    this.setData();\r\n    await this.saveDataToDisk();\r\n  }\r\n\r\n  /**\r\n   * Converts the project data to string\r\n   */\r\n  private setData(): void {\r\n    this.data = JSON.stringify(this.dbConnector.dbStore.db);\r\n  }\r\n\r\n  /**\r\n   * Actually saves the data to disk by calling writeFile\r\n   * \r\n   * @see writeFile\r\n   */\r\n  private saveDataToDisk(): Promise<void> {\r\n    return writeFile(this.dbConnector.options.projectInfo.fileHandle, this.data);\r\n  }\r\n\r\n}\r\n","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Deletor } from 'app/libs/db-connector/models/executers';\r\nimport { ProjectFileHandleSaver } from 'app/libs/db-connector/plugins/file-handles/helpers/project-file-handle-saver.class';\r\n\r\n/**\r\n * Implements deletor for MySql\r\n */\r\nexport class DbDeletor<E> implements Deletor<E> {\r\n\r\n  /**\r\n   * Creates an instance of db deletor.\r\n   * @param section the section on which to perform the query\r\n   * @param args the args of the query\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<AnitaUniversalDataStorage>,\r\n    private section: keyof AbstractModel,\r\n    private args: Partial<E>\r\n  ) { }\r\n\r\n  /**\r\n   * Deletes an element from the collection\r\n   */\r\n  public async autoDelete(): Promise<any> {\r\n\r\n    if (!Object.keys(this.args).length)\r\n      return 'Fatal error: trying to delete without any parameter';\r\n\r\n    const indexElement = this.dbConnector.dbStore.db[this.section].findIndex(ele => ele.id === this.args['id']);\r\n    // Remove the element from the collection\r\n    this.dbConnector.dbStore.db[this.section].splice(indexElement, 1);\r\n    await new ProjectFileHandleSaver(this.dbConnector).save();\r\n  }\r\n\r\n  public async clearSection(): Promise<void> {\r\n    this.dbConnector.dbStore.db[this.section].length = 0;\r\n    await new ProjectFileHandleSaver(this.dbConnector).save();\r\n  }\r\n\r\n}\r\n","/**\r\n * Algorithm used for encryption.\r\n */\r\nexport const securePassEncrypter = '286b88f2ceb76ce1e7d28117bb2a7659';\r\n","import CryptoES from 'crypto-es';\r\n\r\n/**\r\n * Encrypts a string\r\n *\r\n * @param value the value to encrypt\r\n * @param keyToUse the key to use for encryption\r\n * @return the encrypted string\r\n */\r\nexport function stringCrypter(value: string, keyToUse: string): string {\r\n  const encrypted = CryptoES.AES.encrypt(value, keyToUse);\r\n  return encrypted.toString();\r\n}\r\n","import CryptoES from 'crypto-es';\r\n\r\n/**\r\n * Decrypts a string\r\n *\r\n * @param value the value to decrypt\r\n * @param keyToUse the key to use for decryption\r\n * @return the decrypted string\r\n */\r\nexport function stringDecrypter(value: string, keyToUse: string): string {\r\n  const decrypted = CryptoES.AES.decrypt(value, keyToUse);\r\n  return decrypted.toString();\r\n}\r\n","import { securePassEncrypter } from 'app/libs/db-connector/crypter/options.constant';\r\nimport { stringCrypter } from 'app/libs/db-connector/crypter/string-crypter.function';\r\nimport { stringDecrypter } from 'app/libs/db-connector/crypter/string-decrypter.function';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\n\r\n/**\r\n * Common methods needed to crypt and decrypt data, when data encryption in the DB is enabled.\r\n */\r\nexport class CryptHelper<E, DbTypes> {\r\n\r\n  /**\r\n   * User keys stored as static Object for fast retrieval from memory.\r\n   * The key of the Object is the string concatenation of the user and the undecrypted key to avoid collisions between projects/users.\r\n   */\r\n  private static userKeys: { [keyIdentifier: string]: string } = {};\r\n  private owner: string;\r\n  private undecryptedKey: string;\r\n  private keyIdentifier: string;\r\n\r\n  /**\r\n   * Encrypts the user key using the securePassEncrypter.\r\n   */\r\n  public static decryptUserKey(keyToEncrypt: string): string {\r\n    return stringCrypter(keyToEncrypt, securePassEncrypter);\r\n  }\r\n\r\n  /**\r\n   * Creates an instance of Decrypter.\r\n   * @param dbConnector Instance of DbConnector.\r\n   * @param section the section definition, needed to know which fields should be decrypted.\r\n   * @param element the element to be decrypted.\r\n   */\r\n  constructor(\r\n    protected dbConnector: DbConnectorInstance<DbTypes>,\r\n    protected section: keyof AbstractModel,\r\n    protected element: E\r\n  ) { }\r\n\r\n  /**\r\n   * Returns the unencrypted key of the owner of the element, if an emcrypted key for the user was provided when initializing DbInit.\r\n   */\r\n  protected getUserKey(): string {\r\n    this.setOwner();\r\n    this.setUndecryptedKey();\r\n\r\n    if (!this.undecryptedKey)\r\n      return undefined;\r\n\r\n    this.makeKeyIdentifier();\r\n\r\n    if (CryptHelper.userKeys[this.keyIdentifier])\r\n      return this.returnUserUnencryptedKey();\r\n\r\n    this.decryptUserKey();\r\n\r\n    return this.returnUserUnencryptedKey();\r\n  }\r\n\r\n  /**\r\n   * Logs no key error.\r\n   */\r\n  protected logNoKeyError(): void {\r\n    Logger.error(`ERROR: skipping encryption as no key was found for user ${this.owner}. Did you forget to pass the user key in the options when initializing DbInit?`);\r\n  }\r\n  /**\r\n   * Sets the id of the owner of the element being processed.\r\n   */\r\n  private setOwner(): void {\r\n    this.owner = this.element[this.dbConnector.DS[this.section].ownerIdentifier];\r\n  }\r\n\r\n  /**\r\n   * Sets the undecrypted key of the owner if one was found in dbConnector.options, otherwise `undefined`\r\n   */\r\n  private setUndecryptedKey(): void {\r\n    this.undecryptedKey = (typeof this.dbConnector.options.encryptionKeys === 'object' && this.dbConnector.options.encryptionKeys[this.owner]) ? this.dbConnector.options.encryptionKeys[this.owner] : undefined;\r\n  }\r\n\r\n  /**\r\n   * Makes the identifier of the unencryyypted key by concatenating the `string` of the `owner` and the `string` of the encrypted key.\r\n   */\r\n  private makeKeyIdentifier(): void {\r\n    this.keyIdentifier = `${this.owner}${this.undecryptedKey}`;\r\n  }\r\n\r\n  /**\r\n   * Decrypts the user key using the securePassEncrypter.\r\n   */\r\n  private decryptUserKey(): void {\r\n    CryptHelper.userKeys[this.keyIdentifier] = stringDecrypter(this.undecryptedKey, securePassEncrypter);\r\n  }\r\n\r\n  /**\r\n   * Returns the user unencrypted key retrieving it from the store in memory.\r\n   */\r\n  private returnUserUnencryptedKey(): string {\r\n    return CryptHelper.userKeys[this.keyIdentifier];\r\n  }\r\n\r\n}\r\n","import { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { CryptHelper } from 'app/libs/db-connector/crypter/crypt-helper.class';\r\nimport { stringCrypter } from 'app/libs/db-connector/crypter/string-crypter.function';\r\n\r\n/**\r\n * Encrypts one element at a time.\r\n */\r\nexport class Encrypter<E, DbTypes> extends CryptHelper<E, DbTypes> {\r\n\r\n  /**\r\n   * Retrieves the key to encrypt and loops over all fields to decrypt.\r\n   */\r\n  public async do(): Promise<void> {\r\n    const keyToUse = this.getUserKey();\r\n\r\n    if (keyToUse === undefined)\r\n      return this.logNoKeyError();\r\n\r\n    for (const fieldName in this.element)\r\n      if (!Object.values(RESERVED_FIELDS).includes(fieldName as any))\r\n        this.encrypt(keyToUse, fieldName);\r\n  }\r\n\r\n  /**\r\n   * Encrypts the value of the given key.\r\n   *\r\n   * @param keyToUse the key to be used for encryption.\r\n   * @param fieldName the key of the field to encrypt.\r\n   */\r\n  private encrypt(keyToUse: string, fieldName: string): void {\r\n    if (this.element[fieldName])\r\n      this.element[fieldName] = stringCrypter(this.element[fieldName], keyToUse);\r\n  }\r\n\r\n}\r\n","import { AnitaUniversalDataStorage, SectionElement } from 'app/data/project-structure/project-info';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { ProjectFileHandleSaver } from 'app/libs/db-connector/plugins/file-handles/helpers/project-file-handle-saver.class';\r\n\r\nexport class ElementAdderToCollection<E> {\r\n\r\n  private index: number;\r\n  protected element: Partial<E>;\r\n  /**\r\n   * Creates an instance of db ElementAdderToCollection.\r\n   * @param dbConnector the instance of DbConnector from which ElementAdderToCollection is called\r\n   * @param section the section in which to insert the new element\r\n   * @param element the element to insert\r\n   */\r\n  constructor(\r\n    protected dbConnector: DbConnectorInstance<AnitaUniversalDataStorage>,\r\n    protected section: keyof AbstractModel,\r\n    protected elements: Array<Partial<E>> | Partial<E>\r\n  ) { }\r\n\r\n  protected async save(): Promise<void> {\r\n    this.setSectionStore();\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        this.processElement(element);\r\n    } else {\r\n      this.processElement(this.elements);\r\n    }\r\n    await new ProjectFileHandleSaver(this.dbConnector).save();\r\n  }\r\n\r\n  /**\r\n   * Sets an ampty array is the project did not have one already\r\n   */\r\n  private setSectionStore(): void {\r\n    if (!this.dbConnector.dbStore.db[this.section])\r\n      this.dbConnector.dbStore.db[this.section] = [];\r\n  }\r\n\r\n  private processElement(element: Partial<E>): void {\r\n    this.element = element;\r\n    this.checkIfElementInStoreAndSetIndex();\r\n    this.addToStore();\r\n  }\r\n\r\n  /**\r\n   * Sets the index of the element being saved if it was already in the store, else assigns the lenght of the array to push it at the end.\r\n   *\r\n   * @remarks The index is used by `addToStore` to replace the existing element with the new one when in edit mode.\r\n   */\r\n  protected checkIfElementInStoreAndSetIndex(): void {\r\n    const elements = this.dbConnector.dbStore.db[this.section] as Array<SectionElement>;\r\n    const check = elements.findIndex(ele => this.element[this.dbConnector.DS[this.section].pk] === ele[this.dbConnector.DS[this.section].pk]);\r\n    this.index = (check >= 0) ? check : elements.length;\r\n  }\r\n\r\n  /**\r\n   * Adds the element to the end of the store if it's a new element, otherwise replaces the existing element.\r\n   */\r\n  private addToStore(): void {\r\n    this.dbConnector.dbStore.db[this.section][this.index] = this.element as unknown as SectionElement;\r\n  }\r\n\r\n}\r\n","import { Encrypter } from 'app/libs/db-connector/crypter/encrypter.class';\r\nimport { Insertor } from 'app/libs/db-connector/models/executers';\r\nimport { ElementAdderToCollection } from 'app/libs/db-connector/plugins/file-handles/helpers/element-adder-to-collection.class';\r\n\r\n/**\r\n * Implements insertor for MySql\r\n */\r\nexport class DbInsertor<E> extends ElementAdderToCollection<E> implements Insertor<E> {\r\n\r\n  /**\r\n   * Adds an element to the collection\r\n   */\r\n  public async autoInsert(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted)\r\n      await this.handleEncryption();\r\n\r\n    await this.save();\r\n  }\r\n\r\n  /**\r\n   * Handles encryption with Encrypter\r\n   * \r\n   * @see Encrypter\r\n   */\r\n  private async handleEncryption(): Promise<void> {\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        await new Encrypter(this.dbConnector, this.section, element).do();\r\n    } else {\r\n      await new Encrypter(this.dbConnector, this.section, this.elements).do();\r\n    }\r\n  }\r\n\r\n}\r\n","import { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { CryptHelper } from 'app/libs/db-connector/crypter/crypt-helper.class';\r\nimport { stringDecrypter } from 'app/libs/db-connector/crypter/string-decrypter.function';\r\n\r\n/**\r\n * Decrypts one element at a time.\r\n */\r\nexport class Decrypter<E, DbTypes> extends CryptHelper<E, DbTypes> {\r\n\r\n  /**\r\n   * Retrieves the key to decrypt and loops over all fields to decrypt.\r\n   */\r\n  public async do(): Promise<void> {\r\n    const keyToUse = this.getUserKey();\r\n\r\n    if (keyToUse === undefined)\r\n      return this.logNoKeyError();\r\n\r\n    for (const fieldName in this.element)\r\n      if (!Object.values(RESERVED_FIELDS).includes(fieldName as any))\r\n        this.decrypt(keyToUse, fieldName);\r\n  }\r\n\r\n  /**\r\n   * Decrypts the value of the given key.\r\n   *\r\n   * @param keyToUse the key to be used for decryption.\r\n   * @param fieldName the key of the field to decrypt.\r\n   */\r\n  private decrypt(keyToUse: string, fieldName: string): void {\r\n    if (this.element[fieldName])\r\n      this.element[fieldName] = stringDecrypter(this.element[fieldName], keyToUse);\r\n  }\r\n\r\n}\r\n","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { Decrypter } from 'app/libs/db-connector/crypter/decrypter.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Selector } from 'app/libs/db-connector/models/executers';\r\n\r\nexport class DbSelector<E> implements Selector<E> {\r\n\r\n  private results: Array<any>;\r\n\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<AnitaUniversalDataStorage>,\r\n    private section: keyof AbstractModel,\r\n    private args: Partial<E> = {}\r\n  ) { }\r\n\r\n  /**\r\n   * Gets one element with doSelect\r\n   * \r\n   * @see doSelect\r\n   */\r\n  public async single(): Promise<E> {\r\n    await this.doSelect();\r\n\r\n    if (!this.results.length)\r\n      return;\r\n\r\n    return this.results.find(ele => this.filterKeys(ele));\r\n  }\r\n\r\n  private filterKeys(eleToCheck: E): boolean {\r\n    const keys = Object.keys(this.args);\r\n    let res = true;\r\n    let counter = 0;\r\n    while (res && counter < keys.length) {\r\n      res = eleToCheck[keys[counter]] === this.args[keys[counter]];\r\n      counter++;\r\n    }\r\n    return res;\r\n  }\r\n\r\n  /**\r\n   * Gets multiple elements in an Array with doSelect\r\n   * \r\n   * @see doSelect\r\n   */\r\n  public async multiple(): Promise<Array<E>> {\r\n    await this.doSelect();\r\n    return this.results;\r\n  }\r\n\r\n  /**\r\n   * Counts elements calling multiple and then calling `Array.lenght`\r\n   * @see multiple\r\n   */\r\n  public async count(): Promise<number> {\r\n    await this.multiple();\r\n    return this.results.length;\r\n  }\r\n\r\n  /**\r\n   * Builds the query with QueryMaker and runs it with executeQuery\r\n   * \r\n   * @see QueryMaker\r\n   * @see executeQuery\r\n   */\r\n  private async doSelect(): Promise<void> {\r\n    this.results = this.dbConnector.dbStore.db[this.section] && this.dbConnector.dbStore.db[this.section].length ? this.dbConnector.dbStore.db[this.section] : [];\r\n    await this.handleDecryption();\r\n  }\r\n\r\n  /**\r\n   * Handles decryption\r\n   * \r\n   * @see Decrypter \r\n   */\r\n  private async handleDecryption(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted && this.results.length)\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let i = 0; i < this.results.length; i++)\r\n        await new Decrypter(this.dbConnector, this.section, this.results[i]).do();\r\n  }\r\n\r\n}\r\n","import { DsDbInitOptions } from 'app/libs/db-connector/models/executers';\r\nimport { FileSystemDirectoryHandle, FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { getDirectoryHandle, getNewFileHandle, verifyPermission } from 'app/libs/db-connector/plugins/file-handles/helpers/fs-helper';\r\n\r\n/**\r\n * Uses the fileHandle stored in IndexedDB, if any, or asks for a new one \r\n */\r\nexport async function fileHandleChecker(\r\n  options: DsDbInitOptions,\r\n  description?: string,\r\n  accept?: { [mimeType: string]: Array<string> }\r\n): Promise<FileSystemFileHandle> {\r\n  if (!options.projectInfo.fileHandle)\r\n    return await getNewFileHandle(`anita-fh-${options.projectInfo.id}`, description, accept);\r\n\r\n  await verifyPermission(options.projectInfo.fileHandle, true);\r\n  return options.projectInfo.fileHandle;\r\n\r\n}\r\n\r\nexport async function dirHandleChecker(\r\n  options: DsDbInitOptions,\r\n  description?: string,\r\n  accept?: { [mimeType: string]: Array<string> }\r\n): Promise<FileSystemDirectoryHandle> {\r\n  if (!options.projectInfo.fileHandle)\r\n    return await getDirectoryHandle();\r\n\r\n  await verifyPermission(options.projectInfo.fileHandle, true);\r\n  return options.projectInfo.fileHandle as any as FileSystemDirectoryHandle;\r\n\r\n}\r\n","import { AdditionalInfoForLocalStorage, AnitaUniversalDataStorage, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { DataStructureExtender } from 'app/data/system-local-db/data-structure-extender.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbStoreInterface, DsDbInitOptions } from 'app/libs/db-connector/models/executers';\r\nimport { fileHandleChecker } from 'app/libs/db-connector/plugins/file-handles/helpers/file-handle-checker.function';\r\nimport { readFileHandleAsText } from 'app/libs/db-connector/plugins/file-handles/helpers/fs-helper';\r\n\r\nexport class DbStore implements DbStoreInterface<AnitaUniversalDataStorage> {\r\n\r\n  /**\r\n   * Project data\r\n   */\r\n  public db: AnitaUniversalDataStorage = {\r\n    [RESERVED_AUDS_KEYS._settings]: [],\r\n    [RESERVED_AUDS_KEYS._sections]: []\r\n  };\r\n\r\n  /**\r\n   * Contents of project file as string\r\n   */\r\n  private contents: string;\r\n\r\n  constructor(\r\n    private options: DsDbInitOptions,\r\n    private DS: AbstractModel\r\n  ) { }\r\n\r\n  public async initDB(): Promise<DbStoreInterface<AnitaUniversalDataStorage>> {\r\n\r\n    if (!this.options.projectInfo)\r\n      throw new Error('No projectInfo passed to DbConnector.\\nTo retrieve a project from a local file, pass the an Object of type LocalProjectSettings as value of projectInfo to the options of DbConnector');\r\n\r\n    const fileHandle = await fileHandleChecker(this.options);\r\n\r\n    // If the project already had a FileHandle, the data file already existed so we read it and load it\r\n    if (this.options.projectInfo.fileHandle)\r\n      await this.initializeExistingProject();\r\n    // Otherwise, we are inizializing a new project, so we store in memory the fileHandle, which will be saved by postProjectCreation when saving the project\r\n    else\r\n      this.options.projectInfo.fileHandle = fileHandle;\r\n\r\n    return this;\r\n  }\r\n\r\n  public async postProjectCreation(): Promise<AdditionalInfoForLocalStorage> {\r\n    await this.initializeExistingProject();\r\n    return { fileHandle: this.options.projectInfo.fileHandle };\r\n  }\r\n\r\n  public async postProjectUpdate(): Promise<AdditionalInfoForLocalStorage> {\r\n    return { fileHandle: this.options.projectInfo.fileHandle };\r\n  }\r\n\r\n  public close(): void {\r\n    // NOT NEEDED\r\n  }\r\n\r\n  public async initializeExistingProject(): Promise<void> {\r\n    await this.doReadFile();\r\n    this.parseFileContents();\r\n    this.makedDS();\r\n  }\r\n\r\n  /**\r\n   * Loads file from disk using the fileHandle retrieved from IndexedDB\r\n   */\r\n  private async doReadFile(): Promise<void> {\r\n    this.contents = await readFileHandleAsText(this.options.projectInfo.fileHandle);\r\n  }\r\n\r\n  /**\r\n   * Parses the string file content as data\r\n   */\r\n  private parseFileContents(): void {\r\n    this.db = JSON.parse(this.contents);\r\n  }\r\n\r\n  /**\r\n   * Extends DS (DataStructure) with the sections of the project so that FormDataParserService correctly pares FormData\r\n   *\r\n   * @see FormDataParserService\r\n   * @see DataStructureExtender\r\n   */\r\n  private makedDS(): void {\r\n    Object.assign(this.DS, new DataStructureExtender(this.db[RESERVED_AUDS_KEYS._sections]).extend());\r\n  }\r\n\r\n}\r\n","import { Encrypter } from 'app/libs/db-connector/crypter/encrypter.class';\r\nimport { Updator } from 'app/libs/db-connector/models/executers';\r\nimport { ElementAdderToCollection } from 'app/libs/db-connector/plugins/file-handles/helpers/element-adder-to-collection.class';\r\n\r\n/**\r\n * Implements updator for MySql\r\n */\r\nexport class DbUpdator<E> extends ElementAdderToCollection<E> implements Updator<E> {\r\n\r\n  /**\r\n   * Updates an element in the collection\r\n   */\r\n  public async autoUpdate(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted)\r\n      await this.handleEncryption();\r\n\r\n    await this.save();\r\n  }\r\n\r\n  /**\r\n   * Handles encryption\r\n   * \r\n   * @see Encrypter \r\n   */\r\n  private async handleEncryption(): Promise<void> {\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        await new Encrypter(this.dbConnector, this.section, element).do();\r\n    } else {\r\n      await new Encrypter(this.dbConnector, this.section, this.elements).do();\r\n    }\r\n  }\r\n\r\n}\r\n","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { DbObjects } from 'app/libs/db-connector/models/executers';\r\nimport { DbDeletor } from './db-deletor/db-deletor.class';\r\nimport { DbInsertor } from './db-insertor/db-insertor.class';\r\nimport { DbSelector } from './db-selector/db-selector.class';\r\nimport { DbStore } from './db-store/dbstore.class';\r\nimport { DbUpdator } from './db-updator/db-updator.class';\r\n\r\n/**\r\n * Constant to be passed to DbInit to use MySql as plugin\r\n */\r\nexport const FILE_HANDLES_PLUGIN: DbObjects<any, AnitaUniversalDataStorage> = {\r\n  insertor: DbInsertor,\r\n  selector: DbSelector,\r\n  updator: DbUpdator,\r\n  deletor: DbDeletor,\r\n  dbStore: DbStore\r\n};\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport { cloneDeep } from 'lodash';\r\nimport * as mysql from 'mysql';\r\nimport { Database } from 'sql.js';\r\nimport squel from 'squel';\r\n\r\nexport interface WhereArgs {\r\n  field: string;\r\n  operator: string;\r\n  value: number | string;\r\n}\r\n\r\n/**\r\n * Prepares queries to be executed on a MySql DB\r\n */\r\nexport class QueryMaker {\r\n\r\n  /**\r\n   * Creates an instance of query maker.\r\n   * @param section the section on which to run the qeury\r\n   * @param [element] optional element on which to run the query\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<mysql.Connection | Database>,\r\n    private section: keyof AbstractModel,\r\n    private element?: Object | Array<Object>\r\n  ) { }\r\n\r\n  /**\r\n   * Builds the `SELECT` query\r\n   */\r\n  public select(whereArgs: Array<WhereArgs> = []): string {\r\n    const obj = squel.select({ autoQuoteTableNames: true, autoQuoteFieldNames: true }).from(this.dbConnector.DS[this.section].name);\r\n    if (whereArgs.length)\r\n      whereArgs.forEach(whereArg => obj.where(`${whereArg.field} ${whereArg.operator} ?`, whereArg.value));\r\n    return obj.toString();\r\n  }\r\n\r\n  public count(whereArgs: Array<WhereArgs> = []): string {\r\n    const obj = squel\r\n      .select({ autoQuoteTableNames: true, autoQuoteFieldNames: false })\r\n      .field('COUNT(*) as count')\r\n      .from(this.dbConnector.DS[this.section].name);\r\n    if (whereArgs.length)\r\n      whereArgs.forEach(whereArg => obj.where(`${whereArg.field} ${whereArg.operator} ?`, whereArg.value));\r\n    return obj.toString();\r\n  }\r\n\r\n  /**\r\n   * Builds the `INSERT` query\r\n   */\r\n  public insert(): string {\r\n    if (this.element instanceof Array)\r\n      return this.insertMany();\r\n    else\r\n      return this.insertOne();\r\n  }\r\n\r\n  private insertOne(): string {\r\n    const element = { ...this.element };\r\n    for (const prop in element)\r\n      this.fieldsRemoverIfThereIsNoColumn(element, prop);\r\n\r\n    return squel.insert({ autoQuoteTableNames: true, autoQuoteFieldNames: true })\r\n      .into(this.dbConnector.DS[this.section].name)\r\n      .setFields(element)\r\n      .toString();\r\n  }\r\n\r\n  private insertMany(): string {\r\n    const elements = cloneDeep(this.element) as Array<Object>;\r\n    elements.forEach(element => {\r\n      for (const prop in element)\r\n        this.fieldsRemoverIfThereIsNoColumn(element, prop);\r\n    });\r\n\r\n    return squel.insert({ autoQuoteTableNames: true, autoQuoteFieldNames: true })\r\n      .into(this.dbConnector.DS[this.section].name)\r\n      .setFieldsRows(elements)\r\n      .toString();\r\n  }\r\n\r\n  /**\r\n   * Builds the `UPDATE` query\r\n   */\r\n  public update(): string {\r\n    const element = { ...this.element };\r\n\r\n    for (const prop in element)\r\n      if (prop !== this.dbConnector.DS[this.section].pk) {\r\n        this.fieldsRemoverIfThereIsNoColumn(element, prop);\r\n      }\r\n    const obj = squel\r\n      .update({ autoQuoteTableNames: true, autoQuoteFieldNames: true })\r\n      .table(this.dbConnector.DS[this.section].name)\r\n      .setFields(element);\r\n    const pk = this.dbConnector.DS[this.section].pk as string;\r\n    obj.where(`${pk} = ?`, element[this.dbConnector.DS[this.section].pk]);\r\n\r\n    return obj.toString();\r\n  }\r\n\r\n  /**\r\n   * Builds the `DELETE` query\r\n   */\r\n  public delete(whereArgs: Array<WhereArgs> = []): string {\r\n    const obj = squel.delete({ autoQuoteTableNames: true, autoQuoteFieldNames: true }).from(this.dbConnector.DS[this.section].name);\r\n    if (whereArgs.length)\r\n      whereArgs.forEach(whereArg => obj.where(`${whereArg.field} ${whereArg.operator} ?`, whereArg.value));\r\n    return obj.toString();\r\n  }\r\n\r\n  /**\r\n   * Removes properties for which there is not a column in DB\r\n   */\r\n  private fieldsRemoverIfThereIsNoColumn(element: Object, prop: string): void {\r\n    if (!this.dbConnector.DS[this.section].fields.includes(prop)) {\r\n      delete element[prop];\r\n      Logger.warn(`WARNING: field ${prop} removed because no corresponding column was found in the schema.`);\r\n    }\r\n  }\r\n\r\n}\r\n","import { WhereArgs } from 'app/libs/db-connector/common-helpers/query-maker.class';\r\n\r\n\r\n/**\r\n * Builds where clauses for MySql query string\r\n */\r\nexport class WhereBuilder<E> {\r\n\r\n  /**\r\n   * The where arguments as an Array of WhereArgs { field: string, operator: string, value: string | number }\r\n   */\r\n  protected whereArgs: Array<WhereArgs> = [];\r\n\r\n  /**\r\n   * Creates an instance of where builder.\r\n   * @param args the arguments to use to build the where clauses\r\n   */\r\n  constructor(\r\n    protected args: Partial<E>\r\n  ) {\r\n    this.addWhereFromObj();\r\n  }\r\n\r\n  /**\r\n   * Builds where clauses from an Object. The equals operator `=` is used\r\n   */\r\n  protected addWhereFromObj(): void {\r\n    if (!this.args)\r\n      return;\r\n\r\n    for (const key in this.args)\r\n      this.addWhere(key, this.args[key]);\r\n  }\r\n\r\n  /**\r\n   * Builds the where arguments for the given field, value and oeprator\r\n   */\r\n  private addWhere(field: string, value: any, operator: string = '='): any {\r\n    const params: WhereArgs = {\r\n      field: field,\r\n      operator: operator,\r\n      value: value\r\n    };\r\n    this.whereArgs.push(params);\r\n    return this;\r\n  }\r\n\r\n}\r\n","import { DbConnectorInstance } from 'app/libs/db-connector/models/executers';\r\nimport { Database } from 'sql.js';\r\n\r\nexport async function executeQueryNoReturn(dbConnector: DbConnectorInstance<Database>, query: string): Promise<void> {\r\n  await dbConnector.dbStore.db.run(query);\r\n}","import { FileSystemDirectoryHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { Logger } from 'app/libs/logger/logger.class';\r\nimport { Database } from 'sql.js';\r\n\r\n// We can't write in place to the db, see https://wicg.github.io/file-system-access/#api-filesystemdirectoryhandle-removeentry ISSUE 6\r\nexport async function schemaExporter(db: Database, dirHandle: FileSystemDirectoryHandle, projectId: string): Promise<void> {\r\n  Logger.info('Exporting schema...');\r\n  const binaryArray = db.export();\r\n  const fileHandle = await dirHandle.getFileHandle(`${projectId}.db`, { create: true })\r\n  const writable = await fileHandle.createWritable({ keepExistingData: true });\r\n  await writable.write(binaryArray);\r\n  await writable.close();\r\n}\r\n","import { QueryMaker } from 'app/libs/db-connector/common-helpers/query-maker.class';\r\nimport { WhereBuilder } from 'app/libs/db-connector/common-helpers/where-builder.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Deletor } from 'app/libs/db-connector/models/executers';\r\nimport { FileSystemDirectoryHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { executeQueryNoReturn } from 'app/libs/db-connector/plugins/sqlite/helpers/execute-query-no-return.function';\r\nimport { schemaExporter } from 'app/libs/db-connector/plugins/sqlite/helpers/schema-exporter.function';\r\nimport { Database } from 'sql.js';\r\n\r\n/**\r\n * Implements deletor for MySql\r\n */\r\nexport class DbDeletor<E> extends WhereBuilder<E> implements Deletor<E> {\r\n\r\n  /**\r\n   * Creates an instance of db deletor.\r\n   * @param section the section on which to perform the query\r\n   * @param args the args of the query\r\n   */\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Database>,\r\n    private section: keyof AbstractModel,\r\n    args: Partial<E>\r\n  ) {\r\n    super(args);\r\n  }\r\n\r\n  /**\r\n   * Deletes an element from the collection\r\n   */\r\n  public async autoDelete(): Promise<any> {\r\n\r\n    if (!Object.keys(this.args).length)\r\n      return 'Fatal error: trying to delete without any parameter';\r\n\r\n    const query: string = new QueryMaker(this.dbConnector, this.section).delete(this.whereArgs);\r\n    await executeQueryNoReturn(this.dbConnector, query);\r\n\r\n    await schemaExporter(\r\n      this.dbConnector.dbStore.db,\r\n      this.dbConnector.options.projectInfo.fileHandle as any as FileSystemDirectoryHandle,\r\n      this.dbConnector.options.projectInfo.id);\r\n\r\n  }\r\n\r\n  public async clearSection(): Promise<void> {\r\n    // TODO\r\n  }\r\n\r\n}\r\n","import { QueryMaker } from 'app/libs/db-connector/common-helpers/query-maker.class';\r\nimport { Encrypter } from 'app/libs/db-connector/crypter/encrypter.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Insertor } from 'app/libs/db-connector/models/executers';\r\nimport { FileSystemDirectoryHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { executeQueryNoReturn } from 'app/libs/db-connector/plugins/sqlite/helpers/execute-query-no-return.function';\r\nimport { schemaExporter } from 'app/libs/db-connector/plugins/sqlite/helpers/schema-exporter.function';\r\nimport { cloneDeep } from 'lodash';\r\nimport { Database } from 'sql.js';\r\n\r\n/**\r\n * Implements insertor for MySql\r\n */\r\nexport class DbInsertor<E> implements Insertor<E> {\r\n  protected elements: Array<Partial<E>> | Partial<E>\r\n\r\n  /**\r\n   * Creates an instance of db ElementAdderToCollection.\r\n   * @param dbConnector the instance of DbConnector from which ElementAdderToCollection is called\r\n   * @param section the section in which to insert the new element\r\n   * @param element the element to insert\r\n   */\r\n  constructor(\r\n    protected dbConnector: DbConnectorInstance<Database>,\r\n    protected section: keyof AbstractModel,\r\n    elements: Array<Partial<E>> | Partial<E>\r\n  ) {\r\n    // We need to cloneDeep as we don't want to modify the original elements when converting props to json\r\n    this.elements = cloneDeep(elements);\r\n  }\r\n\r\n  /**\r\n   * Adds an element to the collection\r\n   */\r\n  public async autoInsert(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted)\r\n      await this.handleEncryption();\r\n\r\n    if (this.dbConnector.DS[this.section].jsonFields?.length)\r\n      this.handleJsonFields();\r\n\r\n    const query: string = new QueryMaker(this.dbConnector, this.section, this.elements).insert();\r\n    await executeQueryNoReturn(this.dbConnector, query);\r\n\r\n    await schemaExporter(\r\n      this.dbConnector.dbStore.db,\r\n      this.dbConnector.options.projectInfo.fileHandle as any as FileSystemDirectoryHandle,\r\n      this.dbConnector.options.projectInfo.id);\r\n  }\r\n\r\n  private handleJsonFields(): void {\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        this.handleJsonField(element);\r\n    } else {\r\n      this.handleJsonField(this.elements);\r\n    }\r\n  }\r\n\r\n  private handleJsonField(element: Partial<E>): void {\r\n    for (const jsonField of this.dbConnector.DS[this.section].jsonFields) {\r\n      if (element[jsonField])\r\n        element[jsonField] = JSON.stringify(element[jsonField]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles encryption with Encrypter\r\n   * \r\n   * @see Encrypter\r\n   */\r\n  private async handleEncryption(): Promise<void> {\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        await new Encrypter(this.dbConnector, this.section, element).do();\r\n    } else {\r\n      await new Encrypter(this.dbConnector, this.section, this.elements).do();\r\n    }\r\n  }\r\n\r\n}\r\n","import { Database } from 'sql.js';\r\n\r\nexport async function executeQueryWithReturn(db: Database, query: string): Promise<any> {\r\n  return db.exec(query);\r\n}","import { SqlValue } from 'sql.js';\r\n\r\nexport function serializer<E>(columns: Array<string>, values: Array<Array<SqlValue>>): Array<E> {\r\n  return values.map(row => {\r\n    const objData = {} as E;\r\n    row.forEach((cell, index) => objData[columns[index]] = cell);\r\n    return objData;\r\n  });\r\n}","import { QueryMaker } from 'app/libs/db-connector/common-helpers/query-maker.class';\r\nimport { WhereBuilder } from 'app/libs/db-connector/common-helpers/where-builder.class';\r\nimport { Decrypter } from 'app/libs/db-connector/crypter/decrypter.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Selector } from 'app/libs/db-connector/models/executers';\r\nimport { executeQueryWithReturn } from 'app/libs/db-connector/plugins/sqlite/helpers/execute-query-with-return.function';\r\nimport { serializer } from 'app/libs/db-connector/plugins/sqlite/helpers/serializer.function';\r\nimport { Database } from 'sql.js';\r\n\r\nexport class DbSelector<E> extends WhereBuilder<E> implements Selector<E> {\r\n\r\n  private results: Array<any>;\r\n\r\n  constructor(\r\n    private dbConnector: DbConnectorInstance<Database>,\r\n    private section: keyof AbstractModel,\r\n    args: Partial<E> = {}\r\n  ) {\r\n    super(args);\r\n  }\r\n\r\n  /**\r\n   * Gets one element with doSelect\r\n   * \r\n   * @see doSelect\r\n   */\r\n  public async single(): Promise<E> {\r\n    await this.doSelect();\r\n\r\n    if (this.results.length)\r\n      return this.results[0];\r\n\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * Gets multiple elements in an Array with doSelect\r\n   * \r\n   * @see doSelect\r\n   */\r\n  public async multiple(): Promise<Array<E>> {\r\n    await this.doSelect();\r\n    return this.results;\r\n  }\r\n\r\n  /**\r\n   * Counts elements calling multiple and then calling `Array.lenght`\r\n   * @see multiple\r\n   */\r\n  public async count(): Promise<number> {\r\n    const query: string = new QueryMaker(this.dbConnector, this.section).count(this.whereArgs);\r\n    const res = await executeQueryWithReturn(this.dbConnector.dbStore.db, query);\r\n\r\n    if (!res.length)\r\n      return 0;\r\n\r\n    return res[0].values[0][0];\r\n  }\r\n\r\n  private async doSelect(): Promise<void> {\r\n    this.count();\r\n    const query: string = new QueryMaker(this.dbConnector, this.section).select(this.whereArgs);\r\n    const res = await executeQueryWithReturn(this.dbConnector.dbStore.db, query);\r\n\r\n    if (!res.length) {\r\n      this.results = [];\r\n      return;\r\n    }\r\n\r\n    this.results = serializer<E>(res[0].columns, res[0].values);\r\n\r\n    if (this.dbConnector.options.encrypted)\r\n      await this.handleDecryption();\r\n    if (this.dbConnector.DS[this.section].jsonFields?.length)\r\n      this.parseJsonFields();\r\n  }\r\n\r\n  private parseJsonFields(): void {\r\n    this.results.forEach((element: Object) => {\r\n      for (const prop in element)\r\n        if (this.dbConnector.DS[this.section].jsonFields.includes(prop))\r\n          element[prop] = JSON.parse(element[prop]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handles decryption\r\n   * \r\n   * @see Decrypter \r\n   */\r\n  private async handleDecryption(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted && this.results.length)\r\n      // tslint:disable-next-line:prefer-for-of\r\n      for (let i = 0; i < this.results.length; i++)\r\n        await new Decrypter(this.dbConnector, this.section, this.results[i]).do();\r\n  }\r\n\r\n}\r\n","import { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbStore } from 'app/libs/db-connector/plugins/sqlite/db-store/dbstore.class';\r\n\r\nexport class SchemaCreator {\r\n\r\n  private sql: string = \"\";\r\n\r\n  constructor(\r\n    private dbStore: DbStore,\r\n    private DS: AbstractModel\r\n  ) { }\r\n\r\n  public async createSchema() {\r\n    for (const table in this.DS)\r\n      this.handleTable(this.DS[table].name, this.DS[table].fields);\r\n    await this.dbStore.db.run(this.sql);\r\n  }\r\n\r\n  public handleTable(table: string, fields: Array<string>): void {\r\n    this.sql += `DROP TABLE IF EXISTS '${table}'; CREATE TABLE '${table}' (${this.createFields(fields)});`;\r\n  }\r\n\r\n  private createFields(fields: Array<string>): string {\r\n    let sql = \"\";\r\n    for (const field of fields) {\r\n      sql += `${field} TEXT,`;\r\n    }\r\n    return sql.substring(0, sql.length - 1);\r\n  }\r\n\r\n}\r\n","import { AdditionalInfoForLocalStorage, Section } from 'app/data/project-structure/project-info';\r\nimport { DataStructureExtender } from 'app/data/system-local-db/data-structure-extender.class';\r\nimport { auds_sections } from 'app/data/system-local-db/sections/auds-sections.const';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbStoreInterface, DsDbInitOptions } from 'app/libs/db-connector/models/executers';\r\nimport { dirHandleChecker } from 'app/libs/db-connector/plugins/file-handles/helpers/file-handle-checker.function';\r\nimport { FileSystemDirectoryHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { readDirFileAsUint8Array } from 'app/libs/db-connector/plugins/file-handles/helpers/fs-helper';\r\nimport { executeQueryWithReturn } from 'app/libs/db-connector/plugins/sqlite/helpers/execute-query-with-return.function';\r\nimport { SchemaCreator } from 'app/libs/db-connector/plugins/sqlite/helpers/schema-creator.class';\r\nimport { schemaExporter } from 'app/libs/db-connector/plugins/sqlite/helpers/schema-exporter.function';\r\nimport { serializer } from 'app/libs/db-connector/plugins/sqlite/helpers/serializer.function';\r\nimport { Database } from 'sql.js';\r\nimport initSqlJs from 'sql.js';\r\n\r\n/** \r\n * With sqlite we need to use the FileSystemDirectoryHandle to create the database file\r\n * Using the FileSystemFileHandle would result in the following error when updating the DB file after the first time:\r\n * \"An operation that depends on state cached in an interface object was made but the state had changed since it was read from disk.\"\r\n */\r\nexport class DbStore implements DbStoreInterface<Database> {\r\n\r\n  /**\r\n   * Project data\r\n   */\r\n  public db: Database;\r\n\r\n  /**\r\n   * Contents of project file as string\r\n   */\r\n  private contents: Uint8Array;\r\n\r\n  constructor(\r\n    private options: DsDbInitOptions,\r\n    private DS: AbstractModel\r\n  ) { }\r\n\r\n  public async initDB(): Promise<DbStoreInterface<Database>> {\r\n\r\n    if (!this.options.projectInfo)\r\n      throw new Error('No projectInfo passed to DbConnector.\\nTo retrieve a project from a local file, pass the an Object of type LocalProjectSettings as value of projectInfo to the options of DbConnector');\r\n\r\n    const fileHandle = await dirHandleChecker(this.options, 'SQLite Project Database', { 'application/x-sqlite3': ['.db'] });\r\n\r\n    // If the project already had a FileHandle, the data file already existed so we read it and load it\r\n    if (this.options.projectInfo.fileHandle)\r\n      await this.initializeExistingProject();\r\n    // Otherwise, we are inizializing a new project, so we store in memory the fileHandle, which will be saved by postProjectCreation when saving the project\r\n    else\r\n      await this.onProjectCreation(fileHandle);\r\n\r\n    return this;\r\n  }\r\n\r\n  public async postProjectCreation(): Promise<AdditionalInfoForLocalStorage> {\r\n    await this.makeDSFromDB();\r\n    return { fileHandle: this.options.projectInfo.fileHandle };\r\n  }\r\n\r\n  public async postProjectUpdate(): Promise<AdditionalInfoForLocalStorage> {\r\n    return { fileHandle: this.options.projectInfo.fileHandle };\r\n  }\r\n\r\n  public close(): void {\r\n    // NOT NEEDED\r\n  }\r\n\r\n  public async initializeExistingProject(): Promise<void> {\r\n    await this.doReadFile();\r\n    await this.loadDB(this.contents);\r\n    await this.makeDSFromDB();\r\n  }\r\n\r\n  private async onProjectCreation(fileHandle: FileSystemDirectoryHandle): Promise<void> {\r\n    Object.assign(this.options.projectInfo, { fileHandle });\r\n    await this.loadDB();\r\n    await new SchemaCreator(this, this.DS).createSchema();\r\n    await schemaExporter(\r\n      this.db,\r\n      this.options.projectInfo.fileHandle as any as FileSystemDirectoryHandle,\r\n      this.options.projectInfo.id\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Loads file from disk using the fileHandle retrieved from IndexedDB\r\n   */\r\n  private async doReadFile(): Promise<void> {\r\n    const fileName = `${this.options.projectInfo.id}.db`;\r\n    this.contents = await readDirFileAsUint8Array(this.options.projectInfo.fileHandle as any as FileSystemDirectoryHandle, fileName);\r\n  }\r\n\r\n  /**\r\n   * Extends DS (DataStructure) with the sections of the project so that FormDataParserService correctly pares FormData\r\n   *\r\n   * @see FormDataParserService\r\n   * @see DataStructureExtender\r\n   */\r\n  private async makeDSFromDB(): Promise<void> {\r\n    const res = await executeQueryWithReturn(this.db, \"SELECT * FROM _sections\");\r\n    const sections = serializer<Section>(res[0].columns, res[0].values);\r\n    sections.forEach((section: any) => {\r\n      auds_sections.jsonFields.forEach((field: string) => {\r\n        section[field] = JSON.parse(section[field]);\r\n      });\r\n    });\r\n    Object.assign(this.DS, new DataStructureExtender(sections).extend());\r\n  }\r\n\r\n  private async loadDB(contents?: Uint8Array): Promise<void> {\r\n    const SQL = await initSqlJs({\r\n      locateFile: () => `${process.env.PUBLIC_URL}/assets/sql-wasm.wasm`\r\n    });\r\n    this.db = new SQL.Database(contents);\r\n  }\r\n\r\n}\r\n","import { QueryMaker } from 'app/libs/db-connector/common-helpers/query-maker.class';\r\nimport { Encrypter } from 'app/libs/db-connector/crypter/encrypter.class';\r\nimport { AbstractModel } from 'app/libs/db-connector/models/abstract-model';\r\nimport { DbConnectorInstance, Updator } from 'app/libs/db-connector/models/executers';\r\nimport { FileSystemDirectoryHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { executeQueryNoReturn } from 'app/libs/db-connector/plugins/sqlite/helpers/execute-query-no-return.function';\r\nimport { schemaExporter } from 'app/libs/db-connector/plugins/sqlite/helpers/schema-exporter.function';\r\nimport { cloneDeep } from 'lodash';\r\nimport { Database } from 'sql.js';\r\n\r\n/**\r\n * Implements updator for MySql\r\n */\r\nexport class DbUpdator<E> implements Updator<E> {\r\n\r\n\r\n  /**\r\n   * Creates an instance of db ElementAdderToCollection.\r\n   * @param dbConnector the instance of DbConnector from which ElementAdderToCollection is called\r\n   * @param section the section in which to insert the new element\r\n   * @param element the element to insert\r\n   */\r\n  constructor(\r\n    protected dbConnector: DbConnectorInstance<Database>,\r\n    protected section: keyof AbstractModel,\r\n    protected elements: Array<Partial<E>> | Partial<E>\r\n  ) { }\r\n  /**\r\n   * Updates an element in the collection\r\n   */\r\n  public async autoUpdate(): Promise<void> {\r\n    if (this.dbConnector.options.encrypted)\r\n      await this.handleEncryption();\r\n\r\n    const query: Array<string> = [];\r\n\r\n    if (this.elements instanceof Array)\r\n      for (const element of this.elements) {\r\n        query.push(this.buildQuery(element));\r\n      }\r\n    else\r\n      query.push(this.buildQuery(this.elements));\r\n\r\n    executeQueryNoReturn(this.dbConnector, query.join(';'));\r\n\r\n    await schemaExporter(\r\n      this.dbConnector.dbStore.db,\r\n      this.dbConnector.options.projectInfo.fileHandle as any as FileSystemDirectoryHandle,\r\n      this.dbConnector.options.projectInfo.id\r\n    );\r\n\r\n  }\r\n\r\n  private buildQuery(element: Partial<E>): string {\r\n    const copyEle = { ...element };\r\n\r\n    if (this.dbConnector.DS[this.section].jsonFields?.length)\r\n      for (const field of this.dbConnector.DS[this.section].jsonFields)\r\n        copyEle[field] = JSON.stringify(copyEle[field]);\r\n\r\n    return new QueryMaker(this.dbConnector, this.section, copyEle).update();\r\n  }\r\n\r\n  /**\r\n   * Handles encryption\r\n   * \r\n   * Since cloneDeep is used, the original object is not modified\r\n   * We use cloneDeep only here as it's slower and an overkill if there is no encryption\r\n   * @see Encrypter \r\n   */\r\n  private async handleEncryption(): Promise<void> {\r\n    this.elements = cloneDeep(this.elements);\r\n    if (this.elements instanceof Array) {\r\n      for (const element of this.elements)\r\n        await new Encrypter(this.dbConnector, this.section, element).do();\r\n    } else {\r\n      await new Encrypter(this.dbConnector, this.section, this.elements).do();\r\n    }\r\n  }\r\n\r\n}\r\n","import { DbObjects } from 'app/libs/db-connector/models/executers';\r\nimport { Database } from 'sql.js';\r\nimport { DbDeletor } from './db-deletor/db-deletor.class';\r\nimport { DbInsertor } from './db-insertor/db-insertor.class';\r\nimport { DbSelector } from './db-selector/db-selector.class';\r\nimport { DbStore } from './db-store/dbstore.class';\r\nimport { DbUpdator } from './db-updator/db-updator.class';\r\n\r\n/**\r\n * Constant to be passed to DbInit to use MySql as plugin\r\n */\r\nexport const SQLITE_PLUGIN: DbObjects<any, Database> = {\r\n  insertor: DbInsertor,\r\n  selector: DbSelector,\r\n  updator: DbUpdator,\r\n  deletor: DbDeletor,\r\n  dbStore: DbStore\r\n};\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum';\r\nimport { LocalProjectSettings, Section } from 'app/data/project-structure/project-info';\r\nimport { DataStructureExtender } from 'app/data/system-local-db/data-structure-extender.class';\r\nimport { DbConnector } from 'app/libs/db-connector/db-connector.class';\r\nimport { FILE_HANDLES_PLUGIN } from 'app/libs/db-connector/plugins/file-handles/exporter.constant';\r\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { INDEXEDDB_PLUGIN } from 'app/libs/db-connector/plugins/indexed-db/exporter.constant';\r\nimport { SQLITE_PLUGIN } from 'app/libs/db-connector/plugins/sqlite/exporter.constant';\r\n\r\nexport class DbInitializer {\r\n\r\n  private projectId: string;\r\n\r\n  constructor(\r\n    private projectInfo: LocalProjectSettings,\r\n    private projectSections?: Array<Section>,\r\n    private fileHandle?: FileSystemFileHandle\r\n\r\n  ) {\r\n    this.projectId = projectInfo.id;\r\n  }\r\n\r\n  public async init(): Promise<void> {\r\n    // Relaxed equality check, because localStorage prop might be a string in some storage systems\r\n    // eslint-disable-next-line eqeqeq\r\n    if (this.projectInfo.localStorage == LOCAL_STORAGE_SYSTEMS.fileSystem)\r\n      await this.doFileSystem();\r\n    // eslint-disable-next-line eqeqeq\r\n    else if (this.projectInfo.localStorage == LOCAL_STORAGE_SYSTEMS.SQLite)\r\n      await this.doSQLite();\r\n    else\r\n      await this.doIndexedDb();\r\n  }\r\n\r\n  private async doFileSystem(): Promise<void> {\r\n    if (this.fileHandle)\r\n      this.projectInfo = { ...this.projectInfo, fileHandle: this.fileHandle };\r\n    dbInstances[this.projectId] = await new DbConnector(FILE_HANDLES_PLUGIN, { projectInfo: this.projectInfo }).init();\r\n  }\r\n\r\n  private async doSQLite(): Promise<void> {\r\n    if (this.fileHandle)\r\n      this.projectInfo = { ...this.projectInfo, fileHandle: this.fileHandle };\r\n\r\n    let dsExpander;\r\n    if (this.projectSections) {\r\n      dsExpander = new DataStructureExtender(this.projectSections);\r\n      dsExpander.extend();\r\n    }\r\n    dbInstances[this.projectId] = await new DbConnector(\r\n      SQLITE_PLUGIN,\r\n      { projectInfo: this.projectInfo },\r\n      dsExpander?.allSez\r\n    ).init();\r\n  }\r\n\r\n  private async doIndexedDb(): Promise<void> {\r\n    if (this.projectSections) {\r\n      const dsExpander = new DataStructureExtender(this.projectSections);\r\n      dsExpander.extend();\r\n      dbInstances[this.projectId] = await new DbConnector(\r\n        INDEXEDDB_PLUGIN,\r\n        { previousVersions: [], indexedDbName: this.projectId },\r\n        dsExpander.allSez\r\n      ).init();\r\n    } else if (this.projectInfo.dexieInfoForUpgrade) {\r\n      dbInstances[this.projectId] = await new DbConnector(\r\n        INDEXEDDB_PLUGIN,\r\n        {\r\n          previousVersions: this.projectInfo.dexieInfoForUpgrade.previousVersions,\r\n          DS: this.projectInfo.dexieInfoForUpgrade.DS,\r\n          indexedDbName: this.projectId\r\n        }\r\n      ).init();\r\n    }\r\n  }\r\n\r\n}\r\n","import { RESERVED_AUDS_KEYS, SystemData } from 'app/data/project-structure/project-info'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\n\r\n/**\r\n * Sets the current project\r\n */\r\nexport class CurrentProjectSetter {\r\n\r\n  /**\r\n   * Creates an instance of current project setter.\r\n   * @param project the project to set as current project\r\n   */\r\n  constructor(\r\n    private projectSettings: SystemData[RESERVED_AUDS_KEYS._settings],\r\n    private sectionsDefinitions: SystemData[RESERVED_AUDS_KEYS._sections]\r\n  ) { }\r\n\r\n  /**\r\n   * Dispatches the action to set SystemData in state\r\n   */\r\n  public set(): void {\r\n    storeDispatcher(({\r\n      type: REDUX_ACTIONS.setCurrentProject,\r\n      payload: { [RESERVED_AUDS_KEYS._settings]: this.projectSettings.concat(), [RESERVED_AUDS_KEYS._sections]: this.sectionsDefinitions.concat() }\r\n    }));\r\n  }\r\n\r\n}\r\n","import { DbInitializer } from 'app/data/local-dbs/db-initializer.class';\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport {\r\n  LocalProjectSettings,\r\n  ProjectSettings,\r\n  RESERVED_AUDS_KEYS,\r\n  Section\r\n  } from 'app/data/project-structure/project-info';\r\nimport { CLIENT_SECTIONS } from 'app/data/system-local-db/client-sections.enum';\r\nimport { CurrentProjectSetter } from 'app/libs/project-helpers/project-handlers/current-project-setter.class';\r\n\r\nexport class ProjectLoader {\r\n\r\n  /**\r\n   * The project info of the project to load\r\n   */\r\n  private projectSettings: Array<ProjectSettings>;\r\n  private projectSections: Array<Section>;\r\n\r\n  /**\r\n   * Creates an instance of ProjectLoader\r\n   * @param projectId the id of the projct to load\r\n   */\r\n  constructor(\r\n    private projectId: string,\r\n    private projectInfo?: LocalProjectSettings,\r\n    private setProject = true\r\n  ) { }\r\n\r\n  public async loadProject(): Promise<void> {\r\n    if (!this.projectInfo)\r\n      await this.setProjectInfoFromIndexedDB();\r\n    await this.createNewInstanceOfDbConnectorForrProject();\r\n    await this.loadProjectSettings();\r\n    await this.loadProjectSections();\r\n    if (this.setProject)\r\n      this.callCurrentProjectSetter();\r\n  }\r\n\r\n  /**\r\n   * Loads project info from indexedDB\r\n   */\r\n  private async setProjectInfoFromIndexedDB() {\r\n    this.projectInfo = await dbInstances.system.callSelector<LocalProjectSettings>(CLIENT_SECTIONS.projects, { id: this.projectId }).single();\r\n  }\r\n\r\n  /**\r\n   * Creates new instance of dbConnector for the project so it can be used in the app\r\n   */\r\n  private async createNewInstanceOfDbConnectorForrProject() {\r\n    await new DbInitializer(this.projectInfo).init();\r\n  }\r\n\r\n  /**\r\n   * Loads project settings from the dbInstance\r\n   */\r\n  public async loadProjectSettings(): Promise<void> {\r\n    this.projectSettings = await dbInstances[this.projectId].callSelector<ProjectSettings>(RESERVED_AUDS_KEYS._settings).multiple();\r\n  }\r\n\r\n  /**\r\n   * Loads project sections from the dbInstance\r\n   */\r\n  public async loadProjectSections(): Promise<void> {\r\n    this.projectSections = await dbInstances[this.projectId].callSelector<Section>(RESERVED_AUDS_KEYS._sections).multiple();\r\n  }\r\n\r\n  /**\r\n   * Calls current project setter to load the current project in the Redux store\r\n   */\r\n  private callCurrentProjectSetter() {\r\n    new CurrentProjectSetter(this.projectSettings, this.projectSections).set();\r\n  }\r\n\r\n}","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum';\r\nimport { LocalProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { CLIENT_SECTIONS } from 'app/data/system-local-db/client-sections.enum';\r\nimport { ProjectLoader } from 'app/libs/project-helpers/project-handlers/project-loader.class';\r\n\r\nexport async function isProjectLoaded(projectId: string, setProject = true): Promise<boolean> {\r\n\r\n  if (typeof dbInstances?.[projectId]?.callSelector === 'function')\r\n    return true;\r\n\r\n  const projectInfo = await dbInstances.system.callSelector<LocalProjectSettings>(CLIENT_SECTIONS.projects, { id: projectId }).single();\r\n\r\n  // Relaxed equality check, because localStorage prop is a string\r\n  // eslint-disable-next-line eqeqeq\r\n  if (projectInfo.localStorage == LOCAL_STORAGE_SYSTEMS.IndexedDB) {\r\n    await new ProjectLoader(projectId, projectInfo, setProject).loadProject();\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}","import { Section, SectionElement } from 'app/data/project-structure/project-info';\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { FormFieldsModel, OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum';\r\n\r\n/**\r\n * Builds the form element with the info on the parent section for ParentsSelector\r\n * \r\n * @see ParentsSelector\r\n */\r\nexport class ParentInfoFormEleBuilder {\r\n\r\n  private parentInfoFormModel: FormFieldsModel<SectionElement>;\r\n  private options: Array<OptionKeysModel> = [];\r\n\r\n  constructor(\r\n    private childOf: Array<string>,\r\n    private sections?: Array<Section>\r\n\r\n  ) { }\r\n\r\n  public build(): FormFieldsModel<SectionElement> {\r\n    this.setOptions();\r\n    this.setParentSelector();\r\n    return this.parentInfoFormModel;\r\n  }\r\n\r\n  private setOptions(): void {\r\n    this.childOf.forEach(sectionName => {\r\n      const sectionInfo = this.sections.find(section => section.id === sectionName);\r\n      this.options.push({ value: sectionName, label: sectionInfo.title });\r\n    });\r\n  }\r\n\r\n  private setParentSelector(): void {\r\n    this.parentInfoFormModel = {\r\n      componentCode: FORM_COMPONENTS_CODES.parentsSelector,\r\n      fieldName: RESERVED_FIELDS.parentsInfo,\r\n      label: 'Parent elements',\r\n      options: this.options\r\n    };\r\n  }\r\n\r\n}","import { Section } from 'app/data/project-structure/project-info';\r\n\r\nexport function findSectionById(sections: Array<Section>, toFindId: string): Section {\r\n  return sections.find(section => section.id === toFindId);\r\n}\r\n","export enum SUPPORTED_VALIDATORS {\r\n  required = 1,\r\n  emailFormat,\r\n  telephoneNumber,\r\n  urlFormat,\r\n}","import { ReactNode } from 'react';\r\n\r\nexport const FormEleContainer = ({ children, width }: { children: ReactNode, width: string | number }) => (\r\n  <div className={`${width} my-3 px-2 inline-block align-top`}>\r\n    {children}\r\n  </div>\r\n)","export const FormElementLabel = ({ label }: { label: string }) => (\r\n  <label className=\"w-full block mb-0 ml-1 text-gray-700 text-sm\">{label}</label>\r\n)","import { SUPPORTED_VALIDATORS } from 'app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum'\r\nimport { IValidatorsProps } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators'\r\nimport { memo, useEffect } from 'react'\r\n\r\nexport const EmailFormat = memo(function EmailFormat({ formEle, element, updateValidatorState }: IValidatorsProps) {\r\n\r\n  const value = element[formEle.fieldName];\r\n  // eslint-disable-next-line no-useless-escape\r\n  const isValidEmail = /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/.test(value);\r\n\r\n  useEffect(() => {\r\n    updateValidatorState(SUPPORTED_VALIDATORS.emailFormat, isValidEmail);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [value]);\r\n\r\n  if (isValidEmail || !value)\r\n    return null\r\n\r\n  return (<div className=\"ml-1 text-red-600 text-xs italic  d-block-inline\">Invalid Email</div>);\r\n\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n    && prevProps.touched === nextProps.touched\r\n});\r\n","import { SUPPORTED_VALIDATORS } from 'app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum'\r\nimport { IValidatorsProps } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators'\r\nimport { memo, useEffect } from 'react'\r\n\r\nexport const RequiredField = memo(function RequiredField({ formEle, element, touched, updateValidatorState }: IValidatorsProps) {\r\n\r\n  const value = element[formEle.fieldName];\r\n\r\n  useEffect(() => {\r\n    updateValidatorState(SUPPORTED_VALIDATORS.required, value !== '' && value !== undefined && value !== null);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [value]);\r\n\r\n  if (value || !touched)\r\n    return (<div className=\"ml-1 text-xs italic text-gray-400 d-block-inline\">Required</div>);\r\n\r\n  return (<div className=\"ml-1 text-red-600 text-xs italic\">This field is required</div>);\r\n\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n    && prevProps.touched === nextProps.touched\r\n});\r\n","import { SUPPORTED_VALIDATORS } from 'app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum'\r\nimport { IValidatorsProps } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators'\r\nimport { memo, useEffect } from 'react'\r\n\r\nexport const TelephoneNumber = memo(function TelephoneNumber({ formEle, element, updateValidatorState }: IValidatorsProps) {\r\n\r\n  const value = element[formEle.fieldName];\r\n  const isValidTelephonenumber = /^\\+?\\(?([0-9]{3})\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4,})$/.test(value);\r\n\r\n  useEffect(() => {\r\n    updateValidatorState(SUPPORTED_VALIDATORS.telephoneNumber, isValidTelephonenumber);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [value]);\r\n\r\n  if (isValidTelephonenumber || !value)\r\n    return null\r\n\r\n  return (<div className=\"ml-1 text-red-600 text-xs italic  d-block-inline\">Invalid telephone number</div>);\r\n\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n    && prevProps.touched === nextProps.touched\r\n});\r\n","import { SUPPORTED_VALIDATORS } from 'app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum'\r\nimport { IValidatorsProps } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators'\r\nimport { memo, useEffect } from 'react'\r\n\r\nexport const UrlFormat = memo(function TelephoneNumber({ formEle, element, updateValidatorState }: IValidatorsProps) {\r\n\r\n  const value = element[formEle.fieldName];\r\n  // see https://stackoverflow.com/questions/8667070/javascript-regular-expression-to-validate-url\r\n  const isValidUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test(value);\r\n\r\n  useEffect(() => {\r\n    updateValidatorState(SUPPORTED_VALIDATORS.urlFormat, isValidUrl);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [value]);\r\n\r\n  if (isValidUrl || !value)\r\n    return null\r\n\r\n  return (<div className=\"ml-1 text-red-600 text-xs italic  d-block-inline\">Invalid address (must start with 'http://' or 'https://')</div>);\r\n\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n    && prevProps.touched === nextProps.touched\r\n});\r\n","import { SUPPORTED_VALIDATORS } from 'app/ui-react-components/shared-components/forms-automator/form-validation/supported-validators.enum'\r\nimport { IValidatorsConatinerProps, IValidatorsState } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators'\r\nimport { EmailFormat } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators/email-format.component'\r\nimport { RequiredField } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators/required-field.component'\r\nimport { TelephoneNumber } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators/telephone-number.component'\r\nimport { UrlFormat } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators/url-format.component'\r\nimport { TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\nimport { memo, useState } from 'react'\r\n\r\nexport const ValidatorsContainer = memo(function ValidatorsContainer(props: IValidatorsConatinerProps) {\r\n\r\n  const validators = [];\r\n  const setFieldValidatorsState = useState<IValidatorsState>({})[1];\r\n\r\n  const updateValidatorState = (validatorName: SUPPORTED_VALIDATORS, isValid: boolean) => {\r\n    setFieldValidatorsState(currentValue => {\r\n      if (currentValue[validatorName] === isValid)\r\n        return currentValue;\r\n\r\n      const newValue = { ...currentValue, [validatorName]: isValid };\r\n      // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n      const allValid = Object.keys(newValue).every(key => newValue[key]);\r\n      props.setIsValidForField(allValid);\r\n      return newValue;\r\n    });\r\n  }\r\n\r\n  if (props.formEle.required)\r\n    validators.push(<RequiredField key=\"required-validator\" updateValidatorState={updateValidatorState} {...props} />)\r\n\r\n  if (props.formEle?.type === TextInputSupportedTypes.email)\r\n    validators.push(<EmailFormat key=\"email-validator\" updateValidatorState={updateValidatorState} {...props} />)\r\n\r\n  if (props.formEle?.type === TextInputSupportedTypes.tel)\r\n    validators.push(<TelephoneNumber key=\"telephone-validator\" updateValidatorState={updateValidatorState} {...props} />)\r\n\r\n  if (props.formEle?.type === TextInputSupportedTypes.url)\r\n    validators.push(<UrlFormat key=\"url-validator\" updateValidatorState={updateValidatorState} {...props} />)\r\n\r\n  return (\r\n    <div className=\"flex\">\r\n      {validators}\r\n    </div>\r\n  );\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n    && prevProps.touched === nextProps.touched\r\n});","import { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { useEffect, useState } from 'react'\r\n\r\nexport const useValidators = (fieldId): [boolean, ((isValid: boolean) => void)] => {\r\n\r\n  const [isValid, setIsValid] = useState(true)\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      storeDispatcher({ type: REDUX_ACTIONS.unsetValidStateForEle, payload: fieldId });\r\n    }\r\n  }, [fieldId]);\r\n\r\n  const setIsValidForField = (isValid) => {\r\n    setIsValid(isValid)\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.setValidStateForEle, payload: {\r\n        formEleId: fieldId,\r\n        valid: isValid\r\n      }\r\n    });\r\n  }\r\n\r\n  return [isValid, setIsValidForField];\r\n}","import { ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport { memo, useRef, useState } from 'react'\r\n\r\nexport const BasicCheckbox = memo(function BasicCheckbox({ formEle, element, handleChange }: ICommonFormEleProps) {\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  const width = formEle['width'] ? formEle['width'] : \"w-full\";\r\n\r\n  return (\r\n    <FormEleContainer width={width}>\r\n      <FormElementLabel label={formEle['label']} />\r\n      <input key={formEle.fieldName}\r\n        name={formEle.fieldName}\r\n        type=\"checkbox\"\r\n        checked={(Reflect.has(element, formEle.fieldName) && typeof element[formEle.fieldName] === 'boolean') ? element[formEle.fieldName] : false}\r\n        className={`rounded mt-3 ${!isValid && touched ? \"text-red-600 border border-red-600\" : \"text-prussian-blue-500\"}`}\r\n        onChange={event => handleChange(formEle.fieldName, event.target.checked)}\r\n        onBlur={() => setTouched(true)}\r\n      />\r\n      <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n    </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n});","// Converts a col size in the range of 1-12 to the equivalente TailwindCSS width class\r\n// We can't use string concatenation here because it will break the build\r\n// See optimizing for production at https://tailwindcss.com/docs/optimizing-for-production\r\nexport function calcWidth(width: string): string {\r\n  switch (width) {\r\n    case '1':\r\n      return 'w-full lg:w-1/12';\r\n    case '2':\r\n      return 'w-full lg:w-2/12';\r\n    case '3':\r\n      return 'w-full lg:w-3/12';\r\n    case '4':\r\n      return 'w-full lg:w-4/12';\r\n    case '5':\r\n      return 'w-full lg:w-5/12';\r\n    case '6':\r\n      return 'w-full lg:w-6/12';\r\n    case '7':\r\n      return 'w-full lg:w-7/12';\r\n    case '8':\r\n      return 'w-full lg:w-8/12';\r\n    case '9':\r\n      return 'w-full lg:w-9/12';\r\n    case '10':\r\n      return 'w-full lg:w-10/12';\r\n    case '11':\r\n      return 'w-full lg:w-11/12';\r\n    case '12':\r\n      return 'w-full lg:w-12/12';\r\n    default:\r\n      return 'w-full';\r\n  }\r\n}","export const FORM_ELEMENTS_CSS_CLASSES = \"rounded-md border border-gray-300 hover:border-gray-400 focus:border-prussian-blue-500 focus:ring-0\";\r\nexport const FORM_ELEMENTS_CSS_CLASSES_ERR = \"rounded-md border-2 border-red-300 hover:border-red-400 focus:border-red-200 focus:ring-0\";","import { ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { calcWidth } from 'app/ui-react-components/shared-components/forms-automator/form-builder/calc-width.function'\r\nimport { FORM_ELEMENTS_CSS_CLASSES, FORM_ELEMENTS_CSS_CLASSES_ERR } from 'app/ui-react-components/shared-components/forms-automator/form-layout/fom-elements-css-classes.const'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport { memo, useRef, useState } from 'react'\r\n\r\nexport const BasicInput = memo(function BasicInput({ formEle, element, handleChange }: ICommonFormEleProps) {\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  const width = formEle['width'] ? calcWidth(formEle['width']) : \"w-full\";\r\n\r\n  if (element[formEle.fieldName] === undefined || element[formEle.fieldName] === null)\r\n    element[formEle.fieldName] = '';\r\n\r\n  return (\r\n    <FormEleContainer width={width}>\r\n      <FormElementLabel label={formEle.label} />\r\n      <input\r\n        key={formEle.fieldName}\r\n        name={formEle.fieldName}\r\n        type={formEle?.type || 'text'}\r\n        placeholder={formEle['label']}\r\n        disabled={formEle.disabled ? formEle.disabled : false}\r\n        required={formEle.required ? formEle.required : false}\r\n        className={`w-full ${!isValid && touched ? FORM_ELEMENTS_CSS_CLASSES_ERR : FORM_ELEMENTS_CSS_CLASSES}`}\r\n        value={element[formEle.fieldName]}\r\n        onChange={event => handleChange(formEle.fieldName, event.target.value)}\r\n        onBlur={() => setTouched(true)}\r\n      />\r\n      <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n    </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n});","import { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { IBasicRadio, ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport { memo, useRef, useState } from 'react'\r\nimport ReactTooltip from 'react-tooltip'\r\n\r\n/* eslint-disable eqeqeq */\r\n\r\nexport const BasicRadio = memo(function BasicRadio({ formEle, element, handleChange }: ICommonFormEleProps<IBasicRadio<SectionElement>>) {\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  const width = formEle['width'] ? formEle['width'] : \"w-full\";\r\n\r\n  if (!element[formEle.fieldName] && formEle.value)\r\n    element[formEle.fieldName] = formEle.value;\r\n\r\n  // We use relaxed equal (==) here because the value of the radio button might be a string or a number.\r\n  return (\r\n    <FormEleContainer key={formEle.fieldName} width={width}>\r\n      <FormElementLabel label={formEle['label']} />\r\n      <div className=\"mt-2 pl-1\"\r\n      >\r\n        {formEle.options.map((option, indexOption) => {\r\n          return (\r\n            <div key={option.value} className=\"mb-2\">\r\n              <input\r\n                type=\"radio\"\r\n                value={option.value}\r\n                name={formEle.fieldName}\r\n                checked={element[formEle.fieldName] == option.value}\r\n                disabled={option.disabled || formEle.disabled ? true : false}\r\n                className={`${!isValid && touched ? \"bg-red-600 text-red-600\" : \"bg-gray-200 text-prussian-blue-500\"} mr-2 border-transparent focus:border-gray-500 focus:text-prussian-blue-600 focus:ring-prussian-blue-600`}\r\n                onChange={event => handleChange(formEle.fieldName, event.target['value'])}\r\n                onBlur={() => setTouched(true)}\r\n              />\r\n              <span className={option.disabled || formEle.disabled ? 'text-gray-300 cursor-not-allowed' : ''}>{option.label}</span>\r\n              {option.hint && (\r\n                <span>\r\n                  <sup><i className=\"ml-1 text-xs bi-info-circle\" data-tip data-for={`${fieldId}${indexOption}`}></i></sup>\r\n                  <ReactTooltip id={`${fieldId}${indexOption}`} effect=\"solid\" data-multiline={true} className=\"msg-wrapper text-center\">\r\n                    <span>{option.hint}</span>\r\n                  </ReactTooltip>\r\n                </span>\r\n              )}\r\n            </div>\r\n          )\r\n        })}\r\n      </div>\r\n      <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n    </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] == nextProps.element[nextProps.formEle.fieldName]\r\n});","import { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { IBasicSelect, ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { calcWidth } from 'app/ui-react-components/shared-components/forms-automator/form-builder/calc-width.function'\r\nimport { FORM_ELEMENTS_CSS_CLASSES, FORM_ELEMENTS_CSS_CLASSES_ERR } from 'app/ui-react-components/shared-components/forms-automator/form-layout/fom-elements-css-classes.const'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useSetDefaultValue } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-set-default-value'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport { memo, useRef, useState } from 'react'\r\n\r\nexport const BasicSelect = memo(function BasicSelect({ formEle, element, handleChange }: ICommonFormEleProps<IBasicSelect<SectionElement>>) {\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  const width = formEle['width'] ? calcWidth(formEle['width']) : \"w-full\";\r\n\r\n  // check that the value of element[formEle.fieldName] is a value in formEle.options\r\n  // Use a relaxed equality check to consider numbers and strings the same\r\n  // eslint-disable-next-line eqeqeq\r\n  const isValidOptionsValue = element[formEle.fieldName] && formEle.options.some(option => option.value == element[formEle.fieldName])\r\n  const currentValueIfValidOrNull = isValidOptionsValue ? element[formEle.fieldName] : null\r\n\r\n  useSetDefaultValue(currentValueIfValidOrNull, formEle.value, formEle.fieldName, handleChange)\r\n\r\n  return (\r\n    <FormEleContainer width={width}>\r\n      <FormElementLabel label={formEle['label']} />\r\n      <select\r\n        className={`w-full ${!isValid && touched ? FORM_ELEMENTS_CSS_CLASSES_ERR : FORM_ELEMENTS_CSS_CLASSES}`}\r\n        value={element[formEle.fieldName]}\r\n        onChange={event => handleChange(formEle.fieldName, event.target.value)}\r\n        onBlur={() => setTouched(true)}\r\n      >\r\n        {!formEle.value && <option value=\"\">Chose one</option>}\r\n        {formEle.options.map((option, index) => (\r\n          <option\r\n            key={`${option.value}-${index}`}\r\n            value={option.value}\r\n          >{option.label}</option>)\r\n        )}\r\n      </select>\r\n      {(!formEle.value || element[formEle.fieldName]) && <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />}\r\n    </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  let prereqisiteValuesAreEqual = true\r\n  if (prevProps.formEle?.prerequisites?.length) {\r\n    const propsToCheck = prevProps.formEle?.prerequisites.map(prerequisite => Object.keys(prerequisite)).flat().filter((value, index, array) => array.indexOf(value) === index);\r\n    propsToCheck.forEach(prop => {\r\n      if (prevProps.element[prop] !== nextProps.element[prop]) {\r\n        prereqisiteValuesAreEqual = false;\r\n      }\r\n    })\r\n  }\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName] && prereqisiteValuesAreEqual;\r\n});","import { useEffect } from 'react'\r\n\r\nexport const useSetDefaultValue = <T extends string | number>(currentValue: T, defaultValue: T, fieldName: string | number, valueSetter: (fieldName: string | number, value: T) => void) => {\r\n  useEffect(() => {\r\n    if (!currentValue && defaultValue) {\r\n      valueSetter(fieldName, defaultValue)\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentValue, defaultValue, fieldName])\r\n}\r\n\r\n\r\n/*\r\nexport const useSetDefaultValue = <T extends string | number>(element: SectionElement, formEle: IBasicSelect<SectionElement>, defaultValue: T, fieldName: string | number, valueSetter: (fieldName: string | number, value: T) => void) => {\r\n  const isFirstCheckOfDefaultValue = useRef(true)\r\n  const previousePrerequisitesValues = useRef<Array<string | number>>(null)\r\n  const valuesToCheck = [];\r\n  if (formEle?.prerequisites?.length) {\r\n    const propsToCheck = formEle?.prerequisites.map(prerequisite => Object.keys(prerequisite)).flat().filter((value, index, array) => array.indexOf(value) === index);\r\n    propsToCheck.forEach(prop => {\r\n      if (element.hasOwnProperty(prop)) {\r\n        valuesToCheck.push(element[prop])\r\n      }\r\n    })\r\n    if (isFirstCheckOfDefaultValue.current) {\r\n      previousePrerequisitesValues.current = valuesToCheck\r\n    }\r\n  }\r\n\r\n  // Sets or resets the default value at the first load or any time a prerequisite changes, if a default value exists\r\n  useEffect(() => {\r\n    isFirstCheckOfDefaultValue.current = false\r\n    if (\r\n      !element[RESERVED_FIELDS.id] &&\r\n      defaultValue &&\r\n      (!element[fieldName] || (\r\n        !isFirstCheckOfDefaultValue.current &&\r\n        formEle?.prerequisites?.length &&\r\n        !previousePrerequisitesValues.current.every((value, index) => value === valuesToCheck[index])\r\n      ))) {\r\n      console.log('vado')\r\n      valueSetter(fieldName, defaultValue)\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  })\r\n}\r\n*/","import { ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_ELEMENTS_CSS_CLASSES, FORM_ELEMENTS_CSS_CLASSES_ERR } from 'app/ui-react-components/shared-components/forms-automator/form-layout/fom-elements-css-classes.const'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport { memo, useRef, useState } from 'react'\r\n\r\nexport const BasicTextarea = memo(function BasicTextarea({ formEle, element, handleChange }: ICommonFormEleProps) {\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  const width = formEle['width'] ? formEle['width'] : \"w-full\";\r\n\r\n  if (element[formEle.fieldName] === undefined || element[formEle.fieldName] === null)\r\n    element[formEle.fieldName] = '';\r\n\r\n  return (\r\n    <FormEleContainer width={width}>\r\n      <FormElementLabel label={formEle['label']} />\r\n      <textarea\r\n        name={formEle.fieldName}\r\n        className={`w-full ${!isValid && touched ? FORM_ELEMENTS_CSS_CLASSES_ERR : FORM_ELEMENTS_CSS_CLASSES}`}\r\n        value={element[formEle.fieldName]}\r\n        onChange={event => handleChange(formEle.fieldName, event.target.value)}\r\n        onBlur={() => setTouched(true)}\r\n      />\r\n      <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n    </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n});","import { Option } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-string-to-obj.function';\r\n\r\n/**\r\n * Converts the options used by react-select to a string for storing it in the DB\r\n * We do not want to store the whole object, only the values, as the label might change.\r\n */\r\nexport function parentInfoObjToString(parentInfoObj: Array<Option>): Array<string> {\r\n  const parentsInfo = [];\r\n  parentInfoObj.forEach(parentInfo => {\r\n    parentsInfo.push(parentInfo.value);\r\n  });\r\n  return parentsInfo;\r\n}","export interface Option { value: string, label: string }\r\n\r\ninterface OptionKeysModelGroup {\r\n  label: string;\r\n  options: Array<Option>\r\n}\r\n\r\n/**\r\n * Transforms the array of string keys to an array of objects with the label and value.\r\n * This version is for Select components with grouped options.\r\n * @param parentsInfo the array of the info on the parent, composed by: `[sectionID]|[elementID]`\r\n * @param selectOptions the options for the react-select component\r\n */\r\nexport function parentInfoStringToObjForOptionsGroup(parentsInfo: Array<string>, selectOptions: Array<OptionKeysModelGroup>): Array<Option> {\r\n  const options = [];\r\n\r\n  if (!parentsInfo || !selectOptions)\r\n    return options;\r\n\r\n  parentsInfo.forEach(parentInfo => {\r\n    // find the options group by recourevily searching the options by value\r\n    const group = selectOptions.find(group => group.options.find(opt => opt.value === parentInfo));\r\n\r\n    if (!group) return;\r\n\r\n    // find the option by searching the options of the group\r\n    const option = group.options.find(opt => opt.value === parentInfo);\r\n\r\n    if (!option) return;\r\n\r\n    options.push(option);\r\n  });\r\n\r\n\r\n  return options;\r\n}\r\n\r\n/**\r\n * Transforms the array of string keys to an array of objects with the label and value.\r\n * This version is for Select components with NON grouped options.\r\n * @param parentsInfo the array of the info on the parent, composed by: `[sectionID]|[elementID]`\r\n * @param selectOptions the options for the react-select component\r\n */\r\nexport function parentInfoStringToObj(parentsInfo: Array<string>, selectOptions: Array<Option>): Array<Option> {\r\n  const options = [];\r\n\r\n  if (!parentsInfo || !selectOptions)\r\n    return options;\r\n\r\n  parentsInfo.forEach(parentInfo => {\r\n    // find the option by searching the options of the select element\r\n    const option = selectOptions.find(opt => opt.value === parentInfo);\r\n\r\n    if (!option) return;\r\n\r\n    options.push(option);\r\n  });\r\n\r\n\r\n  return options;\r\n}","import { RESERVED_AUDS_KEYS, SectionElement } from 'app/data/project-structure/project-info'\r\nimport { parentInfoObjToString } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-obj-to-string.function'\r\nimport { Option, parentInfoStringToObj } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-string-to-obj.function'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { IBasicSelect, ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport {\r\n  memo,\r\n  useEffect,\r\n  useRef,\r\n  useState\r\n  } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport Select, { MultiValue } from 'react-select'\r\n\r\nexport const ChildOfSelectorForSection = memo(function ChildOfSelectorForSection({ formEle, element, handleChange, sectionId }: ICommonFormEleProps<IBasicSelect<SectionElement>>) {\r\n\r\n  const currentEditedProjectSections = useSelector((state: AnitaStore) => state.formProject.project[RESERVED_AUDS_KEYS._sections]);\r\n  const [selectOptions, setSelectOptions] = useState<Array<Option>>([]);\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n    const buildOptions = () => {\r\n\r\n      if (!Array.isArray(currentEditedProjectSections))\r\n        return;\r\n\r\n      const selectableSections: Array<Option> = [];\r\n      currentEditedProjectSections.forEach(sectionDec => {\r\n        if (sectionDec.id !== sectionId)\r\n          selectableSections.push({\r\n            value: sectionDec.id,\r\n            label: sectionDec.title\r\n          });\r\n      });\r\n      setSelectOptions(selectableSections);\r\n    }\r\n\r\n    if (isMounted)\r\n      buildOptions();\r\n\r\n    return () => { isMounted = false };\r\n  }, [currentEditedProjectSections, currentEditedProjectSections.length, sectionId]);\r\n\r\n  const handleChangeInChildOfSelectorForSection = (newValue: MultiValue<Option>) => {\r\n    handleChange(formEle.fieldName, parentInfoObjToString(newValue as Array<Option>));\r\n  }\r\n\r\n  if (selectOptions.length === 0)\r\n    return null;\r\n\r\n  // We uas as any because react-select does not export the values we'd like to use,\r\n  // and the ones we define are not compatible.\r\n  return (<FormEleContainer width=\"w-full\">\r\n    <FormElementLabel label={formEle['label']} />\r\n    <Select\r\n      defaultValue={parentInfoStringToObj(element[formEle.fieldName], selectOptions as any)}\r\n      isMulti\r\n      name={formEle.fieldName}\r\n      options={selectOptions as any}\r\n      className={!isValid && touched ? \"border border-red-600 rounded\" : \"\"}\r\n      onChange={handleChangeInChildOfSelectorForSection}\r\n      onBlur={() => setTouched(true)}\r\n    />\r\n    <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n  </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n});","import { ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { memo } from 'react'\r\n\r\nexport const HiddenInput = memo(function HiddenInput({ formEle, element, handleChange }: ICommonFormEleProps) {\r\n\r\n  if (element[formEle.fieldName] === undefined || element[formEle.fieldName] === null)\r\n    element[formEle.fieldName] = '';\r\n\r\n  return (<input key={formEle.fieldName}\r\n    name={formEle.fieldName}\r\n    type=\"hidden\"\r\n    value={element[formEle.fieldName]}\r\n    onChange={(event: React.ChangeEvent<HTMLInputElement>) => handleChange(formEle.fieldName, event.target.value)} />)\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName]\r\n});","const SUCCESS_BG_COLOR = \"bg-green-500\";\r\nconst DANGER_BG_COLOR = \"bg-red-500\";\r\nconst SUCCESS_TEXT_COLOR = \"text-green-700\";\r\nconst DANGER_TEXT_COLOR = \"text-red-700\";\r\nconst SUCCESS_BORDER_COLOR = \"border-green-500\";\r\nconst DANGER_BORDER_COLOR = \"border-red-500\";\r\n\r\nexport const SUCCESS_BTN_OUTLINE = `bg-transparent hover:${SUCCESS_BG_COLOR} ${SUCCESS_TEXT_COLOR} font-semibold hover:text-white border ${SUCCESS_BORDER_COLOR} hover:border-transparent rounded`;\r\nexport const DANGER_BTN_OUTLINE = `bg-transparent hover:${DANGER_BG_COLOR} ${DANGER_TEXT_COLOR} font-semibold hover:text-white border ${DANGER_BORDER_COLOR} hover:border-transparent rounded`;","import { PROJECT_EDITOR_FORM_BUILDER } from 'app/data/project-form-builder/project-editor-form-builder.const'\r\nimport { RESERVED_AUDS_KEYS, Section } from 'app/data/project-structure/project-info'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { DANGER_BTN_OUTLINE } from 'app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const'\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component'\r\nimport { FormFieldsModel, ICommonFormEleProps, OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { memo, useMemo } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport ReactTooltip from 'react-tooltip'\r\n\r\n/**\r\n * Checks if the OptionKeysModel was already in the section before we started editing.\r\n * We can't rely on the general edit mode of the form because we might have new options in edit mode.\r\n * @param section the section to which the current OptionKeysModel belongs\r\n * @param indexFormElement the index of the form model at which the current OptionKeysModel is, as we want to check only on the same form model\r\n * @param option the option to check\r\n * @returns the form model to use. We want different form models for adding and editing to disable fields that should not be altered.\r\n */\r\nfunction getCanEdit(section: Section, indexFormElement: number, value: any): boolean {\r\n  if (!section || !section.formModel[indexFormElement] || !section.formModel[indexFormElement]['options'] || !section.formModel[indexFormElement]['options'].length)\r\n    return true;\r\n\r\n  return !section.formModel[indexFormElement]['options'].some((opt: OptionKeysModel) => opt.value === value);\r\n}\r\n\r\nexport const OptionsMakerSingleOption = memo(function OptionsMakerSingleOption(props: ICommonFormEleProps<FormFieldsModel<OptionKeysModel>>) {\r\n  const { formEle, element, handleOptionsChange, handleClickDeleteOption, indexSection, indexFormElement, index, optionElement } = props;\r\n  const projectEditorMode = useSelector((store: AnitaStore) => store.formProject.mode);\r\n  const section = useSelector((store: AnitaStore) => store.formProject.original[RESERVED_AUDS_KEYS._sections][indexSection]);\r\n  const formModelToUse: Array<FormFieldsModel<any>> = useMemo(() => {\r\n    const canEdit = getCanEdit(section, indexFormElement, optionElement.value);\r\n    return canEdit ?\r\n      PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].optionEles.newItem :\r\n      PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].optionEles.newItem;\r\n  }, [section, indexFormElement, optionElement.value, projectEditorMode]);\r\n\r\n  return (\r\n    <li>\r\n      <FormAutomator\r\n        formModel={formModelToUse}\r\n        element={optionElement}\r\n        handleChange={handleOptionsChange.bind(undefined, index, optionElement)} />\r\n      {(typeof handleClickDeleteOption === 'function' && element[formEle.fieldName].length > 2) && <div className=\"inline-block w-full lg:w-1/12 px-2 lg:pl-1 lg:pr-3 lg:align-bottom mb-8\">\r\n        <button\r\n          onClick={handleClickDeleteOption.bind(undefined, index)}\r\n          data-tip data-for={`deleteOption-${index}`}\r\n          className={`w-full py-1 ${DANGER_BTN_OUTLINE}`}\r\n        ><i className=\"bi-trash hidden lg:block\"></i><span className=\"lg:hidden\">Delete option {index + 1}</span></button>\r\n        <ReactTooltip id={`deleteOption-${index}`} effect=\"solid\">\r\n          <span>Delete option {index + 1}</span>\r\n        </ReactTooltip>\r\n      </div>}\r\n    </li>\r\n  )\r\n});\r\n","import { SUCCESS_BTN_OUTLINE } from 'app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const'\r\nimport { FormFieldsModel, ICommonFormEleProps, OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { OptionsMakerSingleOption } from 'app/ui-react-components/shared-components/forms-automator/form-fields/options-maker-single-option.component'\r\nimport { memo } from 'react'\r\n\r\nexport const OptionsMaker = memo(function OptionsMaker(props: ICommonFormEleProps<FormFieldsModel<OptionKeysModel>>) {\r\n\r\n  const { formEle, element, handleOptionsChange, handleClickAddOption } = props;\r\n\r\n  if (typeof handleOptionsChange !== 'function')\r\n    return null;\r\n\r\n  if (!element[formEle.fieldName] || !Array.isArray(element[formEle.fieldName]) || !element[formEle.fieldName].length)\r\n    element[formEle.fieldName] = Array.from(Array(2), (a, i) => ({ label: '', value: i + 1 }));\r\n\r\n  return (\r\n    <div className=\"mt-6 pl-10 py-4 bg-gray-50 rounded-lg\">\r\n      <p className=\"-ml-5 font-semibold mb-1\">Choices</p>\r\n      <ol className=\"list-decimal\">\r\n        {element[formEle.fieldName].map((optionElement: OptionKeysModel, index) =>\r\n          <OptionsMakerSingleOption key={`${optionElement.value}-${index}`} index={index} optionElement={optionElement} {...props} />\r\n        )}\r\n      </ol>\r\n      {(typeof handleClickAddOption === 'function') &&\r\n        <div className=\"flex items-end\">\r\n          <button\r\n            className={`ml-auto mr-4 mt-3 py-2 px-3 ${SUCCESS_BTN_OUTLINE}`}\r\n            onClick={handleClickAddOption}\r\n          >\r\n            Add option\r\n          </button>\r\n        </div>\r\n      }\r\n    </div>\r\n  )\r\n});","import { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { FormModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\n\r\nexport function findFirstUserDefinedField(sectionFormModel: FormModel): number {\r\n\r\n  let firstUserDefinedFieldInfo: number = undefined;\r\n\r\n  sectionFormModel.some((formEle, index) => {\r\n    if (RESERVED_FIELDS[formEle.fieldName])\r\n      return false;\r\n\r\n    firstUserDefinedFieldInfo = index;\r\n    return true;\r\n  });\r\n\r\n  return firstUserDefinedFieldInfo;\r\n}\r\n","// Removes non ascii characters from a string and replaces with ascii chars, plus replaces spaces with -\r\nexport function cleanString(source: string): string {\r\n  let r = source.toLowerCase();\r\n  const non_asciis = {\r\n    a: '[àáâãäå]',\r\n    ae: 'æ',\r\n    c: 'ç',\r\n    e: '[èéêë]',\r\n    i: '[ìíîï]',\r\n    n: 'ñ',\r\n    o: '[òóôõö]',\r\n    oe: 'œ',\r\n    u: '[ùúûűü]',\r\n    y: '[ýÿ]'\r\n  };\r\n  for (const i in non_asciis)\r\n    r = r.replace(new RegExp(non_asciis[i], 'g'), i);\r\n\r\n  return r.replace(/\\s/g, '-')\r\n    .replace(/[^\\w-]/gi, '');\r\n}\r\n\r\n/**\r\n * Asyncs forEach. Unlike native JS forEach, this one awaits each callback to resolve befofore iterating to the next element of the array\r\n * @param array the array to loop\r\n * @param callback the function to call on each element of the array\r\n */\r\nexport async function asyncForEach<T>(array: Array<T>, callback: (item: T, index: number, arr: Array<T>) => Promise<any>): Promise<void> {\r\n  const totalLength = array.length;\r\n  for (let index = 0; index < totalLength; index++)\r\n    await callback(array[index] as T, index, array);\r\n}\r\n\r\n/**\r\n * Gets the current utcdate and time as an ISO string\r\n */\r\nexport function getUTCDateTime(): string {\r\n  return new Date(new Date().toUTCString()).toISOString();\r\n}\r\n\r\n/**\r\n * Gets the current date and time as an ISO string\r\n */\r\nexport function getDateTime(): string {\r\n  return new Date(new Date()).toISOString();\r\n}\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { RESERVED_AUDS_KEYS, SectionElement, SystemData } from 'app/data/project-structure/project-info';\r\nimport { findFirstUserDefinedField } from 'app/libs/tools/find-first-user-defined-field.function';\r\nimport { findSectionById } from 'app/libs/tools/find-section-by-id.function';\r\nimport { asyncForEach } from 'app/libs/tools/tools';\r\nimport { FormModel, OptionKeysModel, OptionKeysModelGroup } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\n\r\nexport class OptionsForParentsSelector {\r\n\r\n  private optionsGroups: Array<OptionKeysModelGroup> = [];\r\n\r\n  constructor(\r\n    private project: SystemData,\r\n    private options: Array<OptionKeysModel>\r\n  ) {\r\n  }\r\n  public async buildOptions(): Promise<Array<OptionKeysModelGroup>> {\r\n    await asyncForEach(this.options, async group => {\r\n      const sectionEles = await dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id].callSelector<SectionElement>(group.value).multiple();\r\n      if (sectionEles.length)\r\n        this.createGroupOption(group.value as string, group.label, sectionEles);\r\n    });\r\n\r\n    return this.optionsGroups;\r\n  }\r\n\r\n  private createGroupOption(sectionId: string, sectionLabel: string, sectionEles: Array<SectionElement>): void {\r\n    const options: Array<OptionKeysModel> = [];\r\n    const section = findSectionById(this.project[RESERVED_AUDS_KEYS._sections], sectionId);\r\n    const indexFirstUserFiield = findFirstUserDefinedField(section.formModel as FormModel);\r\n    sectionEles.forEach(ele => options.push({\r\n      value: `${sectionId}|${ele.id}`,\r\n      label: ele[section.formModel[indexFirstUserFiield].fieldName]\r\n    }));\r\n    this.optionsGroups.push({\r\n      label: sectionLabel,\r\n      options\r\n    });\r\n  }\r\n}","import { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { OptionsForParentsSelector } from 'app/libs/project-helpers/parent-info-form-ele-builder/options-for-parents-selector.class'\r\nimport { parentInfoObjToString } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-obj-to-string.function'\r\nimport { Option, parentInfoStringToObjForOptionsGroup } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-string-to-obj.function'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { IBasicSelect, ICommonFormEleProps, OptionKeysModelGroup } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FormEleContainer } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-ele-container.component'\r\nimport { FormElementLabel } from 'app/ui-react-components/shared-components/forms-automator/form-layout/form-element-label.component'\r\nimport { ValidatorsContainer } from 'app/ui-react-components/shared-components/forms-automator/form-validation/validators-container.component'\r\nimport { useValidators } from 'app/ui-react-components/shared-components/forms-automator/hooks/use-validators.hook'\r\nimport uniqueId from 'lodash/uniqueId'\r\nimport {\r\n  memo,\r\n  useEffect,\r\n  useRef,\r\n  useState\r\n  } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport Select, { MultiValue } from 'react-select'\r\n\r\nexport const ParentsSelector = memo(function ParentsSelector({ formEle, element, handleChange }: ICommonFormEleProps<IBasicSelect<SectionElement>>) {\r\n\r\n  const [selectOptions, setSelectOptions] = useState<Array<OptionKeysModelGroup>>([]);\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n\r\n  const [touched, setTouched] = useState(false);\r\n  const { current: fieldId } = useRef(uniqueId(formEle.fieldName))\r\n  const [isValid, setIsValidForField] = useValidators(fieldId)\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n    const getSelectOptions = async () => {\r\n      const options = await new OptionsForParentsSelector(project, formEle.options).buildOptions();\r\n\r\n      if (isMounted)\r\n        setSelectOptions(options);\r\n    };\r\n\r\n\r\n    if (isMounted)\r\n      getSelectOptions();\r\n\r\n    return () => { isMounted = false };\r\n  }, [project, formEle.options]);\r\n\r\n  const handleChangeInParentsSelector = (newValue: MultiValue<Option>) => {\r\n    handleChange(formEle.fieldName, parentInfoObjToString(newValue as Array<Option>));\r\n  }\r\n\r\n  if (selectOptions.length === 0)\r\n    return null;\r\n\r\n  // We uas as any because react-select does not export the values we'd like to use,\r\n  // and the ones we define are not compatible.\r\n  return (<FormEleContainer width=\"w-full\">\r\n    <FormElementLabel label={formEle['label']} />\r\n    <Select\r\n      defaultValue={parentInfoStringToObjForOptionsGroup(element[formEle.fieldName], selectOptions as any)}\r\n      isMulti\r\n      name={formEle.fieldName}\r\n      options={selectOptions as any}\r\n      className={!isValid && touched ? \"border border-red-600 rounded\" : \"\"}\r\n      onChange={handleChangeInParentsSelector}\r\n      onBlur={() => setTouched(true)}\r\n    />\r\n    <ValidatorsContainer formEle={formEle} element={element} fieldId={fieldId} touched={touched} setIsValidForField={setIsValidForField} />\r\n  </FormEleContainer>\r\n  )\r\n}, (prevProps, nextProps) => {\r\n  return prevProps.element[prevProps.formEle.fieldName] === nextProps.element[nextProps.formEle.fieldName] &&\r\n    prevProps.formEle.options === nextProps.formEle.options\r\n});","import { FormFieldsModel, Prerequisites, SupportedFormsTypes } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\n\r\nexport class PrerequisitesChecker<ELEMENT extends Partial<SupportedFormsTypes>> {\r\n\r\n  private isIntegrated = false;\r\n\r\n  constructor(\r\n    private formEle: FormFieldsModel<Partial<SupportedFormsTypes>>,\r\n    private objValues: Partial<ELEMENT>\r\n  ) { }\r\n\r\n  public integrates(): boolean {\r\n    if (!this.formEle.prerequisites || !this.formEle.prerequisites.length)\r\n      return true;\r\n\r\n    this.loopPrerequisites();\r\n\r\n    return this.isIntegrated;\r\n  }\r\n\r\n  private loopPrerequisites(): void {\r\n    let counter = 0;\r\n    while (this.isIntegrated === false && counter < this.formEle.prerequisites.length) {\r\n      this.checkPrerequisites(this.formEle.prerequisites[counter]);\r\n      counter++;\r\n    }\r\n  }\r\n\r\n  private checkPrerequisites(prereq: Prerequisites): void {\r\n    for (const key in prereq) {\r\n      // We use a relaxed equality check here, because the value can be a string or a number\r\n      // eslint-disable-next-line eqeqeq\r\n      if (prereq[key].filter(prereqValue => prereqValue == this.objValues[key]).length > 0)\r\n        this.setIsIntegrated();\r\n    }\r\n  }\r\n\r\n  private setIsIntegrated(): void {\r\n    this.isIntegrated = true;\r\n  }\r\n\r\n}\r\n","import { ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { formElesSwitcher } from 'app/ui-react-components/shared-components/forms-automator/form-builder/form-eles-switcher.function'\r\nimport { PrerequisitesChecker } from 'app/ui-react-components/shared-components/forms-automator/form-builder/prerequisites-checker.class'\r\nimport { useMemo } from 'react'\r\n\r\nexport const FieldSelector = (props: ICommonFormEleProps) => {\r\n\r\n  const shouldRender = useMemo(() => new PrerequisitesChecker(\r\n    props.formEle, props.element\r\n  ).integrates(), [props.formEle, props.element]);\r\n\r\n  if (shouldRender)\r\n    return formElesSwitcher(props.formEle.fieldName, props.formEle.componentCode, props);\r\n\r\n  return null;\r\n\r\n}","import { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { IBasicRadio, IBasicSelect, ICommonFormEleProps } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { BasicCheckbox } from 'app/ui-react-components/shared-components/forms-automator/form-fields/basic-checkbox.component'\r\nimport { BasicInput } from 'app/ui-react-components/shared-components/forms-automator/form-fields/basic-input.component'\r\nimport { BasicRadio } from 'app/ui-react-components/shared-components/forms-automator/form-fields/basic-radio.component'\r\nimport { BasicSelect } from 'app/ui-react-components/shared-components/forms-automator/form-fields/basic-select.component'\r\nimport { BasicTextarea } from 'app/ui-react-components/shared-components/forms-automator/form-fields/basic-textarea.component'\r\nimport { ChildOfSelectorForSection } from 'app/ui-react-components/shared-components/forms-automator/form-fields/child-of-selector-for-section.component'\r\nimport { HiddenInput } from 'app/ui-react-components/shared-components/forms-automator/form-fields/hidden-input.component'\r\nimport { OptionsMaker } from 'app/ui-react-components/shared-components/forms-automator/form-fields/options-maker.component'\r\nimport { ParentsSelector } from 'app/ui-react-components/shared-components/forms-automator/form-fields/parents-selector.component'\r\n\r\nexport function formElesSwitcher(key: string, componentCode: FORM_COMPONENTS_CODES, props: ICommonFormEleProps) {\r\n  switch (componentCode) {\r\n    case FORM_COMPONENTS_CODES.hiddenInput:\r\n      return <HiddenInput key={key} {...props} />\r\n    case FORM_COMPONENTS_CODES.basicInput:\r\n    case FORM_COMPONENTS_CODES.datePicker:\r\n    case FORM_COMPONENTS_CODES.dateTimePicker:\r\n      return <BasicInput key={key} {...props} />\r\n    case FORM_COMPONENTS_CODES.basicSelect:\r\n      return <BasicSelect key={key} {...props as ICommonFormEleProps<IBasicSelect<SectionElement>>} />\r\n    case FORM_COMPONENTS_CODES.basicTextarea:\r\n      return <BasicTextarea key={key} {...props} />\r\n    case FORM_COMPONENTS_CODES.basicCheckbox:\r\n      return <BasicCheckbox key={key} {...props} />\r\n    case FORM_COMPONENTS_CODES.basicRadio:\r\n      return <BasicRadio key={key} {...props as ICommonFormEleProps<IBasicRadio<SectionElement>>} />\r\n    case FORM_COMPONENTS_CODES.optionsMaker:\r\n      return <OptionsMaker key={key} {...props} />\r\n    case FORM_COMPONENTS_CODES.childOfSelectorForSection:\r\n      return <ChildOfSelectorForSection key={key} {...props as ICommonFormEleProps<IBasicSelect<SectionElement>>} />\r\n    case FORM_COMPONENTS_CODES.parentsSelector:\r\n      return <ParentsSelector key={key} {...props as ICommonFormEleProps<IBasicSelect<SectionElement>>} />\r\n    default:\r\n      return <BasicInput key={key} {...props} />\r\n  }\r\n}","import { Section } from 'app/data/project-structure/project-info'\r\nimport { FieldSelector } from 'app/ui-react-components/shared-components/forms-automator/form-layout/field-selector.component'\r\n\r\nexport interface IFormAutomatorProps {\r\n  formModel: Section['formModel'];\r\n  element: { [key: string]: any };\r\n  handleChange: (...args: any) => void;\r\n  [customProps: string]: any;\r\n\r\n}\r\n\r\nexport const FormAutomator = (props: IFormAutomatorProps) => {\r\n\r\n  return (\r\n    <span>\r\n      {props.formModel.map((formEle, index) => (\r\n        <FieldSelector key={formEle.fieldName + index.toString()} formEle={formEle} {...props} />\r\n      ))}\r\n    </span>\r\n  )\r\n\r\n}","import { RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info'\r\nimport { ParentInfoFormEleBuilder } from 'app/libs/project-helpers/parent-info-form-ele-builder/parent-info-form-ele-builder.class'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { findSectionById } from 'app/libs/tools/find-section-by-id.function'\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component'\r\nimport { FormAutomatorOnChangeValue } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { useSelector } from 'react-redux'\r\n\r\nexport const FormElementManager = ({ sectionId }: { sectionId: string }) => {\r\n\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n  const sections = project[RESERVED_AUDS_KEYS._sections];\r\n  const section = findSectionById(sections, sectionId);\r\n\r\n  const element = useSelector((store: AnitaStore) => store.formElement.element);\r\n\r\n  const handleChange = (fieldName: string | number, value: FormAutomatorOnChangeValue) => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormElementKey, payload: { fieldName, value } });\r\n  }\r\n\r\n  return (\r\n    <form name=\"element-form\">\r\n      {section.childOf && section.childOf.length > 0 && <FormAutomator\r\n        formModel={[new ParentInfoFormEleBuilder(section.childOf, sections).build()]}\r\n        element={element}\r\n        handleChange={handleChange} />\r\n      }\r\n      <FormAutomator formModel={section.formModel} element={element} handleChange={handleChange} />\r\n    </form>\r\n  )\r\n\r\n};","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { SectionElement } from 'app/data/project-structure/project-info';\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { SectionModel } from 'app/libs/db-connector/db-builder/sez-definition';\r\nimport { IdCreator } from 'app/libs/id-creator/id-creator.class';\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\n\r\n/**\r\n * Saves a new element in a section of the project, stores the project on disk and dispatches the changes to the current state\r\n */\r\nexport class ElementSaver {\r\n\r\n  /**\r\n   * Reference to section model in DS for easier access in code\r\n   */\r\n  private sectionModelInDS: SectionModel<SectionElement>;\r\n\r\n  /**\r\n   * Creates an instance of element saver.\r\n   * @param projectData the unmodified project data\r\n   * @param sectionId the id of the section of the element to save\r\n   * @param element the element to save\r\n   */\r\n  constructor(\r\n    private projectId: string,\r\n    private sectionId: string,\r\n    private element: SectionElement,\r\n    private mode: EDITOR_MODE\r\n  ) { }\r\n\r\n  /**\r\n   * Deep clones the project, adds/updated the element in the project to save and finally save the project\r\n   */\r\n  public async save(): Promise<SectionElement> {\r\n    this.setSectionModel();\r\n    this.checkAndSetPk();\r\n    this.setcreatedAt();\r\n    this.deleteEmptyProps();\r\n\r\n    if (this.mode === EDITOR_MODE.add)\r\n      await dbInstances[this.projectId].callInsertor(this.sectionId, this.element).autoInsert();\r\n    else {\r\n      this.setupdatedAtValueIfInEditMode();\r\n      await dbInstances[this.projectId].callUpdator(this.sectionId, this.element).autoUpdate();\r\n    }\r\n\r\n    return this.element;\r\n\r\n  }\r\n\r\n  /**\r\n   * Sets the section model from the DS stored in DbConnector\r\n   */\r\n  private setSectionModel(): void {\r\n    this.sectionModelInDS = dbInstances[this.projectId].DS[this.sectionId];\r\n  }\r\n\r\n  /**\r\n   * Checks if a `pk` value is set, if not one is created.\r\n   */\r\n  private checkAndSetPk(): void {\r\n    if (!this.element[this.sectionModelInDS.pk])\r\n      this.element[this.sectionModelInDS.pk] = IdCreator.make(this.sectionModelInDS.name);\r\n  }\r\n\r\n  /**\r\n   * Deletes all props from the element whose value is an empty string\r\n   */\r\n  private deleteEmptyProps(): void {\r\n    for (const prop in this.element)\r\n      if (this.element[prop] === '')\r\n        delete this.element[prop];\r\n  }\r\n\r\n  /**\r\n   * Checks if `createdAt` value is set, if not one is created.\r\n   */\r\n  private setcreatedAt(): void {\r\n    if (this.sectionModelInDS.fields.includes(RESERVED_FIELDS.createdAt) && !this.element[RESERVED_FIELDS.createdAt])\r\n      this.element[RESERVED_FIELDS.createdAt] = new Date(new Date().toUTCString()).toISOString();\r\n  }\r\n\r\n  /**\r\n   * Sets the updatedAt value if in edit mode\r\n   */\r\n  private setupdatedAtValueIfInEditMode(): void {\r\n    if (this.sectionModelInDS.fields.includes(RESERVED_FIELDS.updatedAt))\r\n      this.element[RESERVED_FIELDS.updatedAt] = new Date(new Date().toUTCString()).toISOString();\r\n  }\r\n\r\n}\r\n","import { RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { ElementSaver } from 'app/libs/project-helpers/section-elements-handlers/element-saver.class';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\nimport { useSelector } from 'react-redux';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nexport const SaveElement = ({ sectionId }: { sectionId: string }) => {\r\n\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n  const element = useSelector((state: AnitaStore) => state.formElement.element);\r\n  const validObj = useSelector((state: AnitaStore) => state.formElesValidState);\r\n  const navigate = useNavigate();\r\n\r\n  const handleClick = async () => {\r\n    const mode = element.id ? EDITOR_MODE.edit : EDITOR_MODE.add;\r\n    await new ElementSaver(project[RESERVED_AUDS_KEYS._settings][0].id, sectionId, element, mode).save();\r\n    navigate(-1);\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-6 mb-3 px-2 flex justify-end\">\r\n      <button\r\n        className=\"py-2 px-6 bg-gray-200 font-semibold rounded hover:bg-gray-300 mr-3\"\r\n        onClick={() => navigate(-1)}\r\n      >Cancel</button>\r\n      <button\r\n        disabled={Object.keys(validObj).some(key => validObj[key] === false)}\r\n        className=\"py-2 px-6 bg-prussian-blue-400 text-white font-semibold rounded hover:bg-prussian-blue-500\"\r\n        onClick={handleClick}\r\n      >Save</button>\r\n    </div>\r\n  )\r\n\r\n}\r\n","import { ReactNode } from 'react'\r\nexport const MainContentContainer = ({ children, headerText }: { children: ReactNode, headerText?: string }) => (\r\n  <div className=\"p-4 bg-white rounded shadow\">\r\n    {headerText ? <div className=\"mt-3\">\r\n      <h3 className=\"text-xl font-bold\">{headerText}</h3>\r\n      <hr className=\"mt-4\" />\r\n    </div> : null}\r\n    <div className=\"pt-4 pb-4 overflow-y-auto\">\r\n      {children}\r\n    </div>\r\n  </div>\r\n)","export const Loader = () => (\r\n  <svg className=\"mx-auto my-5 animate-spin h-5 w-5 text-prussian-blue-600\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n  </svg>\r\n)","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const'\r\nimport { SectionElement } from 'app/data/project-structure/project-info'\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum'\r\nimport { FormElementManager } from 'app/ui-react-components/project/add-edit-components/form-element-manager.component'\r\nimport { SaveElement } from 'app/ui-react-components/project/add-edit-components/save-element.component'\r\nimport { MainContentContainer } from 'app/ui-react-components/shared-components/common-ui-eles/main-content-container.component'\r\nimport { Loader } from 'app/ui-react-components/shared-components/loader/loader.component'\r\nimport { useEffect, useState } from 'react'\r\nimport { Navigate, useParams } from 'react-router-dom'\r\n\r\nexport const AddEditSectionElement = () => {\r\n\r\n  const params = useParams();\r\n  const mode = params[URL_PARAMS.elementId] ? EDITOR_MODE.edit : EDITOR_MODE.add;\r\n\r\n  const projectId = params[URL_PARAMS.projectId];\r\n  const sectionId = params[URL_PARAMS.sectionId];\r\n  const elementId = (mode === EDITOR_MODE.edit) ? params[URL_PARAMS.elementId] : null;\r\n\r\n  const [element, setElement] = useState<Partial<SectionElement> | null | undefined>(null);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n\r\n    const fetchElement = async () => {\r\n      const canProceed = await isProjectLoaded(projectId);\r\n\r\n      if (!projectId || !sectionId || !canProceed)\r\n        return setElement(undefined);\r\n\r\n      if (mode === EDITOR_MODE.add)\r\n        return setElement({});\r\n\r\n      const element = await dbInstances[projectId].callSelector<SectionElement>(sectionId, { id: elementId }).single();\r\n      if (isMounted)\r\n        setElement(element);\r\n    };\r\n\r\n    if (isMounted)\r\n      fetchElement();\r\n\r\n    return () => { isMounted = false; }\r\n  }, [mode, projectId, sectionId, elementId]);\r\n\r\n  if (element === undefined)\r\n    return <Navigate to={ANITA_URLS.projectsList} />\r\n\r\n  const headerText = mode === EDITOR_MODE.add ? 'Add Element' : 'Edit Element';\r\n\r\n  storeDispatcher({ type: REDUX_ACTIONS.updateFormElement, payload: element });\r\n\r\n  return (\r\n    <MainContentContainer headerText={headerText}>\r\n      {element === null && <Loader />}\r\n      {element !== null && <FormElementManager sectionId={sectionId} />}\r\n      {element !== null && <SaveElement sectionId={sectionId} />}\r\n    </MainContentContainer>\r\n  )\r\n\r\n}","import { OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\n/* eslint-disable eqeqeq */\r\n\r\n/**\r\n * Finds the text to be displayed for an option of a Radio or Select element based on the matching value\r\n */\r\nexport function txtByFieldValue(options: Array<OptionKeysModel>, toFindId: string | number): string | null {\r\n  // We use relaxed equal (==) here because the value of the radio button might be a string or a number.\r\n  const optionToReturn = options.find(option => option.value == toFindId);\r\n\r\n  if (typeof optionToReturn === 'undefined')\r\n    return null;\r\n\r\n  return optionToReturn.label;\r\n}\r\n\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { ProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { CLIENT_SECTIONS } from 'app/data/system-local-db/client-sections.enum';\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function';\r\nimport { ProjectsListLoader } from 'app/libs/projects-helpers/projects-handlers/projects-list-loader.class';\r\n\r\n/**\r\n * Deletes a project from the current device\r\n */\r\nexport class ProjectDeletor {\r\n\r\n  /**\r\n   * Creates an instance of project deletor.\r\n   * @param project the settings of the project to delete\r\n   */\r\n  constructor(\r\n    private project: ProjectSettings\r\n  ) { }\r\n\r\n  /**\r\n   * Deletes the project and reloads the list of projects\r\n   */\r\n  public async delete(): Promise<void> {\r\n    await this.callOnProjectDeleted();\r\n    await this.doDelete();\r\n    this.reloadProjectList();\r\n  }\r\n\r\n  /**\r\n   * Performs the delete action on IndexedDB with db-connector\r\n   */\r\n  private async doDelete(): Promise<void> {\r\n    await dbInstances.system.callDeletor<ProjectSettings>(CLIENT_SECTIONS.projects, { id: this.project.id }).autoDelete();\r\n  }\r\n\r\n  private async callOnProjectDeleted(): Promise<void> {\r\n    const canProceed = await isProjectLoaded(this.project.id, false);\r\n    if (canProceed)\r\n      await dbInstances[this.project.id].dbStore.onProjectDeleted?.();\r\n  }\r\n\r\n  /**\r\n   * Reloads the project list from scratch\r\n   */\r\n  private reloadProjectList(): void {\r\n    new ProjectsListLoader().load();\r\n  }\r\n\r\n}\r\n","import { ReactNode } from 'react';\r\n\r\nexport const ModalBody = ({ children }: { children: ReactNode }) => (\r\n  <div className=\"mt-2\">\r\n    {children}\r\n  </div>\r\n);","import { ReactNode } from 'react';\r\n\r\nexport const ModalContent = ({ children, icon }: { children: ReactNode, icon?: string }) => (\r\n  <div className=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n    <div className=\"sm:flex sm:items-start\">\r\n      {icon && (\r\n        <div className=\"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10\">\r\n          <i className={`${icon} text-xl -mt-1`}></i>\r\n        </div>\r\n      )}\r\n      <div className=\"sm:flex sm:items-start\">\r\n        <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);","import { ReactNode } from 'react';\r\nexport const ModalFooter = ({ children }: { children: ReactNode }) => (\r\n  <div className=\"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\r\n    {children}\r\n  </div>\r\n);\r\n","import { ReactNode } from 'react';\r\n\r\nexport const ModalHeader = ({ children }: { children: ReactNode }) => (\r\n  <h3 className=\"text-lg leading-6 font-medium text-gray-900\" id=\"modal-title\">\r\n    {children}\r\n  </h3>\r\n);\r\n","import { ModalBody } from 'app/ui-react-components/shared-components/modals/modal-body.component';\r\nimport { ModalContent } from 'app/ui-react-components/shared-components/modals/modal-content.component';\r\nimport { ModalFooter } from 'app/ui-react-components/shared-components/modals/modal-footer.component';\r\nimport { ModalHeader } from 'app/ui-react-components/shared-components/modals/modal-header.component';\r\nimport { ReactNode } from 'react';\r\n\r\ninterface IModal {\r\n  title: string;\r\n  actionText: string;\r\n  type: keyof typeof bgClasses;\r\n  handleClickAction: () => void;\r\n  closeFn: () => void;\r\n  animationClass: string;\r\n  children: ReactNode;\r\n  icon?: string;\r\n  disableAction?: boolean;\r\n}\r\n\r\nconst bgClasses = {\r\n  confirm: {\r\n    normal: 'bg-prussian-blue-500',\r\n    hover: 'bg-prussian-blue-600',\r\n    focus: 'bg-prussian-blue-800',\r\n  },\r\n  alert: {\r\n    normal: 'bg-red-600',\r\n    hover: 'bg-red-700',\r\n    focus: 'bg-red-900',\r\n  }\r\n};\r\n\r\nexport const Modal = ({ title, children, type, actionText, icon, handleClickAction, closeFn, animationClass, disableAction = false }: IModal) => {\r\n\r\n  return (\r\n    <div className=\"fixed z-10 inset-0 overflow-y-auto\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n      <div className=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n        <div className={`animate__animated ${animationClass} animate__faster fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity`} aria-hidden=\"true\"></div>\r\n\r\n        <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n\r\n        <div className={`animate__animated ${animationClass} animate__faster inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl sm:my-8 sm:align-middle sm:max-w-lg sm:w-full`}>\r\n          <ModalContent icon={icon}>\r\n            <ModalHeader>\r\n              {title}\r\n            </ModalHeader>\r\n            <ModalBody>\r\n              {children}\r\n            </ModalBody>\r\n          </ModalContent>\r\n          <ModalFooter>\r\n            <button\r\n              onClick={handleClickAction}\r\n              type=\"button\"\r\n              className={`w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 ${bgClasses[type].normal} text-base font-medium text-white hover:${bgClasses[type].focus} focus:outline-none focus:ring-0 focus:${bgClasses[type].focus} sm:ml-3 sm:w-auto sm:text-sm`}\r\n              disabled={disableAction}\r\n            >\r\n              {actionText}\r\n            </button>\r\n            <button onClick={closeFn} type=\"button\" className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-0 focus:bg-gray-200 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\">\r\n              Cancel\r\n            </button>\r\n          </ModalFooter>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n};\r\n","import { ANITA_URLS } from 'app/anita-routes/anita-routes.constant'\r\nimport { ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info'\r\nimport { ProjectDeletor } from 'app/libs/project-helpers/project-handlers/project-deletor.class'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { Modal } from 'app/ui-react-components/shared-components/modals/modal.component'\r\nimport { useState } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { useNavigate } from 'react-router'\r\n\r\nexport const DeleteProjectButton = ({ project }: { project: ProjectSettings }) => {\r\n\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [animationClass, setAnimationClass] = useState('animate__fadeIn');\r\n  const currentProject = useSelector((store: AnitaStore) => store.project);\r\n  const navigate = useNavigate();\r\n\r\n  const handleClickModal = () => {\r\n    if (isModalOpen) {\r\n      setAnimationClass('animate__fadeOut')\r\n      setTimeout(() => setIsModalOpen(false), 500);\r\n    } else {\r\n      setAnimationClass('animate__fadeIn')\r\n      setIsModalOpen(true)\r\n    }\r\n  }\r\n\r\n  const handleClickDelete = () => {\r\n    handleClickModal();\r\n    if (currentProject?.[RESERVED_AUDS_KEYS._settings][0]?.id === project.id)\r\n      storeDispatcher({ type: REDUX_ACTIONS.resetCurrentProject });\r\n    // This timeout must be equal or greater than the one in closeFn.\r\n    // Otherwise we would cause an update on an unmounted component.\r\n    setTimeout(() => {\r\n      new ProjectDeletor(project).delete();\r\n      navigate(ANITA_URLS.projectsList);\r\n    }, 500);\r\n  }\r\n\r\n  return (\r\n    <span>\r\n      <button onClick={handleClickModal} className=\"px-4 py-2 text-red-700 inline-flex items-center md:mb-2 lg:mb-0 rounded bg-red-700 bg-opacity-10 hover:bg-opacity-20 text-sm\">\r\n        <i className=\"bi-trash\"></i><span className=\"ml-2 hidden lg:inline-block\">Delete project</span>\r\n      </button>\r\n      {isModalOpen && <Modal\r\n        title=\"Delete Project\"\r\n        actionText=\"Delete\"\r\n        type=\"alert\"\r\n        handleClickAction={handleClickDelete}\r\n        closeFn={handleClickModal}\r\n        animationClass={animationClass}\r\n        icon=\"text-red-600 bi-exclamation-triangle\"\r\n      >\r\n        <p className=\"text-sm text-gray-500\">\r\n          Are you sure you want to delete this project?<br /><br />All project data will be permanently removed from this device. This action cannot be undone.<br /><br />Data stored on other devices will not be affected.\r\n        </p>\r\n\r\n      </Modal>\r\n      }\r\n    </span>\r\n  )\r\n}\r\n","import { URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\n\r\n/**\r\n * Accepts a url and a param and replaces all the occurences of the url param with a given value\r\n */\r\nexport function urlParamFiller(url: string, paramsToFill: Array<{ name: URL_PARAMS; value: string }>): string {\r\n  let result = url;\r\n  paramsToFill.forEach(params => { result = result.replace(new RegExp(`:${params.name}`, 'g'), params.value) });\r\n  return result;\r\n}","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { ProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport const EditButton = ({ project }: { project: ProjectSettings }) => (\r\n  <Link to={urlParamFiller(ANITA_URLS.projectEdit, [{ name: URL_PARAMS.projectId, value: project.id }])} className=\"px-4 py-3 text-gray-800 mr-3 inline-flex items-center ml-auto leading-none text-sm bg-gray-100 hover:bg-gray-200 rounded\">\r\n    <i className=\"bi-pencil\"></i> <span className=\"ml-2 hidden sm:inline-block\">Edit Project</span>\r\n  </Link>\r\n)","import { ReactNode } from 'react';\r\n\r\nexport const CardFooterItemsEnd = ({ children }: { children: ReactNode }) => (\r\n  <div className=\"flex items-end flex-wrap mt-6\">\r\n    {children}\r\n  </div>\r\n)","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { availableSystems } from 'app/data/project-form-builder/project-info-builder.constant';\r\nimport { ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function';\r\nimport { txtByFieldValue } from 'app/libs/project-helpers/txt-by-field-value.function';\r\nimport { DeleteProjectButton } from 'app/ui-react-components/shared-components/buttons/delete-project.component';\r\nimport { EditButton } from 'app/ui-react-components/shared-components/buttons/edit-project-button.component';\r\nimport { CardFooterItemsEnd } from 'app/ui-react-components/shared-components/common-ui-eles/card-footer-items-end.component';\r\nimport { Loader } from 'app/ui-react-components/shared-components/loader/loader.component';\r\nimport * as dateFormat from 'date-format';\r\nimport { useEffect, useState } from 'react';\r\nimport { Navigate, useParams } from 'react-router';\r\n\r\nconst LoadedProject = ({ project }: { project: ProjectSettings }) => (\r\n  <div className=\"p-6\">\r\n    <h1 className=\"title-font text-lg font-medium text-gray-900 mb-3\">{project.title}</h1>\r\n\r\n    <p className=\"text-gray-600 text-xs\">Description</p>\r\n    <p className=\"text-lg mb-3\">{project.description}</p>\r\n\r\n    <p className=\"text-gray-600 text-xs\">Created on:</p>\r\n    <p className=\"text-md mb-3\">{dateFormat('yyyy/MM/dd, at hh:mm', new Date(project.createdAt))}</p>\r\n\r\n    <p className=\"text-gray-600 text-xs\">Storage method:</p>\r\n    <p className=\"text-md\">{txtByFieldValue(availableSystems, project.localStorage)}</p>\r\n\r\n    <CardFooterItemsEnd>\r\n      <DeleteProjectButton project={project} />\r\n      <EditButton project={project} />\r\n    </CardFooterItemsEnd>\r\n\r\n  </div>\r\n)\r\n\r\nexport const ProjectDetails = () => {\r\n\r\n  const urlParams = useParams();\r\n  const projectId = urlParams[URL_PARAMS.projectId];\r\n  const [project, setElement] = useState<ProjectSettings>(null);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n    const loadProject = async () => {\r\n      const canProceed = await isProjectLoaded(projectId);\r\n\r\n      if (!canProceed)\r\n        return setElement(undefined);\r\n\r\n      const project = await dbInstances[projectId].callSelector<ProjectSettings>(RESERVED_AUDS_KEYS._settings).single();\r\n      if (isMounted)\r\n        setElement(project);\r\n    }\r\n\r\n    if (isMounted)\r\n      loadProject();\r\n\r\n    return () => { isMounted = false; }\r\n\r\n  }, [projectId]);\r\n\r\n  // If there is no DB instance loaded, for now we just redirect to the project list\r\n  if (project === undefined)\r\n    return <Navigate to={ANITA_URLS.projectsList} />;\r\n\r\n  return (\r\n    <div className=\"relative border-2 border-gray-200 border-opacity-60 rounded bg-white\" style={{ minHeight: \"200px\" }}>\r\n      {(project === null) ? <Loader /> : <LoadedProject project={project} />}\r\n    </div>\r\n  )\r\n\r\n}\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { DANGER_BTN_OUTLINE } from 'app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const';\r\nimport { Modal } from 'app/ui-react-components/shared-components/modals/modal.component';\r\nimport { useState } from 'react';\r\nimport { useNavigate } from 'react-router';\r\nimport ReactTooltip from 'react-tooltip';\r\n\r\nexport const DeleteSectionElementButton = ({ projectId, sectionId, elementId }: { projectId: string, sectionId: string, elementId: string }) => {\r\n\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [animationClass, setAnimationClass] = useState('animate__fadeIn');\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const handleClickModal = () => {\r\n    if (isModalOpen) {\r\n      setAnimationClass('animate__fadeOut')\r\n      setTimeout(() => setIsModalOpen(false), 500);\r\n    } else {\r\n      setAnimationClass('animate__fadeIn')\r\n      setIsModalOpen(true)\r\n    }\r\n  }\r\n\r\n  const handleClickDelete = () => {\r\n    handleClickModal();\r\n    // This timeout must be equal or greater than the one in closeFn.\r\n    // Otherwise we would cause an update on an unmounted component.\r\n    setTimeout(() => {\r\n      dbInstances[projectId].callDeletor(sectionId, { id: elementId }).autoDelete();\r\n      navigate(urlParamFiller(ANITA_URLS.projectSectionElesList, [{ name: URL_PARAMS.projectId, value: projectId }, { name: URL_PARAMS.sectionId, value: sectionId }]));\r\n    }, 500);\r\n  }\r\n\r\n  return (\r\n    <span>\r\n      <button data-tip data-for=\"deleteElement\" onClick={handleClickModal} className={`${DANGER_BTN_OUTLINE} mt-6 px-4 py-2`}>\r\n        <i className=\"bi-trash\"></i>\r\n      </button>\r\n      <ReactTooltip id=\"deleteElement\" effect=\"solid\">Delete element</ReactTooltip>\r\n      {isModalOpen && <Modal\r\n        title=\"Delete element\"\r\n        actionText=\"Delete\"\r\n        type=\"alert\"\r\n        handleClickAction={handleClickDelete}\r\n        closeFn={handleClickModal}\r\n        animationClass={animationClass}\r\n        icon=\"text-red-600 bi-exclamation-triangle\"\r\n      >\r\n        <p className=\"text-sm text-gray-500\">\r\n          Are you sure you want to delete this element?\r\n        </p>\r\n        <p className=\"text-sm text-gray-500\">\r\n          This action cannot be undone.\r\n        </p>\r\n\r\n      </Modal>\r\n      }\r\n    </span>\r\n  )\r\n}\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport {\r\n  ParentInfoForDetailsView,\r\n  RESERVED_AUDS_KEYS,\r\n  SectionElement,\r\n  SystemData\r\n  } from 'app/data/project-structure/project-info';\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant';\r\nimport { findFirstUserDefinedField } from 'app/libs/tools/find-first-user-defined-field.function';\r\nimport { findSectionById } from 'app/libs/tools/find-section-by-id.function';\r\nimport { asyncForEach } from 'app/libs/tools/tools';\r\nimport { FormModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\n\r\nexport class GetParentInfoForDetailsView {\r\n\r\n  private parentInfoForDetailsView: Array<ParentInfoForDetailsView> = [];\r\n\r\n  constructor(\r\n    private listOfParents: Array<string>,\r\n    private projectId: string,\r\n    private sections: SystemData[RESERVED_AUDS_KEYS._sections]\r\n  ) { }\r\n\r\n  public async get(): Promise<Array<ParentInfoForDetailsView>> {\r\n    await asyncForEach(this.listOfParents, async sectionIdElementId => await this.processElement(sectionIdElementId));\r\n    return this.parentInfoForDetailsView;\r\n  }\r\n\r\n  private async processElement(sectionIdElementId: string): Promise<void> {\r\n    const arrInfo = sectionIdElementId.split('|');\r\n    const element = await dbInstances[this.projectId].callSelector<SectionElement>(arrInfo[0], { [RESERVED_FIELDS.id]: arrInfo[1] }).single();\r\n    const section = findSectionById(this.sections, arrInfo[0]);\r\n    const indexFirstUserFiield = findFirstUserDefinedField(section.formModel as FormModel);\r\n    this.parentInfoForDetailsView.push({\r\n      sectionId: arrInfo[0],\r\n      element,\r\n      txt: element[section.formModel[indexFirstUserFiield].fieldName]\r\n    });\r\n  }\r\n}\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { ParentInfoForDetailsView, Section } from 'app/data/project-structure/project-info';\r\nimport { GetParentInfoForDetailsView } from 'app/libs/project-helpers/get-parent-info-for-details-view.class';\r\nimport { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport const ParentsLinkShower = ({ projectId, parentsInfo, sections }: { projectId: string, parentsInfo: Array<string>, sections: Array<Section> }) => {\r\n\r\n  const [parents, setParents] = useState<Array<ParentInfoForDetailsView>>([]);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const getParents = async () => {\r\n      const parents = await new GetParentInfoForDetailsView(parentsInfo, projectId, sections).get();\r\n      if (isMounted) {\r\n        setParents(parents);\r\n      }\r\n    }\r\n\r\n    if (isMounted)\r\n      getParents();\r\n\r\n    return (): void => { isMounted = false; };\r\n  }, [parentsInfo, projectId, sections]);\r\n\r\n  return (\r\n    <div className=\"p-3 pt-0\">\r\n      <p className=\"text-sm text-gray-500 mb-2\">Parent elements:</p>\r\n      {parents.map((parent, index) => (\r\n        <Link to={urlParamFiller(ANITA_URLS.projectSectionEleDetails, [\r\n          { name: URL_PARAMS.projectId, value: projectId },\r\n          { name: URL_PARAMS.sectionId, value: parent.sectionId },\r\n          { name: URL_PARAMS.elementId, value: parent.element.id }\r\n        ])} key={parent.element.id} className=\"mr-2 py-1 px-4 bg-gray-200 hover:bg-gray-300 bg-opacity-80 rounded-md text-sm font-semibold\">\r\n          {parent.txt}\r\n        </Link>\r\n      ))}\r\n    </div>\r\n  )\r\n\r\n};","export const BasicText = ({ value }) => value || null;\r\n","export const CheckBoxAsCheck = ({ value }: { value: boolean }) => value ? '✓' : null;\r\n","export const Color = ({ value }) => value\r\n  ? <div className=\"rounded-full\" style={{ backgroundColor: value, width: '25px' }}>&nbsp;</div>\r\n  : null;\r\n","export const Email = ({ value }) => value\r\n  ? <a href={`mailto:${value}`} target=\"_blank\" rel=\"noreferrer\" className=\"underline\">{value}</a>\r\n  : null;\r\n\r\n","import * as dateFormat from 'date-format';\r\n\r\nexport const FormattedDateTime = ({ value }: { value: string }) => value ? dateFormat('yyyy/MM/dd hh:mm', new Date(value)) : null;\r\n","import * as dateFormat from 'date-format';\r\n\r\nexport const FormattedDate = ({ value }: { value: string }) => value ? dateFormat('yyyy/MM/dd', new Date(value)) : null;\r\n","export const Month = ({ value }: { value: string }) => value\r\n  ? new Date(value).toLocaleString('default', { month: 'short', year: 'numeric' })\r\n  : null;\r\n","import { useState } from 'react'\r\n\r\nexport const Password = ({ value }) => {\r\n  const [showPassword, setShowPassword] = useState(false);\r\n\r\n  if (!value) return null;\r\n\r\n  return (\r\n    <>\r\n      {showPassword\r\n        ? value\r\n        : value.replace(/./g, '*')\r\n      }\r\n      <button\r\n        type=\"button\"\r\n        className={showPassword ? 'bi-eye-slash-fill ml-3' : 'bi-eye-fill ml-3'}\r\n        onClick={() => setShowPassword(!showPassword)}\r\n      >\r\n        <i />\r\n      </button>\r\n    </>\r\n  );\r\n}\r\n","export const Percentage = ({ value }) => value ? <span>{value}%</span> : null;","export const Tel = ({ value }) => value\r\n  ? <a href={`tel:${value}`} target=\"_blank\" rel=\"noreferrer\" className=\"underline\">{value}</a>\r\n  : null;\r\n\r\n","import { txtByFieldValue } from 'app/libs/project-helpers/txt-by-field-value.function';\r\nimport { OptionKeysModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\n\r\nexport const TextFromOptionsByValue = (options: Array<OptionKeysModel>, { value }: { value: string | number }) => txtByFieldValue(options, value);\r\n","import { removeProtocolFromUrl } from 'app/libs/tools/remove-protocol-from-url.function'\r\n\r\nexport const Url = ({ value }) => value\r\n  ? <a href={value} target=\"_blank\" rel=\"noreferrer\" className=\"underline\">{removeProtocolFromUrl(value)}</a>\r\n  : null;\r\n\r\n","export const removeProtocolFromUrl = (url: string) => url.replace(/^(?:https?:\\/\\/)?(?:www\\.)?/i, '');","export const Week = ({ value }: { value: string }) => value\r\n  ? value.split('-W').reverse().join('-').replace(/0(\\d+)/, \"$1\")\r\n  : null;\r\n","import { BasicText } from 'app/ui-react-components/project/values-renderers/basic-text.component'\r\nimport { CheckBoxAsCheck } from 'app/ui-react-components/project/values-renderers/check-box-as-check.component'\r\nimport { Color } from 'app/ui-react-components/project/values-renderers/color.component'\r\nimport { Email } from 'app/ui-react-components/project/values-renderers/email.component'\r\nimport { FormattedDateTime } from 'app/ui-react-components/project/values-renderers/formatted-date-time.component'\r\nimport { FormattedDate } from 'app/ui-react-components/project/values-renderers/formatted-date.component'\r\nimport { Month } from 'app/ui-react-components/project/values-renderers/month.component'\r\nimport { Password } from 'app/ui-react-components/project/values-renderers/password.component'\r\nimport { Percentage } from 'app/ui-react-components/project/values-renderers/range.component'\r\nimport { Tel } from 'app/ui-react-components/project/values-renderers/tel.component'\r\nimport { TextFromOptionsByValue } from 'app/ui-react-components/project/values-renderers/text-from-options-by-value.component'\r\nimport { Url } from 'app/ui-react-components/project/values-renderers/url.component'\r\nimport { Week } from 'app/ui-react-components/project/values-renderers/week.component'\r\nimport { FormFieldsModel, SupportedFormsTypes } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { FORM_COMPONENTS_CODES } from 'app/ui-react-components/shared-components/forms-automator/form-component-codes.enum'\r\nimport { DateInputSupportedTypes, DateTimeInputSupportedTypes, TextInputSupportedTypes } from 'app/ui-react-components/shared-components/forms-automator/input-supported-types.const'\r\n\r\nexport const customRenderPicker = (formModel: FormFieldsModel<SupportedFormsTypes>) => {\r\n  const componentCode = typeof formModel.componentCode === 'string' ? parseInt(formModel.componentCode, 10) : formModel.componentCode;\r\n  switch (componentCode) {\r\n    case FORM_COMPONENTS_CODES.basicInput:\r\n      return handleInputType(formModel.type)\r\n    case FORM_COMPONENTS_CODES.datePicker:\r\n      return handleDateType(formModel.type)\r\n    case FORM_COMPONENTS_CODES.dateTimePicker:\r\n      return handleDateTimeType(formModel.type)\r\n    case FORM_COMPONENTS_CODES.basicTextarea:\r\n      return BasicText;\r\n    case FORM_COMPONENTS_CODES.basicSelect:\r\n    case FORM_COMPONENTS_CODES.basicRadio:\r\n      return TextFromOptionsByValue.bind(null, formModel['options']);\r\n    case FORM_COMPONENTS_CODES.basicCheckbox:\r\n      return CheckBoxAsCheck;\r\n    default:\r\n      return BasicText\r\n  }\r\n}\r\n\r\nconst handleInputType = (type: TextInputSupportedTypes | DateInputSupportedTypes | DateTimeInputSupportedTypes) => {\r\n  switch (type) {\r\n    case TextInputSupportedTypes.color:\r\n      return Color;\r\n    case TextInputSupportedTypes.email:\r\n      return Email;\r\n    case TextInputSupportedTypes.tel:\r\n      return Tel;\r\n    case TextInputSupportedTypes.url:\r\n      return Url;\r\n    case TextInputSupportedTypes.password:\r\n      return Password;\r\n    case TextInputSupportedTypes.range:\r\n      return Percentage;\r\n    case TextInputSupportedTypes.number:\r\n    case TextInputSupportedTypes.text:\r\n    default:\r\n      return BasicText;\r\n  }\r\n}\r\n\r\nconst handleDateType = (type: TextInputSupportedTypes | DateInputSupportedTypes | DateTimeInputSupportedTypes) => {\r\n  switch (type) {\r\n    case DateInputSupportedTypes.month:\r\n      return Month;\r\n    case DateInputSupportedTypes.week:\r\n      return Week;\r\n    case DateInputSupportedTypes.date:\r\n    default:\r\n      return FormattedDate;\r\n  }\r\n}\r\n\r\nconst handleDateTimeType = (type: TextInputSupportedTypes | DateInputSupportedTypes | DateTimeInputSupportedTypes) => {\r\n  switch (type) {\r\n    case DateTimeInputSupportedTypes.time:\r\n      return BasicText;\r\n    case DateTimeInputSupportedTypes.datetimeLocal:\r\n    default:\r\n      return FormattedDateTime;\r\n  }\r\n}","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\nimport { Link } from 'react-router-dom';\r\n\r\ninterface IAddElementButtonProps {\r\n  projectId: string;\r\n  sectionId: string;\r\n  mode: EDITOR_MODE.add;\r\n  elementId?: never;\r\n}\r\n\r\ninterface IEditElementButtonProps {\r\n  projectId: string;\r\n  sectionId: string;\r\n  elementId: string;\r\n  mode: EDITOR_MODE.edit;\r\n}\r\n\r\ntype IAddEditElementButtonProps = | IAddElementButtonProps | IEditElementButtonProps;\r\n\r\nexport const AddEditElementButton = ({ projectId, sectionId, mode, elementId }: IAddEditElementButtonProps) => {\r\n\r\n  const icon = mode === EDITOR_MODE.add ? 'bi-plus' : 'bi-pencil';\r\n  const urlParamsToFill = [{ name: URL_PARAMS.projectId, value: projectId }, { name: URL_PARAMS.sectionId, value: sectionId }];\r\n\r\n  if (mode === EDITOR_MODE.edit)\r\n    urlParamsToFill.push({ name: URL_PARAMS.elementId, value: elementId })\r\n\r\n  const urlToFill = mode === EDITOR_MODE.add ? ANITA_URLS.projectSectionAddEle : ANITA_URLS.projectSectionEditEle;\r\n\r\n  const url: string = urlParamFiller(urlToFill, urlParamsToFill);\r\n\r\n  return (\r\n    <Link to={url} className=\"absolute bottom-5 right-7 md:bottom-7 md:right-10 bg-prussian-blue-400 text-white text-xl shadow-xl rounded-3xl h-14 w-14 flex items-center justify-center\">\r\n      <i className={icon}></i>\r\n    </Link>\r\n  )\r\n\r\n}","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { RESERVED_AUDS_KEYS, SectionElement } from 'app/data/project-structure/project-info';\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { findSectionById } from 'app/libs/tools/find-section-by-id.function';\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\nimport { DeleteSectionElementButton } from 'app/ui-react-components/project/details-components/delete-section-element-button.component';\r\nimport { ParentsLinkShower } from 'app/ui-react-components/project/details-components/parents-link-shower.component';\r\nimport { customRenderPicker } from 'app/ui-react-components/project/values-renderers/custom-render-picker.component';\r\nimport { AddEditElementButton } from 'app/ui-react-components/shared-components/buttons/add-edit-element-button.component';\r\nimport { MainContentContainer } from 'app/ui-react-components/shared-components/common-ui-eles/main-content-container.component';\r\nimport { FormFieldsModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\nimport { Loader } from 'app/ui-react-components/shared-components/loader/loader.component';\r\nimport { useEffect, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Navigate, useParams } from 'react-router-dom';\r\n\r\nexport const SectionElementDetails = () => {\r\n\r\n  const [element, setElement] = useState<SectionElement>(null);\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n  const params = useParams();\r\n  const projectId = params[URL_PARAMS.projectId];\r\n  const sectionId = params[URL_PARAMS.sectionId];\r\n  const elementId = params[URL_PARAMS.elementId];\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const fetchData = async () => {\r\n      const canProceed = await isProjectLoaded(projectId);\r\n\r\n      if (!projectId || !sectionId || !elementId || !canProceed)\r\n        return setElement(undefined);\r\n\r\n      const element = await dbInstances[projectId].callSelector<SectionElement>(sectionId, { id: elementId }).single();\r\n\r\n      if (isMounted)\r\n        setElement(element);\r\n    }\r\n\r\n    if (isMounted)\r\n      fetchData();\r\n\r\n    return () => { isMounted = false };\r\n  }, [projectId, sectionId, elementId, project]);\r\n\r\n  if (element === undefined) {\r\n    if (projectId && sectionId)\r\n      return <Navigate to={urlParamFiller(ANITA_URLS.projectSectionElesList, [{ name: URL_PARAMS.projectId, value: projectId }, { name: URL_PARAMS.sectionId, value: sectionId }])} />\r\n    else\r\n      return <Navigate to={ANITA_URLS.projectsList} />\r\n  }\r\n\r\n  return (\r\n    <MainContentContainer headerText=\"Details\">\r\n      {(element === null || project === null) ? <Loader /> : <ElementValuesViewer element={element} formModels={findSectionById(project[RESERVED_AUDS_KEYS._sections], sectionId).formModel as Array<FormFieldsModel<SectionElement>>} />}\r\n      {(element !== null && element.parentsInfo && Array.isArray(element.parentsInfo) && element.parentsInfo.length > 0) && <ParentsLinkShower projectId={projectId} parentsInfo={element.parentsInfo} sections={project[RESERVED_AUDS_KEYS._sections]} />}\r\n      {(element !== null && (<div>\r\n        <DeleteSectionElementButton projectId={projectId} sectionId={sectionId} elementId={elementId} />\r\n        <AddEditElementButton projectId={projectId} sectionId={sectionId} elementId={elementId} mode={EDITOR_MODE.edit} />\r\n      </div>\r\n      )\r\n      )}\r\n    </MainContentContainer>\r\n  )\r\n\r\n}\r\n\r\nconst ElementValuesViewer = ({ element, formModels }: { element: SectionElement, formModels: Array<FormFieldsModel<SectionElement>> }) => {\r\n\r\n  return (\r\n    <div className=\"p-3\">\r\n      {formModels.map((formModel) => {\r\n        if (!formModel.label)\r\n          return null;\r\n\r\n        return <ValueWithLabel key={formModel.fieldName} formModel={formModel} value={element[formModel.fieldName]} />\r\n      }\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nconst ValueWithLabel = ({ formModel, value }: { formModel: FormFieldsModel<SectionElement>, value: any }) => {\r\n  if (typeof value === 'undefined')\r\n    return null;\r\n\r\n  return (\r\n    <div>\r\n      <p className=\"text-sm text-gray-500\">{formModel.label}</p>\r\n      <p className=\"mb-3\">{customRenderPicker(formModel)({ value })}</p>\r\n    </div>\r\n  )\r\n}\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function'\r\nimport { ReactNode } from 'react'\r\nimport { useNavigate, useParams } from 'react-router-dom'\r\n\r\nexport const TdWithLinkToDetails = ({ children, tdProps, elementId }: { children: ReactNode, tdProps: {}, elementId: string }) => {\r\n\r\n  const navigation = useNavigate();\r\n  const params = useParams();\r\n\r\n  const handleClick = (e: React.MouseEvent<HTMLElement, MouseEvent>) => {\r\n    const target = e.target as HTMLElement;\r\n    // if the target is a link, do nothing\r\n    if (target.tagName === 'A' || target.tagName === 'BUTTON')\r\n      return;\r\n    navigation(urlParamFiller(ANITA_URLS.projectSectionEleDetails, [\r\n      { name: URL_PARAMS.projectId, value: params.projectId },\r\n      { name: URL_PARAMS.sectionId, value: params.sectionId },\r\n      { name: URL_PARAMS.elementId, value: elementId }\r\n    ]))\r\n  }\r\n\r\n  return (\r\n    <td\r\n      onClick={handleClick}\r\n      className=\"px-6 py-4 cursor-pointer\"\r\n      {...tdProps}\r\n    >\r\n      {children}\r\n    </td>\r\n  )\r\n\r\n}","import { SectionElement } from 'app/data/project-structure/project-info';\r\nimport { Section } from 'app/data/project-structure/project-info';\r\nimport { TdWithLinkToDetails } from 'app/ui-react-components/project/list-components/td-with-link-to-details.component';\r\nimport { customRenderPicker } from 'app/ui-react-components/project/values-renderers/custom-render-picker.component';\r\nimport { useMemo } from 'react';\r\nimport { useSortBy, useTable } from 'react-table';\r\n\r\n/**\r\n * Builds the columns for the table with react-table looping through sectionInfo\r\n */\r\nconst useSectionInfo = (sectionInfo: Section) => {\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const colsToShoww = useMemo(() => [], [sectionInfo.id, sectionInfo.formModel]);\r\n  useMemo(\r\n    () => {\r\n      return sectionInfo.formModel.forEach(formModel => {\r\n        if (sectionInfo.id && formModel.label)\r\n          colsToShoww.push({\r\n            Header: formModel.label,\r\n            accessor: formModel.fieldName,\r\n            Cell: customRenderPicker(formModel),\r\n          });\r\n      }\r\n      )\r\n    },\r\n\r\n    [sectionInfo.id, sectionInfo.formModel, colsToShoww]\r\n  )\r\n  return colsToShoww;\r\n}\r\n\r\n\r\nexport const TableList = ({ sectionInfo, sectionData }: { sectionInfo: Section; sectionData: Array<SectionElement> }) => {\r\n  const columns = useSectionInfo(sectionInfo);\r\n\r\n  const {\r\n    getTableProps,\r\n    getTableBodyProps,\r\n    headerGroups,\r\n    rows,\r\n    prepareRow,\r\n  } = useTable({ columns, data: sectionData }, useSortBy);\r\n\r\n  return (\r\n    // apply the table props\r\n    <table className=\"table-auto w-full divide-y divide-gray-200\" {...getTableProps()}>\r\n      <thead className=\"bg-gray-50\">\r\n        {// Loop over the header rows\r\n          headerGroups.map(headerGroup => (\r\n            // Apply the header row props\r\n            <tr {...headerGroup.getHeaderGroupProps()}>\r\n              {// Loop over the headers in each row\r\n                headerGroup.headers.map(column => (\r\n                  // Apply the header cell props\r\n                  <th className=\"px-6 py-2 text-xs text-gray-500 text-left\" {...column.getHeaderProps(column.getSortByToggleProps())}>\r\n                    {// Render the header\r\n                      column.render('Header')}\r\n                  </th>\r\n                ))}\r\n            </tr>\r\n          ))}\r\n      </thead>\r\n      {/* Apply the table body props */}\r\n      <tbody className=\"divide-y divide-gray-200\" {...getTableBodyProps()}>\r\n        {// Loop over the table rows\r\n          rows.map(row => {\r\n            // Prepare the row for display\r\n            prepareRow(row)\r\n            return (\r\n              // Apply the row props\r\n              <tr className=\"whitespace-nowrap\" {...row.getRowProps()}>\r\n                {// Loop over the rows cells\r\n                  row.cells.map(cell => {\r\n                    // TODO No Link to details for checkbox\r\n                    // Apply the cell props\r\n                    return (\r\n                      <TdWithLinkToDetails key={`${cell.column.id}${cell.row.id}`} tdProps={cell.getCellProps()} elementId={cell.row.original.id}>\r\n                        {cell.render('Cell')}\r\n                      </TdWithLinkToDetails>\r\n                    )\r\n                  })}\r\n              </tr>\r\n            )\r\n          })}\r\n      </tbody>\r\n    </table>\r\n  )\r\n\r\n}\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport const NoSectionData = ({ sectionTitle, sectionId, projectId }: { sectionTitle: string, sectionId: string, projectId: string }) => (\r\n  <div className=\"container px-5 py-24 mx-auto\">\r\n    <div className=\"p-4 lg:w-2/3 mx-auto\">\r\n      <div className=\"h-full bg-white shadow px-8 pt-16 pb-16 rounded-lg overflow-hidden text-center relative\">\r\n        <h2 className=\"tracking-widest text-xs title-font font-medium text-gray-400 mb-1\">Nothing here yet</h2>\r\n        <h1 className=\"title-font sm:text-2xl text-xl font-medium text-gray-900 mb-3\">There are no items in {sectionTitle}</h1>\r\n        <p className=\"leading-relaxed mb-3\">Create a new entry to populate this list</p>\r\n        <div className=\"flex flex-wrap mt-7\">\r\n          <Link\r\n            to={urlParamFiller(ANITA_URLS.projectSectionAddEle, [{ name: URL_PARAMS.projectId, value: projectId }, { name: URL_PARAMS.sectionId, value: sectionId }])}\r\n            className=\"flex-grow mx-2 mt-4 text-white bg-prussian-blue-400 border-0 py-3 px-8 focus:outline-none hover:bg-prussian-blue-500 rounded font-bold text-sm\"\r\n          >Create a new element\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { RESERVED_AUDS_KEYS, SectionElement } from 'app/data/project-structure/project-info';\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { findSectionById } from 'app/libs/tools/find-section-by-id.function';\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum';\r\nimport { TableList } from 'app/ui-react-components/project/list-components/tableList.component';\r\nimport { NoSectionData } from 'app/ui-react-components/project/no-section-data.component';\r\nimport { AddEditElementButton } from 'app/ui-react-components/shared-components/buttons/add-edit-element-button.component';\r\nimport { MainContentContainer } from 'app/ui-react-components/shared-components/common-ui-eles/main-content-container.component';\r\nimport { Loader } from 'app/ui-react-components/shared-components/loader/loader.component';\r\nimport { useEffect, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Navigate, useParams } from 'react-router';\r\n\r\nexport const SectionElementsList = () => {\r\n\r\n  const params = useParams();\r\n  const projectId = params[URL_PARAMS.projectId];\r\n  const sectionId = params[URL_PARAMS.sectionId];\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n  const [sectionData, setSectionData] = useState<Array<SectionElement>>(null);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const getSectionData = async () => {\r\n      const canProceed = await isProjectLoaded(projectId);\r\n\r\n      if (!canProceed)\r\n        return setSectionData(undefined);\r\n\r\n      const data = await dbInstances[projectId].callSelector<SectionElement>(sectionId).multiple();\r\n      if (isMounted)\r\n        setSectionData(data);\r\n    }\r\n\r\n    if (isMounted)\r\n      getSectionData();\r\n\r\n    return () => { isMounted = false; };\r\n  }, [sectionId, projectId]);\r\n\r\n  if (sectionData === undefined)\r\n    return <Navigate to={ANITA_URLS.projectsList} />;\r\n\r\n  if (project === null || sectionData === null)\r\n    return <Loader />;\r\n\r\n  const sectionInfo = findSectionById(project[RESERVED_AUDS_KEYS._sections], sectionId);\r\n\r\n  if (!sectionInfo)\r\n    return null;\r\n\r\n  if (sectionData.length === 0)\r\n    return <NoSectionData sectionId={sectionId} sectionTitle={sectionInfo.title} projectId={projectId} />;\r\n\r\n  return (\r\n    <MainContentContainer headerText={sectionInfo.title}>\r\n      <TableList sectionInfo={sectionInfo} sectionData={sectionData} />\r\n      <AddEditElementButton projectId={projectId} sectionId={sectionId} mode={EDITOR_MODE.add} />\r\n    </MainContentContainer>\r\n  )\r\n\r\n}","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { AdditionalInfoForLocalStorage, LocalProjectSettings, ProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { CLIENT_SECTIONS } from 'app/data/system-local-db/client-sections.enum';\r\n\r\n/**\r\n * Saves project's settings in IndexedDB.\r\n */\r\nexport class SaveProjectSettingsInIndexedDB {\r\n\r\n  /**\r\n   * Copy of the settings of the project to be saved in IndexedDB\r\n   */\r\n  private copyOfProjectSettings: LocalProjectSettings;\r\n\r\n  /**\r\n   * Creates an instance of save project settings in indexed db.\r\n   * @param projectSettings settings Object of the project to store\r\n   * @param fileHandle handle of the file on disk. Saved in the IndexedDB for future use\r\n   */\r\n  constructor(\r\n    private projectSettings: ProjectSettings,\r\n    private localSettingAdditionalKeys: AdditionalInfoForLocalStorage\r\n  ) { }\r\n\r\n  /**\r\n   * Saves the project settings in IndexedDB with its additional keys for handling local storage\r\n   * @returns save \r\n   */\r\n  public async save(): Promise<LocalProjectSettings> {\r\n    this.setProjectSettingsCloneWithAdditionalKeys();\r\n    this.doStoreProjectSettings();\r\n\r\n    return this.copyOfProjectSettings;\r\n  }\r\n\r\n  /**\r\n   * Deep clonse settings and then adds the fileHandle to prevent setting the fileHandle on the project data object\r\n   */\r\n  private setProjectSettingsCloneWithAdditionalKeys(): void {\r\n    this.copyOfProjectSettings = { ...this.projectSettings, ...this.localSettingAdditionalKeys };\r\n  }\r\n\r\n  /**\r\n   * Stores the project settings with db-connector\r\n   */\r\n  private doStoreProjectSettings(): void {\r\n    dbInstances.system.callInsertor(CLIENT_SECTIONS.projects, this.copyOfProjectSettings).autoInsert();\r\n  }\r\n}\r\n","import { DbInitializer } from 'app/data/local-dbs/db-initializer.class'\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const'\r\nimport { RESERVED_AUDS_KEYS, SystemData } from 'app/data/project-structure/project-info'\r\nimport { SaveProjectSettingsInIndexedDB } from 'app/libs/project-helpers/project-handlers/save-project-settings-in-indexeddb.class'\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum'\r\n\r\nexport class ProjectSaver {\r\n\r\n  constructor(\r\n    private project: SystemData = {\r\n      [RESERVED_AUDS_KEYS._settings]: [],\r\n      [RESERVED_AUDS_KEYS._sections]: []\r\n    },\r\n    private mode: EDITOR_MODE\r\n\r\n  ) { }\r\n\r\n  public async save(): Promise<SystemData> {\r\n    console.log('save ~ this.projectDataToSave[RESERVED_AUDS_KEYS._sections]', this.project[RESERVED_AUDS_KEYS._sections])\r\n\r\n    this.setcreatedAt();\r\n\r\n    if (this.mode === EDITOR_MODE.edit)\r\n      this.setupdatedAt();\r\n\r\n    if (!dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id])\r\n      await this.initDbInstance();\r\n\r\n\r\n    await this.saveSettings();\r\n    await this.saveSections();\r\n\r\n    await this.postSaveActions();\r\n\r\n    return this.project;\r\n  }\r\n\r\n  private setcreatedAt(): void {\r\n    this.project[RESERVED_AUDS_KEYS._settings][0].createdAt = new Date(new Date().toUTCString()).toISOString();\r\n  }\r\n\r\n  private setupdatedAt(): void {\r\n    this.project[RESERVED_AUDS_KEYS._settings][0].updatedAt = new Date(new Date().toUTCString()).toISOString();\r\n  }\r\n\r\n  private async initDbInstance(): Promise<void> {\r\n    await new DbInitializer(this.project[RESERVED_AUDS_KEYS._settings][0], this.project[RESERVED_AUDS_KEYS._sections]).init();\r\n  }\r\n\r\n  private async saveSettings(): Promise<void> {\r\n    await dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id].callInsertor(RESERVED_AUDS_KEYS._settings, this.project[RESERVED_AUDS_KEYS._settings][0]).autoInsert();\r\n  }\r\n\r\n  private async saveSections(): Promise<void> {\r\n    await dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id].callDeletor(RESERVED_AUDS_KEYS._sections).clearSection();\r\n    await dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id].callInsertor(RESERVED_AUDS_KEYS._sections, this.project[RESERVED_AUDS_KEYS._sections]).autoInsert();\r\n  }\r\n\r\n  private async postSaveActions(): Promise<void> {\r\n    const methodName = this.mode === EDITOR_MODE.add ? 'postProjectCreation' : 'postProjectUpdate';\r\n    const payload = await dbInstances[this.project[RESERVED_AUDS_KEYS._settings][0].id].dbStore[methodName]?.(this.project) || {};\r\n\r\n    await new SaveProjectSettingsInIndexedDB(this.project[RESERVED_AUDS_KEYS._settings][0], payload).save();\r\n\r\n  }\r\n\r\n}\r\n","import { URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { PROJECT_EDITOR_FORM_BUILDER } from 'app/data/project-form-builder/project-editor-form-builder.const'\r\nimport { RESERVED_AUDS_KEYS, Section } from 'app/data/project-structure/project-info'\r\nimport { autoGenerateFieldName } from 'app/libs/project-helpers/auto-generate-field-name.function'\r\nimport {\r\n  IUpdateFormProjectUpdateFormModelAddOptionPayload,\r\n  IUpdateFormProjectUpdateFormModelDeleteOptionPayload,\r\n  IUpdateFormProjectUpdateFormModelOfSectionPayload,\r\n  IUpdateFormProjectUpdateFormModelOptionValuePayload\r\n  } from 'app/libs/redux/action.type'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum'\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component'\r\nimport {\r\n  FormAutomatorOnChangeValue,\r\n  FormFieldsModel,\r\n  OptionKeysModel,\r\n  SupportedFormsTypes\r\n  } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { useMemo } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { useParams } from 'react-router'\r\n\r\ninterface ISectionFormModelManagerProps {\r\n  indexSection: number;\r\n  indexFormElement: number;\r\n  element: FormFieldsModel<SupportedFormsTypes>;\r\n}\r\n\r\nconst getAlreadyExists = (section: Section, fieldName: string): boolean => {\r\n  if (!fieldName || !section) return false;\r\n  return section.formModel.some(formElement => formElement.fieldName === fieldName);\r\n}\r\n\r\nexport const SectionFormModelManager = (props: ISectionFormModelManagerProps) => {\r\n\r\n  const { indexSection, indexFormElement, element } = props;\r\n\r\n  const params = useParams();\r\n  const projectEditorMode = useSelector((store: AnitaStore) => store.formProject.mode);\r\n  const section = useSelector((state: AnitaStore) => state.formProject.original[RESERVED_AUDS_KEYS._sections][indexSection]);\r\n  const projectId = params[URL_PARAMS.projectId];\r\n  const mode = useMemo(() => projectId ? EDITOR_MODE.edit : EDITOR_MODE.add, [projectId]);\r\n  const alreadyExists = getAlreadyExists(section, element.fieldName);\r\n  const formModelToUse = useMemo(() => mode === EDITOR_MODE.edit && alreadyExists ?\r\n    PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].sectionEles.existingItem :\r\n    PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].sectionEles.newItem,\r\n    [alreadyExists, mode, projectEditorMode]\r\n  );\r\n\r\n  const handleChange = (indexSection: number, indexFormElement: number, fieldName: string | number, value: FormAutomatorOnChangeValue) => {\r\n    const identifierAutoVal: string | null = fieldName === 'label' && !alreadyExists ? autoGenerateFieldName(value) : null;\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.updateFormProjectUpdateFormModelOfSection, payload: {\r\n        indexSection,\r\n        indexFormElement,\r\n        identifierAutoVal,\r\n        fieldName,\r\n        value\r\n      } as IUpdateFormProjectUpdateFormModelOfSectionPayload\r\n    });\r\n  }\r\n\r\n  const handleOptionsChange = (indexSection: number, indexFormElement: number, indexOptions: number, optionElement: OptionKeysModel, fieldName: string | number, value: FormAutomatorOnChangeValue) => {\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.updateFormProjectUpdateFormModelOptionValue, payload: {\r\n        indexSection,\r\n        indexFormElement,\r\n        indexOptions,\r\n        formElement: { ...optionElement, [fieldName]: value }\r\n      } as IUpdateFormProjectUpdateFormModelOptionValuePayload\r\n    });\r\n  }\r\n\r\n  const handleClickAddOption = (indexSection: number, indexFormElement: number) => {\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.updateFormProjectUpdateFormModelAddOption, payload: {\r\n        indexSection,\r\n        indexFormElement\r\n      } as IUpdateFormProjectUpdateFormModelAddOptionPayload\r\n    });\r\n  }\r\n\r\n  const handleClickDeleteOption = (indexSection: number, indexFormElement: number, indexOptions: number) => {\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.updateFormProjectUpdateFormModelDeleteOption, payload: {\r\n        indexSection,\r\n        indexFormElement,\r\n        indexOptions\r\n      } as IUpdateFormProjectUpdateFormModelDeleteOptionPayload\r\n    });\r\n  }\r\n\r\n  return (\r\n    <FormAutomator\r\n      {\r\n      ...{\r\n        ...props,\r\n        formModel: formModelToUse as Array<FormFieldsModel<any>>,\r\n        handleChange: handleChange.bind(undefined, indexSection, indexFormElement),\r\n        handleOptionsChange: handleOptionsChange.bind(undefined, indexSection, indexFormElement),\r\n        handleClickAddOption: handleClickAddOption.bind(undefined, indexSection, indexFormElement),\r\n        handleClickDeleteOption: handleClickDeleteOption.bind(undefined, indexSection, indexFormElement)\r\n      }\r\n      }\r\n    />\r\n  )\r\n\r\n}","import { cleanString } from 'app/libs/tools/tools'\r\n\r\nexport function autoGenerateFieldName(labelValue: string | number | boolean | Array<string>): string | null {\r\n  if (!labelValue)\r\n    return null;\r\n  else if (typeof labelValue === 'string')\r\n    return cleanString(labelValue);\r\n  else if (Array.isArray(labelValue))\r\n    return cleanString(labelValue.join('-'));\r\n  else\r\n    return cleanString(labelValue.toString());\r\n}","import { PROJECT_EDITOR_FORM_BUILDER } from 'app/data/project-form-builder/project-editor-form-builder.const'\r\nimport { RESERVED_AUDS_KEYS, Section } from 'app/data/project-structure/project-info'\r\nimport { RESERVED_FIELDS } from 'app/data/project-structure/reserved-fields.constant'\r\nimport { IUpdateFormProjectRemoveFieldFromSectionPayload } from 'app/libs/redux/action.type'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { SectionFormModelManager } from 'app/ui-react-components/projects/add-edit-project-components/section-form-model-manager.component'\r\nimport { DANGER_BTN_OUTLINE, SUCCESS_BTN_OUTLINE } from 'app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const'\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component'\r\nimport { FormFieldsModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types'\r\nimport { useSelector } from 'react-redux'\r\n\r\nexport const SectionManager = ({ section, sectionIndex }: { section: Section, sectionIndex: number }) => {\r\n\r\n  const projectEditorMode = useSelector((store: AnitaStore) => store.formProject.mode);\r\n  const sections = useSelector((store: AnitaStore) => store.formProject.project[RESERVED_AUDS_KEYS._sections]);\r\n  const customFields: Array<string> = section.formModel\r\n    .map(formElement => Object.values(RESERVED_FIELDS).includes(formElement.fieldName) ? null : formElement.fieldName)\r\n    .filter(fieldName => fieldName !== null);\r\n\r\n  const handleChange = (index: number, fieldName: keyof Section, value: Section[keyof Section]) => {\r\n    storeDispatcher({\r\n      type: REDUX_ACTIONS.updateFormProjectUpdateSection, payload: { fieldName, value, index }\r\n    });\r\n  }\r\n\r\n  const handleClickAddField = () => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormProjectAddFieldToSection, payload: sectionIndex });\r\n  }\r\n\r\n  const handleClickDeleteSection = () => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormProjectRemoveSection, payload: sectionIndex });\r\n  }\r\n\r\n  const handleClickDeleteField = (fieldIndex: number) => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormProjectRemoveFieldFromSection, payload: { sectionIndex, fieldIndex } as IUpdateFormProjectRemoveFieldFromSectionPayload });\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-5 p-4 bg-white rounded shadow\">\r\n      <div>\r\n        <h3 className=\"text-md font-bold\">{`Section # ${sectionIndex + 1}`}</h3>\r\n        <hr className=\"mt-4\" />\r\n      </div>\r\n      <div className=\"pt-4\">\r\n        <FormAutomator\r\n          formModel={PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].sectionInfo as Array<FormFieldsModel<any>>}\r\n          element={section}\r\n          handleChange={handleChange.bind(undefined, sectionIndex)}\r\n          sectionId={section.id}\r\n        />\r\n      </div>\r\n      <h4 className=\"pl-2 font-bold mb-2 mt-6\">Section element fields</h4>\r\n      {section.formModel.map((formElement, indexFormElement) =>\r\n        !customFields.includes(formElement.fieldName) ? null : (\r\n          <div key={`${section.id}-${indexFormElement}`} className=\"border border-transparent hover:border-prussian-blue-500 shadow rounded mb-3 p-4\">\r\n            <SectionFormModelManager\r\n              indexFormElement={indexFormElement}\r\n              indexSection={sectionIndex}\r\n              element={formElement}\r\n            />\r\n            {customFields.length < 2 ? null : (\r\n              <div className=\"flex justify-end\">\r\n                <button\r\n                  onClick={handleClickDeleteField.bind(undefined, indexFormElement)}\r\n                  className={`text-sm py-1 px-3 ${DANGER_BTN_OUTLINE}`}>\r\n                  Delete field\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )\r\n      )}\r\n      <div className=\"flex items-end mt-10 mb-1\">\r\n        {(sections.length > 1) && <button onClick={handleClickDeleteSection}\r\n          className={`py-2 px-4 text-sm ${DANGER_BTN_OUTLINE}`}>\r\n          Delete section\r\n        </button>}\r\n        <button onClick={handleClickAddField}\r\n          className={`ml-auto py-2 px-4 text-sm ${SUCCESS_BTN_OUTLINE}`}>\r\n          Add field\r\n        </button>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function'\r\nimport { PROJECT_EDITOR_FORM_BUILDER } from 'app/data/project-form-builder/project-editor-form-builder.const'\r\nimport { ProjectSettings, RESERVED_AUDS_KEYS, SystemData } from 'app/data/project-structure/project-info'\r\nimport { CurrentProjectSetter } from 'app/libs/project-helpers/project-handlers/current-project-setter.class'\r\nimport { ProjectSaver } from 'app/libs/project-helpers/project-handlers/project-saver.class'\r\nimport { ProjectsListLoader } from 'app/libs/projects-helpers/projects-handlers/projects-list-loader.class'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum'\r\nimport { SectionManager } from 'app/ui-react-components/projects/add-edit-project-components/section-manager.component'\r\nimport { SUCCESS_BTN_OUTLINE } from 'app/ui-react-components/shared-components/buttons/buttons-layout-tw-classes.const'\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component'\r\nimport { useSelector } from 'react-redux'\r\nimport { useNavigate, useParams } from 'react-router'\r\n\r\nexport const FormProjectManager = () => {\r\n\r\n  const { projectId } = useParams<URL_PARAMS>();\r\n  const projectEditorMode = useSelector((store: AnitaStore) => store.formProject.mode);\r\n  const project = useSelector((state: AnitaStore) => state.formProject.project);\r\n  const validObj = useSelector((state: AnitaStore) => state.formElesValidState);\r\n  const mode: EDITOR_MODE = projectId ? EDITOR_MODE.edit : EDITOR_MODE.add;\r\n  const navigate = useNavigate();\r\n\r\n  const handleProjectChange = (fieldName: keyof ProjectSettings, value: ProjectSettings[keyof ProjectSettings]) => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormProjectSettings, payload: { fieldName, value } });\r\n  }\r\n\r\n  const handleClickSave = async () => {\r\n    await new ProjectSaver(project as SystemData, mode).save();\r\n    await new ProjectsListLoader().load();\r\n    new CurrentProjectSetter(project[RESERVED_AUDS_KEYS._settings], project[RESERVED_AUDS_KEYS._sections]).set();\r\n    navigate(urlParamFiller(ANITA_URLS.projectDetails, [{ name: URL_PARAMS.projectId, value: project[RESERVED_AUDS_KEYS._settings][0].id }]));\r\n  }\r\n\r\n  const handleClickAddSection = () => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.updateFormProjectAddSection });\r\n  }\r\n\r\n  const projectFormModel = mode === EDITOR_MODE.add ?\r\n    PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].projectInfo.newItem :\r\n    PROJECT_EDITOR_FORM_BUILDER[projectEditorMode].projectInfo.existingItem;\r\n\r\n  return (\r\n    <span>\r\n      <div className=\"mt-5 p-4 bg-white rounded shadow\">\r\n        <FormAutomator formModel={projectFormModel as any} element={project[RESERVED_AUDS_KEYS._settings][0]} handleChange={handleProjectChange} />\r\n      </div>\r\n      <div className=\"px-1 md:px-2 lg:px-3\">\r\n        {project[RESERVED_AUDS_KEYS._sections].map((section, index) => <SectionManager key={section.id} section={section} sectionIndex={index} />)}\r\n      </div>\r\n      <div className=\"mt-5 p-4 bg-white rounded shadow\">\r\n        <div className=\"flex items-end flex-wrap\">\r\n          <button\r\n            className={`w-full sm:w-auto py-2 px-6 sm:mr-3 ${SUCCESS_BTN_OUTLINE}`}\r\n            onClick={handleClickAddSection}\r\n          >Add section</button>\r\n          <button\r\n            className=\"w-5/12 sm:w-auto sm:ml-auto py-2 px-6 bg-gray-200 font-semibold rounded hover:bg-gray-300 mr-3\"\r\n            onClick={() => navigate(-1)}\r\n          >Cancel</button>\r\n          <button\r\n            disabled={Object.keys(validObj).some(key => validObj[key] === false)}\r\n            className=\"w-5/12 ml-auto sm:ml-0 mt-8 sm:mt-0 sm:w-auto py-2 px-6 bg-prussian-blue-400 text-white font-semibold rounded hover:bg-prussian-blue-500 disabled:bg-gray-400 disabled:bg-opacity-40 disabled:cursor-not-allowed\"\r\n            onClick={handleClickSave}\r\n          >Save</button>\r\n        </div>\r\n      </div>\r\n    </span>\r\n  )\r\n}","import { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport './project-editor-mode-toggle.component.css'\r\nexport const ProjectEditorModeToggle = () => {\r\n\r\n  const handleChangeProjectEditorMode = () => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.setProjectEditorMode });\r\n  };\r\n\r\n  return (\r\n    <div className=\"ml-auto\">\r\n      <label htmlFor=\"project-editor-mode-toggle\" className=\"flex items-center cursor-pointer\">\r\n        <div className=\"mr-3 mt-1 text-gray-500 text-xs leading-none text-right\">\r\n          Advanced<br />mode\r\n        </div>\r\n        <div className=\"relative mt-1\">\r\n          <input type=\"checkbox\" id=\"project-editor-mode-toggle\" className=\"sr-only\" onChange={handleChangeProjectEditorMode} />\r\n          <div className=\"block bg-gray-600 w-10 h-6 rounded-full\"></div>\r\n          <div className=\"dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition\"></div>\r\n        </div>\r\n      </label>\r\n\r\n    </div>\r\n  )\r\n}","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const'\r\nimport { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum'\r\nimport {\r\n  ProjectSettings,\r\n  RESERVED_AUDS_KEYS,\r\n  Section,\r\n  SystemData\r\n  } from 'app/data/project-structure/project-info'\r\nimport { IdCreator } from 'app/libs/id-creator/id-creator.class'\r\nimport { isProjectLoaded } from 'app/libs/project-helpers/project-handlers/is-project-loaded.function'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { EDITOR_MODE } from 'app/ui-react-components/editor-mode.enum'\r\nimport { FormProjectManager } from 'app/ui-react-components/projects/add-edit-project-components/form-project-manager.component'\r\nimport { ProjectEditorModeToggle } from 'app/ui-react-components/projects/add-edit-project-components/project-editor-mode-toggle.component'\r\nimport { Loader } from 'app/ui-react-components/shared-components/loader/loader.component'\r\nimport { useEffect, useState } from 'react'\r\nimport { Navigate, useParams } from 'react-router-dom'\r\n\r\nexport const AddEditProject = () => {\r\n\r\n  const params = useParams();\r\n  const mode = params[URL_PARAMS.projectId] ? EDITOR_MODE.edit : EDITOR_MODE.add;\r\n\r\n  const projectId = params[URL_PARAMS.projectId];\r\n\r\n  const [project, setProject] = useState<SystemData | null | undefined>(null);\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n\r\n    // in add mode, sets a new project\r\n    if (mode === EDITOR_MODE.add)\r\n      return setProject({\r\n        [RESERVED_AUDS_KEYS._settings]: [{ id: IdCreator.random(), title: '', description: '', createdAt: '', localStorage: LOCAL_STORAGE_SYSTEMS.IndexedDB }],\r\n        [RESERVED_AUDS_KEYS._sections]: [{ id: IdCreator.random(), title: '', formModel: [{} as any] }],\r\n      });\r\n\r\n\r\n    const fetchEProject = async () => {\r\n      const canProceed = await isProjectLoaded(projectId);\r\n      if (!projectId || !canProceed)\r\n        return setProject(undefined);\r\n\r\n      const _settings = await dbInstances[projectId].callSelector<ProjectSettings>(RESERVED_AUDS_KEYS._settings).multiple();\r\n      const _sections = await dbInstances[projectId].callSelector<Section>(RESERVED_AUDS_KEYS._sections).multiple();\r\n\r\n      if (isMounted)\r\n        setProject({ _settings, _sections });\r\n    };\r\n\r\n    if (isMounted)\r\n      fetchEProject();\r\n\r\n    return () => { isMounted = false; }\r\n  }, [mode, projectId]);\r\n\r\n  if (project === undefined)\r\n    return <Navigate to={ANITA_URLS.projectsList} />\r\n\r\n  const headerText = mode === EDITOR_MODE.add ? 'Add Project' : 'Edit Project';\r\n\r\n  storeDispatcher({ type: REDUX_ACTIONS.setFormProject, payload: project });\r\n\r\n  return (\r\n    <span>\r\n      <div className=\"p-4 bg-white rounded shadow flex\">\r\n        <div>\r\n          <h3 className=\"text-xl font-bold\">{headerText}</h3>\r\n        </div>\r\n        {project !== null && <ProjectEditorModeToggle />}\r\n      </div>\r\n      {project === null && <Loader />}\r\n      {project !== null && <FormProjectManager />}\r\n    </span>\r\n  )\r\n\r\n};\r\n","import { DbInitializer } from 'app/data/local-dbs/db-initializer.class'\r\nimport { dbInstances } from 'app/data/local-dbs/db-instances.const'\r\nimport { LOCAL_STORAGE_SYSTEMS } from 'app/data/local-dbs/local-storage-systems.enum'\r\nimport { AnitaUniversalDataStorage, ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info'\r\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api'\r\nimport { SaveProjectSettingsInIndexedDB } from 'app/libs/project-helpers/project-handlers/save-project-settings-in-indexeddb.class'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\n\r\n/**\r\n * Imports one project file, and then calls `SaveProjectSettingsInIndexedDB`.\r\n * Also sets the last imported project as the current one by calling `CurrentProjectSetter`.\r\n *\r\n * @see SaveProjectSettingsInIndexedDB\r\n * @see CurrentProjectSetter\r\n */\r\nexport class ProjectDataImporter {\r\n\r\n  /**\r\n   * \r\n   * @param projectData The project data of the project to import\r\n   * @param fileHandle FileSystemFileHandle of the project to import\r\n   */\r\n  constructor(\r\n    private projectData: AnitaUniversalDataStorage,\r\n    private fileHandle: FileSystemFileHandle\r\n\r\n  ) { }\r\n\r\n  /**\r\n   * Asks for the files to import and processes them, then sets the current project as the last one imported \r\n   */\r\n  public async import(): Promise<void> {\r\n    await this.initializeDb();\r\n    await this.setLocalProjectSettings();\r\n    this.dispatchProject(this.projectData[RESERVED_AUDS_KEYS._settings][0]);\r\n\r\n    // Relaxed equality check, because in the form the localStorage data is stored as a string\r\n    // eslint-disable-next-line eqeqeq\r\n    if (this.projectData[RESERVED_AUDS_KEYS._settings][0].localStorage == LOCAL_STORAGE_SYSTEMS.IndexedDB)\r\n      await this.saveDataToDb();\r\n  }\r\n\r\n  private async setLocalProjectSettings() {\r\n    const payload = await dbInstances[this.projectData[RESERVED_AUDS_KEYS._settings][0].id].dbStore.postProjectCreation?.(this.projectData) || {};\r\n    await new SaveProjectSettingsInIndexedDB(this.projectData[RESERVED_AUDS_KEYS._settings][0], payload).save();\r\n  }\r\n\r\n  /**\r\n   * Initialize the DbConnector instance\r\n   */\r\n  private async initializeDb(): Promise<void> {\r\n    await new DbInitializer(this.projectData[RESERVED_AUDS_KEYS._settings][0], this.projectData[RESERVED_AUDS_KEYS._sections], this.fileHandle).init();\r\n  }\r\n\r\n  private async saveDataToDb(): Promise<any> {\r\n    for (const section in this.projectData)\r\n      await dbInstances[this.projectData[RESERVED_AUDS_KEYS._settings][0].id].callInsertor(section, this.projectData[section]).autoInsert();\r\n  }\r\n\r\n  /**\r\n   * Dispatches the action to add the project to the list of projects\r\n   */\r\n  private dispatchProject(payload: ProjectSettings): void {\r\n    storeDispatcher({ type: REDUX_ACTIONS.addProjectToList, payload });\r\n  }\r\n\r\n}\r\n","import { AnitaUniversalDataStorage } from 'app/data/project-structure/project-info';\r\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { getFileHandle, readFileHandleAsText } from 'app/libs/db-connector/plugins/file-handles/helpers/fs-helper';\r\nimport fileDialog from 'file-dialog';\r\n\r\n/**\r\n * Imports one or more existing project files, and then calls `SaveProjectSettingsInIndexedDB`.\r\n * Also sets the last imported project as the current one by calling `CurrentProjectSetter`.\r\n *\r\n * @see SaveProjectSettingsInIndexedDB\r\n * @see CurrentProjectSetter\r\n */\r\nexport class ProjectFileImporter {\r\n\r\n  /**\r\n   * List of FileSystemFileHandle for each project to import\r\n   */\r\n  private fileHandle: FileSystemFileHandle;\r\n  /**\r\n   * The file contents of each project to import\r\n   */\r\n  private fileContents: string;\r\n  /**\r\n   * The project data of each project to import\r\n   */\r\n  private projectData: AnitaUniversalDataStorage;\r\n\r\n  /**\r\n   * Asks for the files to import and processes them, then sets the current project as the last one imported \r\n   */\r\n  public async import(): Promise<{ project: AnitaUniversalDataStorage, fileHandle: FileSystemFileHandle } | void> {\r\n    if (typeof window['showOpenFilePicker'] === 'function')\r\n      await this.askForFileHandle();\r\n    else\r\n      await this.importFromFile();\r\n\r\n    if (!this.fileContents)\r\n      return;\r\n\r\n    this.parseFileContents();\r\n    return { project: this.projectData, fileHandle: this.fileHandle };\r\n  }\r\n\r\n  /**\r\n   * Asks for user permission to open a file with File System Access API\r\n   */\r\n  private async askForFileHandle(): Promise<void> {\r\n    const fileHandles = await getFileHandle();\r\n    this.fileHandle = fileHandles[0];\r\n    this.fileContents = await readFileHandleAsText(this.fileHandle);\r\n  }\r\n\r\n  /**\r\n   * Asks  for a file with file-dialog\r\n   */\r\n  public async importFromFile(): Promise<void> {\r\n    const files = await fileDialog({ multiple: false, accept: 'text/json' });\r\n    this.fileContents = await files[0].text();\r\n  }\r\n\r\n  /**\r\n   * Converts the string of the project to the type `AnitaUniversalDataStorage`\r\n   */\r\n  private parseFileContents(): void {\r\n    this.projectData = JSON.parse(this.fileContents);\r\n  }\r\n\r\n}\r\n","import { ANITA_URLS } from 'app/anita-routes/anita-routes.constant';\r\nimport { projectInfoNewItem } from 'app/data/project-form-builder/project-info-builder.constant';\r\nimport { AnitaUniversalDataStorage, ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { FileSystemFileHandle } from 'app/libs/db-connector/plugins/file-handles/helpers/file-system-access-api';\r\nimport { CurrentProjectSetter } from 'app/libs/project-helpers/project-handlers/current-project-setter.class';\r\nimport { ProjectDataImporter } from 'app/libs/projects-helpers/project-importers/project-data-importer.class';\r\nimport { ProjectFileImporter } from 'app/libs/projects-helpers/project-importers/project-file-importer.class';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { FormAutomator } from 'app/ui-react-components/shared-components/forms-automator/form-automator.component';\r\nimport { FormAutomatorOnChangeValue, FormFieldsModel } from 'app/ui-react-components/shared-components/forms-automator/form-automator.types';\r\nimport { Modal } from 'app/ui-react-components/shared-components/modals/modal.component';\r\nimport { useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ReactTooltip from 'react-tooltip';\r\n\r\nexport const ImportProjectButton = ({ btnType = 'icon' }: { btnType?: 'icon' | 'text' }) => {\r\n\r\n  const navigate = useNavigate();\r\n  const validObj = useSelector((state: AnitaStore) => state.formElesValidState);\r\n\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n  const [animationClass, setAnimationClass] = useState('animate__fadeIn');\r\n  const [projectData, setProjectData] = useState<AnitaUniversalDataStorage>(null);\r\n  const [projectFileHandle, setProjectFileHandle] = useState<FileSystemFileHandle>();\r\n  const [projectSettings, setProjectSettings] = useState<ProjectSettings>(null);\r\n\r\n  const handleClickModal = async () => {\r\n    if (isModalOpen) {\r\n      setAnimationClass('animate__fadeOut')\r\n      setTimeout(() => setIsModalOpen(false), 500);\r\n    } else {\r\n      const { project, fileHandle } = await new ProjectFileImporter().import() || {};\r\n\r\n      if (!project)\r\n        return;\r\n\r\n      setAnimationClass('animate__fadeIn')\r\n      setIsModalOpen(true)\r\n      setProjectData(project);\r\n      setProjectSettings(project[RESERVED_AUDS_KEYS._settings][0])\r\n      setProjectFileHandle(fileHandle);\r\n    }\r\n  }\r\n\r\n  const handleClickImport = async () => {\r\n    projectData[RESERVED_AUDS_KEYS._settings][0] = projectSettings;\r\n    await new ProjectDataImporter(projectData, projectFileHandle).import();\r\n    handleClickModal();\r\n    new CurrentProjectSetter(projectData[RESERVED_AUDS_KEYS._settings], projectData[RESERVED_AUDS_KEYS._sections]).set();\r\n    setTimeout(() => navigate(ANITA_URLS.projectsList), 500);\r\n  }\r\n\r\n  const handleProjectChange = (fieldName: string | number, value: FormAutomatorOnChangeValue) => {\r\n    setProjectSettings({ ...projectSettings, [fieldName]: value });\r\n  }\r\n\r\n  return (\r\n    <span>\r\n      {btnType === 'icon' ? (<span><button data-tip data-for=\"importProject\"\r\n        onClick={handleClickModal}\r\n        className=\"mx-2 my-2 text-white bg-prussian-blue-600 border-0 py-1 px-6 focus:outline-none hover:bg-prussian-blue-700 rounded font-bold text-sm\"\r\n      ><i className=\"bi bi-arrow-bar-down\"></i>\r\n      </button>\r\n        <ReactTooltip id=\"importProject\" effect=\"solid\">\r\n          <span>Import an existing project</span>\r\n        </ReactTooltip></span>\r\n      ) : (\r\n        <button data-tip data-for=\"importProject\"\r\n          onClick={handleClickModal}\r\n          className=\"w-full mt-4 text-white bg-prussian-blue-400 border-0 py-3 px-8 focus:outline-none hover:bg-prussian-blue-500 rounded font-bold text-sm\"\r\n        >\r\n          Import an existing project\r\n        </button>\r\n      )}\r\n      {isModalOpen && <Modal\r\n        title=\"Import project\"\r\n        actionText=\"Import\"\r\n        type=\"confirm\"\r\n        handleClickAction={handleClickImport}\r\n        closeFn={handleClickModal}\r\n        animationClass={animationClass}\r\n        disableAction={Object.keys(validObj).some(key => validObj[key] === false)}\r\n      >\r\n        {projectSettings && <FormAutomator element={projectSettings} formModel={projectInfoNewItem as Array<FormFieldsModel<any>>} handleChange={handleProjectChange} />}\r\n      </Modal>\r\n      }\r\n    </span>\r\n  )\r\n}\r\n","import { ANITA_URLS } from 'app/anita-routes/anita-routes.constant';\r\nimport { ImportProjectButton } from 'app/ui-react-components/projects/project-importer-components/import-project-button.component';\r\nimport { Link } from 'react-router-dom';\r\n/* eslint-disable jsx-a11y/anchor-is-valid */\r\n\r\nexport const ProjectsNone = () => {\r\n\r\n  // className = \"\"\r\n\r\n  return (\r\n    <div className=\"container px-0 md:px2 lg:px-5 pt-20 md:pt-24 mx-auto\">\r\n      <div className=\"p-4 lg:w-2/3 mx-auto\">\r\n        <div className=\"h-full bg-white shadow px-8 pt-16 pb-16 rounded-lg overflow-hidden text-center relative\">\r\n          <h2 className=\"tracking-widest text-xs title-font font-medium text-gray-400 mb-1\">No projects found</h2>\r\n          <h1 className=\"title-font sm:text-2xl text-xl font-medium text-gray-900 mb-3\">You don't have any Projects on this device yet</h1>\r\n          <p className=\"leading-relaxed mb-3\">You can create a new project or import one from an existing project file.</p>\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 lg:gap-2 mt-7\">\r\n            <ImportProjectButton btnType=\"text\" />\r\n            <Link\r\n              to={ANITA_URLS.projectAdd}\r\n              className=\"w-full flex flex-wrap content-center justify-center mt-4 bg-gray-200 border-0 py-3 px-8 focus:outline-none hover:bg-gray-400 rounded font-bold text-sm\"\r\n            >Create a new project\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n};\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { ProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { EditButton } from 'app/ui-react-components/shared-components/buttons/edit-project-button.component';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport const ProjectLoadedFooter = ({ project }: { project: ProjectSettings }) => (\r\n  <div className=\"ml-auto\">\r\n    <EditButton project={project} />\r\n    <Link to={urlParamFiller(ANITA_URLS.projectDetails, [{ name: URL_PARAMS.projectId, value: project.id }])} className=\"px-4 py-3 text-white inline-flex items-center leading-none text-sm bg-prussian-blue-400 hover:bg-prussian-blue-500 rounded\">\r\n      <i className=\"bi-info-circle mr-2\"></i>Project details\r\n    </Link>\r\n  </div>\r\n\r\n)","import { ProjectSettings } from 'app/data/project-structure/project-info';\r\nimport { ProjectLoader } from 'app/libs/project-helpers/project-handlers/project-loader.class';\r\n\r\nexport const ProjectNotLoadedFooter = ({ project }: { project: ProjectSettings }) => (\r\n  <button onClick={() => new ProjectLoader(project.id).loadProject()} className=\"px-4 py-2 text-white ml-auto inline-flex items-center md:mb-2 lg:mb-0 rounded bg-green-500 hover:bg-green-600 text-sm\">\r\n    Load project\r\n  </button>\r\n)\r\n","import { dbInstances } from 'app/data/local-dbs/db-instances.const';\r\nimport { ProjectSettings, RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { ProjectLoadedFooter } from 'app/ui-react-components/projects/project-card-components/project-loaded-footer.component';\r\nimport { ProjectNotLoadedFooter } from 'app/ui-react-components/projects/project-card-components/project-not-loaded-footer.component';\r\nimport { DeleteProjectButton } from 'app/ui-react-components/shared-components/buttons/delete-project.component';\r\nimport { CardFooterItemsEnd } from 'app/ui-react-components/shared-components/common-ui-eles/card-footer-items-end.component';\r\nimport * as dateFormat from 'date-format';\r\nimport { useSelector } from 'react-redux';\r\n\r\nexport const ProjectCard = ({ project }: { project: ProjectSettings }) => {\r\n\r\n  const projectState = useSelector((state: AnitaStore) => state.project);\r\n\r\n  return (\r\n    <div className=\" mt-4 h-full border-2 border-gray-200 border-opacity-60 rounded-lg bg-white\">\r\n      <div className=\"p-6\">\r\n        <h1 className=\"title-font text-lg font-medium text-gray-900 mb-3\">{project.title}</h1>\r\n        <p className=\"text-lg mb-3\">{project.description}</p>\r\n\r\n        <p className=\"text-gray-600 text-xs\">Created on:</p>\r\n        <p className=\"text-md\">{dateFormat('yyyy/MM/dd, at hh:mm', new Date(project.createdAt))}</p>\r\n\r\n        <CardFooterItemsEnd>\r\n          <DeleteProjectButton project={project} />\r\n          {(\r\n            projectState === null ||\r\n            projectState[RESERVED_AUDS_KEYS._settings][0].id !== project.id ||\r\n            dbInstances[project.id] === undefined\r\n          ) ? <ProjectNotLoadedFooter project={project} /> : <ProjectLoadedFooter project={project} />}\r\n        </CardFooterItemsEnd>\r\n\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}","import { ANITA_URLS } from 'app/anita-routes/anita-routes.constant';\r\nimport { ProjectsListLoader } from 'app/libs/projects-helpers/projects-handlers/projects-list-loader.class';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { ProjectCard } from 'app/ui-react-components/projects/project-card.component';\r\nimport { ImportProjectButton } from 'app/ui-react-components/projects/project-importer-components/import-project-button.component';\r\nimport { useEffect, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport { Navigate } from 'react-router';\r\nimport { Link } from 'react-router-dom';\r\nimport ReactTooltip from 'react-tooltip';\r\n\r\nexport const ProjectsList = () => {\r\n\r\n  const [hasLoaded, setHasLoaded] = useState(false);\r\n  const projects = useSelector((state: AnitaStore) => state.projects);\r\n  const projectsLenght = projects?.length || 0;\r\n\r\n  useEffect(() => {\r\n    let isMounted = true;\r\n    const loadProjectsList = async () => {\r\n      await new ProjectsListLoader().load();\r\n      setHasLoaded(true);\r\n    }\r\n    if (isMounted)\r\n      loadProjectsList();\r\n\r\n    return () => { isMounted = false; }\r\n\r\n  }, [projectsLenght]);\r\n\r\n  if (Array.isArray(projects) && projects.length === 0)\r\n    return <Navigate to={ANITA_URLS.projectsNone} />\r\n\r\n\r\n  if (!hasLoaded)\r\n    return <span></span>;\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"md:w-full bg-white border-b-2 rounded border-white\">\r\n        <div className=\"flex h-full border-t-2 border-prussian-blue-400 border-opacity-60 rounded justify-between\">\r\n          <div className=\"px-6 py-3\">\r\n            <h1 className=\"title-font text-md font-medium text-gray-900\">Projects on this device</h1>\r\n          </div>\r\n          <div className=\"my-2\">\r\n            <ImportProjectButton />\r\n            <Link data-tip data-for='createProject'\r\n              to={ANITA_URLS.projectAdd}\r\n              className=\"mx-2 my-2 text-white bg-prussian-blue-400 border-0 py-1 px-6 focus:outline-none hover:bg-gray-400 rounded font-bold text-sm\"\r\n            ><i className=\"bi bi-plus\"></i>\r\n            </Link>\r\n            <ReactTooltip id=\"createProject\" effect=\"solid\">\r\n              <span>Create a new project</span>\r\n            </ReactTooltip>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"p-1 md:w-full\">\r\n        {projects.map((project, index) => (<ProjectCard key={project.id} project={project} />))}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n};\r\n","import { ANITA_URLS } from 'app/anita-routes/anita-routes.constant';\r\nimport { AddEditSectionElement } from 'app/ui-react-components/project/add-edit-section-element.component';\r\nimport { ProjectDetails } from 'app/ui-react-components/project/project-details.component';\r\nimport { SectionElementDetails } from 'app/ui-react-components/project/section-element-details.component';\r\nimport { SectionElementsList } from 'app/ui-react-components/project/section-elements-list.component';\r\nimport { AddEditProject } from 'app/ui-react-components/projects/add-edit-project.component';\r\nimport { ProjectsNone } from 'app/ui-react-components/projects/no-projects.component';\r\nimport { ProjectsList } from 'app/ui-react-components/projects/projects-list.component';\r\nimport { Navigate, Route, Routes } from 'react-router-dom';\r\n\r\nexport const AnitaRoutes = () => (\r\n  <Routes>\r\n    <Route path={ANITA_URLS.projectsList} element={<ProjectsList />} />\r\n    <Route path={ANITA_URLS.projectAdd} element={<AddEditProject />} />\r\n    <Route path={ANITA_URLS.projectEdit} element={<AddEditProject />} />\r\n    <Route path={ANITA_URLS.projectsNone} element={<ProjectsNone />} />\r\n    <Route path={ANITA_URLS.projectDetails} element={<ProjectDetails />} />\r\n\r\n    <Route path={ANITA_URLS.projectSectionElesList} element={<SectionElementsList />} />\r\n    <Route path={ANITA_URLS.projectSectionEleDetails} element={<SectionElementDetails />} />\r\n    <Route path={ANITA_URLS.projectSectionAddEle} element={<AddEditSectionElement />} />\r\n    <Route path={ANITA_URLS.projectSectionEditEle} element={<AddEditSectionElement />} />\r\n    <Route path=\"*\" element={<Navigate to={ANITA_URLS.projectsList} />}\r\n    />\r\n  </Routes>\r\n)","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant'\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function'\r\nimport { RESERVED_AUDS_KEYS, SystemData } from 'app/data/project-structure/project-info'\r\nimport { ProjectLoader } from 'app/libs/project-helpers/project-handlers/project-loader.class'\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { useClickOutside } from 'app/ui-react-components/hooks/click-outside.hook'\r\nimport React, { useRef, useState } from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { useNavigate } from 'react-router-dom'\r\n\r\nexport const ProjectPicker = ({ project }: { project: SystemData }) => {\r\n\r\n  const projects = useSelector((store: AnitaStore) => store.projects);\r\n  const navigate = useNavigate();\r\n  const [dropdownOpen, setDropdownOpen] = useState(false);\r\n  const dropDownRef = useRef<HTMLDivElement>(null);\r\n\r\n  useClickOutside(dropDownRef, () => setDropdownOpen(false));\r\n\r\n  const handleClick = (fn) => {\r\n    setDropdownOpen(!dropdownOpen);\r\n  }\r\n\r\n  const loadProject = async (projectId: string) => {\r\n    await new ProjectLoader(projectId).loadProject()\r\n    goToDetails(projectId);\r\n  }\r\n\r\n  const goToDetails = (projectId: string) => {\r\n    navigate(urlParamFiller(ANITA_URLS.projectDetails, [{ name: URL_PARAMS.projectId, value: projectId }]));\r\n  }\r\n\r\n  const goToEditProject = (projectId: string) => {\r\n    navigate(urlParamFiller(ANITA_URLS.projectEdit, [{ name: URL_PARAMS.projectId, value: projectId }]));\r\n  }\r\n\r\n  return (\r\n    <div ref={dropDownRef}>\r\n      <p className=\"text-xs text-gray-600 pl-2\">Current project:</p>\r\n\r\n      <div x-data=\"{ dropdownOpen: true }\" className=\"relative\">\r\n        <button onClick={() => setDropdownOpen(!dropdownOpen)} className=\"relative w-full flex justify-between text-left z-10 rounded py-2 px-3 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:bg-gray-300\">\r\n          <span>{project?.[RESERVED_AUDS_KEYS._settings][0]?.title}</span>\r\n          <i className=\"bi-chevron-expand my-auto\"></i>\r\n        </button>\r\n\r\n\r\n        {dropdownOpen && (\r\n          <div className=\"absolute left-0 mt-2 w-64 bg-white rounded-md overflow-hidden shadow-xl z-20 border border-bg-500\">\r\n            {projects?.length > 1 && (<div className=\"block py-2.5 px-4 text-sm bg-gray-100 text-gray-600\">Projects on this device</div>)}\r\n            {projects?.map(projectFromList => {\r\n              if (project[RESERVED_AUDS_KEYS._settings][0].id === projectFromList.id) return null;\r\n              return (\r\n                <button key={projectFromList.id} className=\"w-full block text-left px-4 py-2 text-sm text-gray-800 border-b hover:bg-gray-200\" onClick={() => handleClick(loadProject(projectFromList.id))}>{projectFromList.title}</button>)\r\n            })}\r\n            <div className=\"block py-2.5 px-4 text-sm bg-gray-100 text-gray-600\">Actions</div>\r\n            <button className=\"w-full block text-left px-4 py-2 text-sm text-gray-800 border-b hover:bg-gray-200\" onClick={() => handleClick(goToDetails(project[RESERVED_AUDS_KEYS._settings][0].id))}>\r\n              <i className=\"bi-info-circle mr-2\"></i>\r\n              Go to the details of the project\r\n            </button>\r\n            <button className=\"w-full block text-left px-4 py-2 text-sm text-gray-800 border-b hover:bg-gray-200\" onClick={() => handleClick(goToEditProject(project[RESERVED_AUDS_KEYS._settings][0].id))}>\r\n              <i className=\"bi-pencil mr-2\"></i>\r\n              Edit the current project\r\n            </button>\r\n            <button className=\"w-full block text-left px-4 py-2 text-sm text-gray-800 border-b hover:bg-gray-200\" onClick={() => handleClick(navigate(ANITA_URLS.projectsList))}>\r\n              <i className=\"bi-files mr-2\"></i>\r\n              Go to the projects list\r\n            </button>\r\n            <button className=\"w-full block text-left px-4 py-2 text-sm text-gray-800 border-b hover:bg-gray-200\" onClick={() => handleClick(navigate(ANITA_URLS.projectAdd))}>\r\n              <i className=\"bi-plus mr-2\"></i>\r\n              Create a new project\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div >\r\n    </div >\r\n  );\r\n\r\n}\r\n","import { useEffect } from 'react'\r\n\r\nexport const useClickOutside = (parentElement: React.RefObject<HTMLElement>, callback: () => void) => {\r\n  useEffect(() => {\r\n    // check if the click is inside a div with classs dueDateFieldDropup\r\n    const onClickOutside = (e: MouseEvent) => {\r\n      if (parentElement?.current && !parentElement.current!.contains(e.target as Node)) {\r\n        callback()\r\n      }\r\n    }\r\n\r\n    document.addEventListener('click', onClickOutside)\r\n\r\n    return () => {\r\n      document.removeEventListener('click', onClickOutside)\r\n    }\r\n  }, [parentElement, callback])\r\n}\r\n","import { ANITA_URLS, URL_PARAMS } from 'app/anita-routes/anita-routes.constant';\r\nimport { urlParamFiller } from 'app/anita-routes/url-param-fillers.function';\r\nimport { RESERVED_AUDS_KEYS } from 'app/data/project-structure/project-info';\r\nimport { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { ProjectPicker } from 'app/ui-react-components/admin-layout/components/project-picker.component';\r\nimport { useSelector } from 'react-redux';\r\nimport { Link, useLocation } from 'react-router-dom';\r\n\r\nconst baseStyleOfSidebarLinks: string = \"block py-2.5 px-4 transition duration-200 border-l-2 hover:border-prussian-blue-700 hover:text-prussian-blue-500 text-sm font-semibold\";\r\n\r\nconst addActiveClassNameToBaseStyle = (currentPath: string, linkPath: string): string => {\r\n  if (currentPath === linkPath) {\r\n    return `${baseStyleOfSidebarLinks} border-prussian-blue-700`;\r\n  } else {\r\n    return `${baseStyleOfSidebarLinks} border-transparent`;\r\n  }\r\n}\r\n\r\nexport const nonProjectRoutes: Array<{ to: string; txt: string, icon: string }> = [\r\n  { to: ANITA_URLS.projectsList, txt: 'Projects', icon: 'bi-files' }\r\n];\r\n\r\nconst ProjectMenu = () => {\r\n\r\n  const project = useSelector((state: AnitaStore) => state.project);\r\n  const location = useLocation();\r\n\r\n\r\n  if (project === null)\r\n    return <span></span>\r\n\r\n  return (\r\n    <div className=\"mt-3\">\r\n\r\n      <div className=\"block py-2.5 px-1\">\r\n        <ProjectPicker project={project} />\r\n      </div>\r\n      <div className=\"block py-2.5 px-4\">\r\n        <p className=\"text-xs text-gray-600\">Project sections:</p>\r\n      </div>\r\n      {project?.[RESERVED_AUDS_KEYS._sections]?.map(section => {\r\n        const linkPath = urlParamFiller(ANITA_URLS.projectSectionElesList, [{ name: URL_PARAMS.projectId, value: project[RESERVED_AUDS_KEYS._settings][0].id }, { name: URL_PARAMS.sectionId, value: section.id }]);\r\n        return (<Link\r\n          key={section.id}\r\n          to={linkPath}\r\n          className={addActiveClassNameToBaseStyle(location.pathname, linkPath)}\r\n        ><i className=\"bi-chevron-compact-right\"></i><span className=\"ml-2\">{section.title}</span>\r\n        </Link>)\r\n      }\r\n      )}\r\n\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport const SidebarMenu = () => {\r\n  const location = useLocation();\r\n\r\n  return (\r\n    <div>{\r\n      nonProjectRoutes.map(route => (<Link\r\n        key={route.to}\r\n        to={route.to}\r\n        className={addActiveClassNameToBaseStyle(location.pathname, route.to)}\r\n      ><i className={route.icon}></i><span className=\"ml-2\">{route.txt}</span>\r\n      </Link>)\r\n      )\r\n    }\r\n      < ProjectMenu />\r\n    </div>\r\n  );\r\n}","import { ReactNode } from 'react'\r\n\r\nexport const Content = (props: { children: ReactNode }) => (\r\n  <div className=\"flex-1 p-2 md:p-3 md:pt-5 lg:pt-5 lg:p-10 pt-5 overflow-auto main-scrollbar\">\r\n    {props.children}\r\n  </div>\r\n);","import { AnitaStore } from 'app/libs/redux/reducers.const'\r\nimport { REDUX_ACTIONS } from 'app/libs/redux/redux-actions.const'\r\nimport { storeDispatcher } from 'app/libs/redux/store-dispatcher.function'\r\nimport { useSelector } from 'react-redux'\r\nimport { Link } from 'react-router-dom'\r\n\r\nexport const Header = () => {\r\n\r\n  const sidebarHideClass = useSelector((store: AnitaStore) => store.layout.sidebar)\r\n\r\n  const handleClickSidebar = () => {\r\n    storeDispatcher({ type: REDUX_ACTIONS.toggleSidebar });\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white text-gray-700 flex h-14 shadow-md justify-between\">\r\n      <button className=\"mobile-menu-button p-4 focus:outline-none  md:hidden\" onClick={handleClickSidebar}>\r\n        <svg className=\"h-5 w-5\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M4 6h16M4 12h16M4 18h16\" />\r\n        </svg>\r\n      </button>\r\n\r\n      <div className=\"relative flex items-center lg:w-auto lg:static md:pl-5 -ml-7 md:ml-0\">\r\n        <Link to=\"/\" className=\"text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase\">\r\n          <img src={`${process.env.PUBLIC_URL}/assets/logo/logo_square.svg`} style={{ height: '30px', width: 'auto' }} alt=\"Anita\" />\r\n        </Link>\r\n        <Link to=\"/\" className=\"hidden md:inline-block mr-4 py-2 whitespace-no-wrap text-prussian-blue-400\">\r\n          <span className=\"text-md font-bold leading-relaxed uppercase\">Anita</span><sup style={{ fontVariant: 'small-caps' }}>Beta</sup>\r\n        </Link>\r\n      </div>\r\n\r\n      <div className=\"visible md:hidden\">&#160;</div>\r\n\r\n      {sidebarHideClass === '' && (<div onClick={handleClickSidebar} className=\"absolute inset-0 h-full w-full z-10 md:hidden\"></div>)}\r\n\r\n    </div>\r\n  )\r\n}","import { AnitaStore } from 'app/libs/redux/reducers.const';\r\nimport { appVersion } from 'app/version';\r\nimport { ReactNode } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport ReactTooltip from 'react-tooltip';\r\n\r\nexport const Sidebar = (props: { children: ReactNode }) => {\r\n\r\n  const toggledClass = useSelector((store: AnitaStore) => store.layout.sidebar)\r\n\r\n  return (\r\n    <div className=\"py-5 z-10\">\r\n      <div className={`${toggledClass} sidebar h-full bg-white shadow rounded-sm text-prussian-blue-500 w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform md:relative md:translate-x-0 transition duration-200 ease-in-out`}>\r\n        <nav>\r\n          {props.children}\r\n        </nav>\r\n        <div className=\"absolute bottom-1 text-xs text-gray-400\">\r\n          <p className=\"inline-block mr-1\">v{appVersion}</p>|\r\n          <a className=\"ml-1\" href=\"https://github.com/anita-app/anita/issues\" target=\"_blank\" rel=\"noreferrer\">\r\n            <i className=\"bi-bug\" data-tip data-for=\"reportBug\"></i>\r\n            <ReactTooltip id=\"reportBug\" effect=\"solid\">\r\n              <span>Report a bug</span>\r\n            </ReactTooltip>\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}","/**\n * Auto generated file, do not edit.\n */\n\nexport const appVersion = '0.12.0';\n","import { AnitaRoutes } from 'app/anita-routes/anita-routes.component';\r\nimport { SidebarMenu } from 'app/ui-react-components/admin-layout/components/sidebar-menu.component';\r\nimport { Content } from 'app/ui-react-components/admin-layout/content.component';\r\nimport { Header } from 'app/ui-react-components/admin-layout/header.component';\r\nimport { Sidebar } from 'app/ui-react-components/admin-layout/sidebar.component';\r\nimport { HashRouter as Router } from 'react-router-dom';\r\n\r\nexport const AdminLayout = () => (\r\n  <Router>\r\n    <Header />\r\n    <div className=\"relative admin-container flex\">\r\n      <Sidebar>\r\n        <SidebarMenu />\r\n      </Sidebar>\r\n      <Content>\r\n        <AnitaRoutes />\r\n      </Content>\r\n    </div>\r\n  </Router>\r\n);\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://cra.link/PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://cra.link/PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://cra.link/PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log('No internet connection found. App is running in offline mode.');\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import 'animate.css';\r\nimport { store } from 'app/libs/redux/state.store';\r\nimport { Startupper } from 'app/libs/startupper/startupper.class';\r\nimport { AdminLayout } from 'app/ui-react-components/admin-layout/admin-layout.component';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\nimport './index.css';\r\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\r\n\r\n\r\nnew Startupper().init();\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <AdminLayout />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nserviceWorkerRegistration.register();"],"sourceRoot":""}