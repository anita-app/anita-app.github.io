<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="application-name" content="Anita"> <meta name="msapplication-TileColor" content="#002346"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/favicon/site.webmanifest"> <link rel="mask-icon" href="/assets/icons/favicon/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/icons/favicon/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/icons/favicon/browserconfig.xml"> <meta name="theme-color" content="#002346"> <link rel="stylesheet" href="/assets/css/styles-0-14-14.min.css"> <title>How to make TypeScript infer types in switch statements without casting (in a Redux reducer or anywhere else)</title> <meta name="description" content="Make TypeScript infer types in switch statements, expecially in those in a Redux reducer, without casting"> </head> <body class="text-gray-800 antialiased flex flex-col h-screen justify-between"> <nav class="top-0 absolute z-50 w-full flex flex-wrap items-center justify-between py-3 navbar-expand-lg bg-gradient-to-r from-prussian-blue-400 to-prussian-blue-700"> <div class="container px-4 mx-auto flex flex-wrap items-center justify-between z-50"> <div class="w-full relative flex justify-between lg:w-auto lg:static lg:block lg:justify-start"> <div class="flex-grow relative flex items-center lg:w-auto lg:static"> <a class="text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"> <img src="/assets/logo/logo_square.svg" style="height:35px;width:auto" alt="Anita"> </a> <a class="text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"> Anita </a> </div> <button class="cursor-pointer text-xl leading-none px-3 py-1 border border-solid border-transparent rounded bg-transparent block lg:hidden outline-none focus:outline-none" type="button" onclick='toggleNavbar("main-collapse-navbar")'> <ion-icon name="menu-outline" class="text-white" style="width:1.5em;height:1.5em"></ion-icon> </button> </div> <div class="lg:flex flex-grow items-center bg-white lg:bg-transparent lg:shadow-none hidden" id="main-collapse-navbar"> <ul class="flex flex-col lg:flex-row list-none lg:ml-auto"> <li class="flex items-center"> <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold" href="/blog"> Blog </a> </li> <li class="flex items-center"> <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold" href="https://github.com/anita-app/anita"> <span class="inline-block mr-2">Source Code</span> <ion-icon name="logo-github" class="lg:text-gray-300 text-gray-500" style="width:1.5em;height:1.5em"></ion-icon> </a> </li> </ul> </div> </div> </nav> <section class="relative"> <div class="mx-auto pb-20 mt-36 mb-36"> <div class="w-full lg:w-7/12 ml-auto mr-auto p-10 border-1 rounded-md shadow-md"> <article> <div class="pt-2 pb-1 text-justify pr-5 border-b rounded-t"> <h1 class="m-0 font-light">How to make TypeScript infer types in switch statements without casting (in a Redux reducer or anywhere else)</h1> </div> <p class="text-sm text-gray-500 mb-8 mt-1">Published on 2022/2/1 by ilDon </p> <p>As a developer with very poor memory, I really like coding in typed languages. They allow me to forget my data types, and be sure to pass the right props around my code. If you are unfamiliar with typed languages, I suggest you read <a href="https://www.google.it/books/edition/Advanced_Topics_in_Types_and_Programming/A5ic1MPTvVsC?hl=it&gbpv=0">this</a> book for a general overview, or <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html">this</a> article for a more specific hands-on guide for TypeScript.</p> <p>One annoying thing about developing in TypeScript is that it is not obvious how to infer types in switch statements. This is because the compiler doesn't know what type we are passing to the switch statement.</p> <p>I will explain my solution to this problem by example, posting here the relevant part of the code needed to achieve the desired result. I have also set up a live (working) example of the code in <a href="https://stackblitz.com/edit/switch-with-types?file=switch.ts">this <em>StackBiz</em> project</a>. Because I first developed this while working on a Redux reducer, I will provide an example that imitates what I would do in a Redux reducer. Since it is a simple use-case, it can easily be applied to any other scenario in which you need to infer types in switch statements.</p> <p>I will focus on the <em>how-to part</em>, not the <em>why-it-works</em> part. I came across this solution after I had already written a switch statement in TypeScript. I was not trying to make TypeScript infer types, I was only being as precise as possible in my typing. Turns out, the compiler picked up more than I expected. </p> <p>In short:</p> <p><img src="/assets/images/blog/switch-with-types/2020-02-01_meme-code-working.jpg" alt="Code Working meme"></p> <h2 id="definingthedatatypes">Defining the data types</h2> <p>This is by far the most important part of this solution. I will explain the data types that I will be using in this example.</p> <p>Let's assume that we have an <code>Object</code> of type <code>Element</code> in our app:</p> <div class="code-block"><pre class="d"><code>interface Element {
  id: string;
  title: string;
  description: string;
}
</code></pre></div> <p>In our reducer we want to be able to <code>set</code> , <code>update</code>, <code>clone</code>, and, finally, <code>clear</code> the element. </p> <p>We use a <code>enum</code> to define the action we want to perform:</p> <div class="code-block"><pre class="d"><code>enum ACTIONS {
  setElement = 1,
  updateElement = 2,
  clearElement = 3,
  clone = 4,
}
</code></pre></div> <p>These actions will be the <code>case</code> to evaluate in our <code>switch</code> statement. Using a <code>enum</code> to map the <code>case</code>s we need to evaluate is crucial to make this whole solution work.</p> <p>Now, to make things a little tricker, let's assume that we do not always want to pass a payload to our reducer. For example, we might want to clear the element, but we don't want to pass a payload for that.</p> <p>Let's first define a <a href="https://www.typescriptlang.org/docs/handbook/unions-and-intersections.html">union type</a> of the <code>enum</code> values that do not require a payload:</p> <div class="code-block"><pre class="d"><code>type ActionsWithoutPayload = ACTIONS.clearElement | ACTIONS.clone;
</code></pre></div> <p>Now we can divide our <code>ACTIONS</code> in two different <code>interface</code>s, one for actions that require a payload, and one for actions that do not:</p> <div class="code-block"><pre class="d"><code>interface ActionWithoutPayload {
  type: ActionsWithoutPayload;
}

interface ActionWithPayload&lt;T extends ACTIONS&gt; {
  type: T;
  payload: ActionsPayloads[T];
}
</code></pre></div> <p>Note that <code>ActionWithPayload</code> is a generic interface that requires one type parameter, which is the <code>enum</code> we defined above.</p> <p><code>ActionWithPayload</code> has also a prop <code>payload</code>, which is the payload of the action. In this case we refer to the interface <code>ActionsPayloads</code>, which we can define as follows:</p> <div class="code-block"><pre class="d"><code>interface ActionsPayloads {
  [ACTIONS.setElement]: Element;
  [ACTIONS.updateElement]: Pick&lt;Element, 'title' | 'description'&gt;;
  [ACTIONS.clearElement]: never;
  [ACTIONS.clone]: never;
}
</code></pre></div> <p>Note that we include all <code>enum</code>s in <code>ActionsPayloads</code>, even those that do not have a payload. That is because, otherwise, we could not map <code>ActionsPayload</code> with the <code>enum ACTIONS</code> as we do in the <code>ActionWithPayload</code> interface (<code>payload: ActionsPayloads[T]</code>).</p> <p>Finally, we can define the <code>Action</code> interface as follows:</p> <div class="code-block"><pre class="d"><code>type Action&lt;T extends ACTIONS&gt; = T extends ActionsWithoutPayload
  ? ActionWithoutPayload
  : ActionWithPayload&lt;T&gt;;
</code></pre></div> <h2 id="usingthetypeactioninaswitchstatement">Using the type <code>Action</code> in a switch statement</h2> <p>Having defined our types, we can now use them in our <code>switch</code> statement.</p> <p>Let's first define the <code>state</code> we want to use in our <code>switch</code> statement. This is not strictly necessary for our example, but it makes it easier to understand what is happening:</p> <div class="code-block"><pre class="d"><code>interface IFormState {
  element: Element | null;
}
</code></pre></div> <p>Now let's put it all together:</p> <div class="code-block"><pre class="d"><code>export const formReducer = (state: IFormState = { element: null }, action: Action&lt;ACTIONS&gt;): IFormState =&gt; {
  switch (action.type) {
    case ACTIONS.setElement:
      return { element: action.payload }; // TypeScript infers that `action.payload` is of type `Element`
    case ACTIONS.updateElement:
      return { element: { ...state.element, ...action.payload } }; // TypeScript infers that `action.payload` is of type `Pick&lt;Element, 'title' | 'description'&gt;`
    case ACTIONS.clone:
      return { element: { ...state.element } };
    case ACTIONS.clearElement:
      console.log(action); // Typescript knows that `action` is of type `ActionWithoutPayload`
      return { element: null };
    default:
      return state;
  }
};
</code></pre></div> <p>And that's pretty much it.</p> <p>Some screenshots of the code in action:</p> <p>Setting the element:</p> <p><img src="/assets/images/blog/switch-with-types/2020-02-01_setElement-example.png" alt="Set Element"></p> <p>Updating the element:</p> <p><img src="/assets/images/blog/switch-with-types/2020-02-01_updateElement-example.png" alt="Update Element"></p> <p>Clearing the element:</p> <p><img src="/assets/images/blog/switch-with-types/2020-02-01_clearElement-example.png" alt="Clear Element"></p> <p>As mentioned above, you can also check out the code in action in the <a href="https://stackblitz.com/edit/switch-with-types?file=switch.ts"><code>SwitchWithTypes</code> <em>StackBiz</em> project</a>, with live type checking.</p> <h2 id="conclusion">Conclusion</h2> <p>Using a <code>switch</code> statement with <code>enum</code>s and <code>interface</code>s as shown above is a great way to make your code more readable and maintainable. </p> <p>We could of course simply cast the type. However, that is more manual work for us, and it is error-prone. Having TypeScript automatically infer the types in our <code>switch</code> statements is a much better way to ensure type consistency.</p> <p>If you want to dig more into live examples, you can always check the <a href="https://anita-app.com/">Anita</a> <a href="https://github.com/anita-app/anita">code repository</a>, and in particular the folder with the <a href="https://github.com/anita-app/anita/tree/main/app/src/app/libs/redux">Redux related files</a>, or you can check out the <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html">TypeScript documentation</a>.</p> </article> </div> </div> </section> <footer class="relative bg-gray-300 pt-8 pb-6"> <div class="bottom-auto top-0 left-0 right-0 w-full absolute pointer-events-none overflow-hidden -mt-20" style="height:80px;transform:translateZ(0)"> <svg class="absolute bottom-0 overflow-hidden" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" version="1.1" viewBox="0 0 2560 100" x="0" y="0"> <polygon class="text-gray-300 fill-current" points="2560 0 2560 100 0 100"></polygon> </svg> </div> <div class="container mx-auto px-4"> <div class="flex flex-wrap items-center md:justify-left justify-left"> <div class="w-6/12 md:w-4/12"> <button class="bg-white text-gray-900 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2" onclick='window.open("https://github.com/anita-app/anita","_blank")'> <ion-icon name="logo-github" class="mt-1" style="width:1.5em;height:1.5em"></ion-icon> </button> </div> <div class="w-6/12 md:w-4/12 text-right md:text-center py-1"> <div class="flex justify-center text-sm text-gray-600 font-semibold"> Developed with <ion-icon name="heart-outline" class="text-red-800 self-end ml-1 mr-1" style="width:1.2em;height:1.2em"></ion-icon> by humans & <a href="https://copilot.github.com/" target="_blank" class="ml-1"><u>GitHub Copilot</u></a>, </div> <div class="text-sm text-gray-600 font-semibold"> made possible by <a href="/licenses.html"><u>open source</u></a>. </div> </div> </div> </div> <script src="/assets/js/main-0-14-14.min.js"></script> <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script> <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script> <script data-goatcounter="https://anita.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </footer> </body> </html>