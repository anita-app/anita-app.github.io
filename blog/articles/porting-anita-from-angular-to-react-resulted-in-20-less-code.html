<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="application-name" content="Anita"> <meta name="msapplication-TileColor" content="#002346"> <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon/favicon-16x16.png"> <link rel="manifest" href="/assets/icons/favicon/site.webmanifest"> <link rel="mask-icon" href="/assets/icons/favicon/safari-pinned-tab.svg" color="#5bbad5"> <link rel="shortcut icon" href="/assets/icons/favicon/favicon.ico"> <meta name="msapplication-TileColor" content="#da532c"> <meta name="msapplication-config" content="/assets/icons/favicon/browserconfig.xml"> <meta name="theme-color" content="#002346"> <link rel="stylesheet" href="/assets/css/styles-0-14-19.min.css"> <title>Porting Anita from Angular to React resulted in 20% less code</title> <meta name="description" content="How to port a complex Angular Progressive Web App, with offline capabilities and NgRx to React, step by step guide"> </head> <body class="text-gray-800 antialiased flex flex-col h-screen justify-between"> <nav class="top-0 absolute z-50 w-full flex flex-wrap items-center justify-between py-3 navbar-expand-lg bg-gradient-to-r from-prussian-blue-400 to-prussian-blue-700"> <div class="container px-4 mx-auto flex flex-wrap items-center justify-between z-50"> <div class="w-full relative flex justify-between lg:w-auto lg:static lg:block lg:justify-start"> <div class="flex-grow relative flex items-center lg:w-auto lg:static"> <a class="text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"> <img src="/assets/logo/logo_square.svg" style="height:35px;width:auto" alt="Anita"> </a> <a class="text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"> Anita </a> </div> <button class="cursor-pointer text-xl leading-none px-3 py-1 border border-solid border-transparent rounded bg-transparent block lg:hidden outline-none focus:outline-none" type="button" onclick='toggleNavbar("main-collapse-navbar")'> <ion-icon name="menu-outline" class="text-white" style="width:1.5em;height:1.5em"></ion-icon> </button> </div> <div class="lg:flex flex-grow items-center bg-white lg:bg-transparent lg:shadow-none hidden" id="main-collapse-navbar"> <ul class="flex flex-col lg:flex-row list-none lg:ml-auto"> <li class="flex items-center"> <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold" href="/blog"> Blog </a> </li> <li class="flex items-center"> <a class="lg:text-white lg:hover:text-gray-300 text-gray-800 px-3 py-4 lg:py-2 flex items-center text-xs uppercase font-bold" href="https://github.com/anita-app/anita"> <span class="inline-block mr-2">Source Code</span> <ion-icon name="logo-github" class="lg:text-gray-300 text-gray-500" style="width:1.5em;height:1.5em"></ion-icon> </a> </li> </ul> </div> </div> </nav> <section class="relative"> <div class="mx-auto pb-20 mt-36 mb-36"> <div class="w-full lg:w-7/12 ml-auto mr-auto p-10 border-1 rounded-md shadow-md"> <article> <div class="pt-2 pb-1 text-justify pr-5 border-b rounded-t"> <h1 class="m-0 font-light">Porting Anita from Angular to React resulted in 20% less code</h1> </div> <p class="text-sm text-gray-500 mb-8 mt-1">Published on 2021/11/10 by ilDon </p> <p>I started developing Anita in Angular because I had previously developed with it a form generator that could power the core parts of the app. Having years of experience also with React, though, I soon realized that Angular was slowing me down. So I decided to port Anita from Angular to React.</p> <p>The whole project took under 10 days, in which I worked on it only in my spare time. I can easily say that it was well worth it as the code base, with the exact same functionalities, is now <strong>20% smaller</strong>.</p> <p>Let's see some stats, generated with <a href="https://marketplace.visualstudio.com/items?itemName=uctakeoff.vscode-counter">VS Code Counter</a>.</p> <p>The Angular code base was:</p> <table> <thead> <tr> <th style="text-align:left">language</th> <th style="text-align:right">files</th> <th style="text-align:right">code</th> <th style="text-align:right">comments</th> </tr> </thead> <tbody> <tr> <td style="text-align:left">TypeScript</td> <td style="text-align:right">176</td> <td style="text-align:right">5,433</td> <td style="text-align:right">1,583</td> </tr> <tr> <td style="text-align:left">Templates</td> <td style="text-align:right">38</td> <td style="text-align:right">566</td> <td style="text-align:right">0</td> </tr> <tr> <td style="text-align:left">SCSS</td> <td style="text-align:right">18</td> <td style="text-align:right">698</td> <td style="text-align:right">110</td> </tr> </tbody> </table> <p>Excluding SCSS, the total lines of code of the Angular app, including the templates, was 5.999. I'm counting the templates as code because Angular adheres to the MVVM (Model, View, View Controller) pattern, which means that the templates are compiled into the JavaScript code. In short, in Angular, a template is a chunk of HTML with a special syntax to support some Angular features, like for loops (<a href="https://angular.io/guide/template-syntax">see the docs</a>).</p> <p>The React code base is:</p> <table> <thead> <tr> <th style="text-align:left">language</th> <th style="text-align:right">files</th> <th style="text-align:right">code</th> <th style="text-align:right">comments</th> </tr> </thead> <tbody> <tr> <td style="text-align:left">TypeScript</td> <td style="text-align:right">111</td> <td style="text-align:right">3,149</td> <td style="text-align:right">1,448</td> </tr> <tr> <td style="text-align:left">TypeScript React</td> <td style="text-align:right">56</td> <td style="text-align:right">1,767</td> <td style="text-align:right">31</td> </tr> <tr> <td style="text-align:left">CSS</td> <td style="text-align:right">1</td> <td style="text-align:right">16</td> <td style="text-align:right">3</td> </tr> </tbody> </table> <p>So, the total lines of code of the React app, including the templates, is 4.916.</p> <p>Let's run the math:</p> <ul> <li><p>Angular total: 5.999</p></li> <li><p>React total: 4.916</p></li> <li><p>Difference: -1.083 (-19.8443%)</p></li> </ul> <p>This is a huge improvement. This reduction is even more significant if we consider that in the Angular app we were using a UI library called <a href="https://akveo.github.io/nebular/">Nebular</a>, while in React the whole UI is custom-built with <a href="https://tailwindcss.com/">TailwindCSS</a>. So in React we have a lot more DOM elements (<code>-&gt;</code> lines of code) to render elements that in Angular were a 1 line import.</p> <p>While your mileage may vary, the above results are significant because both code bases have been entirely written by the same individual developer. So the design choices and the styling are very similar. I believe that this result represents very well the difference between Angular and React. The Angular code base is bigger, and it's more complex, as we will see shortly. The React code base is smaller, and it's also simpler. </p> <h2 id="gettingstarted">Getting started</h2> <p>The quickest and easiest path for porting Anita is to start with a fresh new React app with <a href="https://reactjs.org/docs/create-a-new-react-app.html"><code>create-react-app</code></a>.</p> <p>Since we want to keep the offline capabilities of the Angular app, and we want to use TypeScript, the command to create the React app is:</p> <div class="code-block"><pre class="d"><code>npx create-react-app anita-react --template cra-template-pwa-typescript
</code></pre></div> <p>Let's run <code>yarn start</code> to check that everything works as expected: </p> <p><img src="/assets/images/blog/porting/2021-11-10_app_initialized.png" alt="React app initialized"></p> <p>The only drawback of <code>create-react-app</code> is that it adds a lot of starter stuff to the project. Let's remove it.</p> <p>We don't need the <code>App</code> component, and its related files, and we can also clean up <code>index.tsx</code>:</p> <div class="code-block"><pre class="d"><code>    import React from 'react';
    import ReactDOM from 'react-dom';
    import './index.css';
    import * as serviceWorkerRegistration from './serviceWorkerRegistration';

    ReactDOM.render(
      &lt;React.StrictMode&gt;
        "Hello World"
      &lt;/React.StrictMode&gt;,
      document.getElementById('root')
    );

    serviceWorkerRegistration.register();
</code></pre></div> <p>Deleted files:</p> <ul> <li>App.csss</li> <li>App.test.tsx</li> <li>App.tsx</li> </ul> <p>In an Angular project all static files are normally in the <code>app/src/assets</code> folder. In React the <code>assets</code> folder is normally placed in the public folder. Let's move <code>assets</code> there. This fells already like an improvement over Angular. Keeping the <code>assets</code> folder in <code>src</code> is counterintuitive, as it doesn't contain source files, but rather static files ready to be served to the users.</p> <p>Now we can update <code>index.html</code> and <code>manifest.json</code> in <code>public</code>, add Anita icons, title, and description. We can also remove the starter files left there by <code>create-react-app</code>:</p> <ul> <li>public/favicon.ico</li> <li>public/logo192.png</li> <li>public/logo512.png</li> </ul> <p>Now let's move to the code base.</p> <h2 id="absoluteimports">Absolute imports</h2> <p>In the Angular project of Anita, we use absolute paths to simplify imports, with a custom prefix <code>@anita/client</code>. </p> <p>For example, we use this statement: <code>import { MyModule } from '@anita/client/my.module'</code>, instead of <code>import { AppModule } from '../../../my.module'</code>.</p> <p>This is achieved by properly configuring the <code>paths</code> in <code>tsconfig.json</code>.</p> <div class="code-block"><pre class="d"><code>"CompilerOptions": {
    ...
    "paths": {
      "@anita/client/*": [
        "src/app/*"
      ]
    }
    ...
}
</code></pre></div> <p>The advantage of this import method when developing Angular apps is that we avoid <em>import hell</em>. When the code base starts to grow, with relative imports very long paths to navigate up and down the code base start to show up. For example <code>../../../../../my.module.ts</code> is a long path to navigate the code base. <code>@anita/client/my.module</code> is certainly shorter and more readable. </p> <p>In addition, absolute paths to a given file are always identical, no matter were they are in the tree structure of the project, as they are relative to the root of the code base.</p> <p>In the process of porting all code to React, this import strategy comes in very handy as we can move all code to the new project, and use <code>replace all</code> to update all imports at once.</p> <p>To do so we must use absolute paths also in the React app.</p> <p>In React, we cannot use <code>paths</code> in <code>tsconfig.json</code>. We can however use <code>baseUrl</code>, which allows us to import files with absolute paths from the specified base path. In our case we chose the <code>src</code> folder:</p> <div class="code-block"><pre class="d"><code>"CompilerOptions": {
    ...
    "baseUrl": "src"
    ...
}
</code></pre></div> <p>With this configuration, we can import files with absolute paths from the root of the code base. So <code>./src/app/app.component</code> becomes <code>app/app.component</code>.</p> <p>In this way, when porting the code we can simply replace all occurrences of <code>@anita/client</code> with <code>app</code>, and all imports will work as they are, as long as we keep the same folder hierarchy. </p> <p>So let's move on to the project structure.</p> <h2 id="projectstructure">Project structure</h2> <p>To ease the transition from Angular to React, we keep a similar folder hierarchy. This will come in handy when we move all the code that can be simply dropped in the React project as is. </p> <p>The structure of the Angular app was:</p> <ul> <li><code>src/app/</code><ul> <li><code>data</code>: contains the data models</li> <li><code>libs</code>: contains the libraries that are not Angular specific</li> <li><code>ng-services</code>: contains Angular Services</li> <li><code>ui</code>: contains the Angular UI elements, plus some Angular Services and Pipes needed for the UI </li></ul></li> </ul> <p>In React we can have an even simpler structure:</p> <ul> <li><code>src/app/</code><ul> <li><code>anita-routes</code>: contains the routes of the app. We can place them here as they are no longer an Angular Service.</li> <li><code>data</code>: contains the same data models of the Angular app</li> <li><code>libs</code>: contains the libraries that were already used in the Angular app, and that can be ported to React as they are or with minimal changes</li> <li><code>ui-react-components</code>: contains the React components</li></ul></li> </ul> <h2 id="settinguptheuifromnebulartotailwindcss">Setting up the UI: from Nebular to TailwindCSS</h2> <p>As I mentioned, for building the UI of the Angular version of Anita I used <a href="https://akveo.github.io/nebular/">Nebular</a> «<em>a customizable Angular UI library</em>». Nebular has been great for its purpose, but it's only for Angular, and for React would be an overkill.</p> <p>For a project like Anita I believe that <a href="https://tailwindcss.com/">TaliwindCSS</a> is a much better alternative. As advertised on their landing page, TailwindCSS is «<em>a utility-first CSS framework packed with classes like flex, pt-4, text-center and rotate-90 that can be composed to build any design, directly in your markup</em>». If you build UIs, and you've never tried it, you should really give it a try. It's the most versatile UI framework you'll find. </p> <p>Installing TailwindCSS for React is extremely easy thanks to the well outlined guide in the official docs of Tailwind, you can check them out <a href="https://tailwindcss.com/docs/guides/create-react-app">here</a>.</p> <p>We already use TailwindCSS for the landing page of Anita, so we can share in the app the same styles as the landing page. Basically all we need to do is to define the project colors in <code>tailwind.config.js</code>:</p> <div class="code-block"><pre class="d"><code>const colors = require('tailwindcss/colors')

module.exports = {
  // Purges the final stylesheet of unused/un-optimized selectors, keeping only what is used in the app.
  purge: ['./src/**/*.{js,jsx,ts,tsx}', './public/index.html'],
  darkMode: false,
  theme: {
    colors: {
      transparent: 'transparent',
      current: 'currentColor',
      black: colors.black,
      white: colors.white,
      rose: colors.rose,
      pink: colors.pink,
      fuchsia: colors.fuchsia,
      purple: colors.purple,
      violet: colors.violet,
      indigo: colors.indigo,
      blue: colors.blue,
      'prussian-blue': {
        DEFAULT: '#002346',
        '50': '#2D96FF',
        '100': '#1389FF',
        '200': '#006FDF',
        '300': '#0056AC',
        '400': '#003C79',
        '500': '#002346',
        '600': '#002346',
        '700': '#000f20',
        '800': '#000e1f',
        '900': '#000d1b'
      },
      sky: colors.sky,
      cyan: colors.cyan,
      teal: colors.teal,
      emerald: colors.emerald,
      green: colors.green,
      lime: colors.lime,
      yellow: colors.yellow,
      amber: colors.amber,
      orange: colors.orange,
      red: colors.red,
      warmGray: colors.warmGray,
      trueGray: colors.trueGray,
      gray: colors.gray,
      coolGray: colors.coolGray,
      blueGray: colors.blueGray
    }
  },
  variants: {
    extend: {},
  },
  plugins: [
    require('@tailwindcss/forms')
  ],
}
</code></pre></div> <p>Now lets' create some layouts with TailwindCSS. Because we will have an admin panel as our main view, we can start from there.</p> <p>Let's implement a very basic admin panel in <code>index.tsx</code>:</p> <div class="code-block"><pre class="d"><code>ReactDOM.render(
  &lt;React.StrictMode&gt;
    &lt;div className="bg-prussian-blue-400 text-gray-100 flex justify-between"&gt;
      &lt;div className="flex-grow relative flex items-center lg:w-auto lg:static pl-5"&gt;
        &lt;a className="text-lg font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"&gt;
          &lt;img src="/assets/logo/logo_square.svg" style={{ height: '30px', width: 'auto' }} alt="Anita" /&gt;
        &lt;/a&gt;
        &lt;a className="text-md font-bold leading-relaxed inline-block mr-4 py-2 whitespace-no-wrap uppercase text-white" href="/"&gt;
          Anita
        &lt;/a&gt;
      &lt;/div&gt;

      &lt;button className="mobile-menu-button p-4 focus:outline-none focus:bg-gray-700"&gt;
        &lt;svg className="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;
          &lt;path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /&gt;
        &lt;/svg&gt;
      &lt;/button&gt;
    &lt;/div&gt;
    &lt;div className="relative min-h-screen md:flex"&gt;


      &lt;div className="sidebar bg-gray-200 text-prussian-blue-500 w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition duration-200 ease-in-out"&gt;
        &lt;nav&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 1
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 2
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 3
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 4
          &lt;/a&gt;
        &lt;/nav&gt;
      &lt;/div&gt;

      &lt;div className="flex-1 p-10"&gt;
        Content
      &lt;/div&gt;

    &lt;/div&gt;
  &lt;/React.StrictMode&gt;,
  document.getElementById('root')
);
</code></pre></div> <p>Lets' test if TailwindCSS works and how our initial layout works:</p> <p><img src="/assets/images/blog/porting/2021-11-10_tailwind.png" alt="Tailwind initialized"></p> <p>Good enough for now. Let's add some components to improve the layout.</p> <p>We can divide the layout in three sections:</p> <ul> <li><code>Header</code></li> <li><code>Sidebar</code></li> <li><code>Content</code></li> </ul> <p>Each of these is a React component imported into a container component called <code>AdminLayout</code>:</p> <div class="code-block"><pre class="d"><code>export const AdminLayout = () =&gt; (
  &lt;div&gt;
    &lt;Header /&gt;

    &lt;div className="relative admin-container md:flex"&gt;

      &lt;Sidebar&gt;
        &lt;nav&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 1
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 2
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 3
          &lt;/a&gt;
          &lt;a href="https://anita-app.com" className="block py-2.5 px-4 rounded transition duration-200 hover:bg-prussian-blue-600 hover:text-white"&gt;
            Menu item 4
          &lt;/a&gt;
        &lt;/nav&gt;
      &lt;/Sidebar&gt;

      &lt;Content&gt;
        Hello world!&lt;br /&gt;
      &lt;/Content&gt;

    &lt;/div&gt;
  &lt;/div&gt;
);
</code></pre></div> <p>For now, we keep the placeholder text, we will add the actual content later. We will also take care of implementing the open/close functionality for the sidebar later. First we take care of state management.</p> <h2 id="portingstatemanagementfromngrxtoredux">Porting state management from NgRx to Redux</h2> <p>In the Angular version of Anita we used <a href="https://ngrx.io/"><code>NgRx</code></a>, which «<em>provides reactive state management for Angular apps inspired by <a href="https://redux.js.org/"><code>Redux</code></a></em>». As a matter of fact I decided to use NgRx precisely because it is very similar to Redux.</p> <p>This is very convenient when porting Anita from Angular to React. As we move the code to React we can easily change the calls to the store of <code>NgRx</code> to the one of <code>Redux</code>, and everything will "just work". Normally this wouldn't be easily achievable because <code>NgRx</code> in Angular is loaded as a <a href="https://angular.io/guide/singleton-services">singleton Service</a>. Singleton Services must be initialized by Angular and therefore their instances are only available inside Angular elements, such as Services and Components. </p> <p>Thanks to a dirty trick I've been using for years, we can get around this problem. We can initialize the store of <code>NgRx</code> in a custom Service, and pass a reference to the initialized store to a constant that can be imported anywhere in the Angular app.</p> <p>Angular Services must be initialized in classes with the <code>@Injectable</code> decorator, like so:</p> <div class="code-block"><pre class="d"><code>export const stateData = {
  ngRxStore: undefined
};

@Injectable({
  providedIn: 'root'
})
export class StateDataService {

  constructor(
    private store: Store&lt;ReducerTypes&gt;
  ) {
    this.initRedux();
  }

  // This is the "dirty" trick
  public initRedux(): void {
    stateData.ngRxStore = this.store;
  }

}
</code></pre></div> <p>There are two things to note here:</p> <ul> <li><code>private store: Store&lt;ReducerTypes&gt;</code> initalizes <code>NgRx</code> according to the logic governing <a href="https://angular.io/guide/singleton-services">Angular singleton Services</a></li> <li><code>stateData</code> is an Object on which we set the initialized store or <code>NgRx</code>.</li> </ul> <p>In JavaScript using <code>=</code> to assign an <code>Object</code> to another variable does not create a new <code>Object</code>. The <code>=</code> operator assigns to the variable a reference to the <code>Object</code> already in memory. This is why we use <code>stateData.ngRxStore = this.store</code>. We assign the store to <code>stateData.ngRxStore</code>. And because that is a mere reference to the original <code>Object</code>, accessing the properties of <code>stateData.ngRxStore</code>, such as <code>dispatch</code>, actually means accessing the Singleton Service of <code>NgRx</code> initialized by Angular.</p> <p>Now we can import <code>stateData</code> in any file and use it to access the store without having to initialize it. We can access the store from anywhere in the app without the need to Inject the <code>NgRx</code> Store in the constructor. Doing so we can keep most of the code as vanilla TypeScript/JavaScript and not as Angular Services. This is way most of the code of the Angular version of Anita was in the <code>libs</code> folder, and not in the <code>ng-services</code> one.</p> <p>This trick has proven to be quite useful in the past, and also in this case it is very convenient as we can transfer all non-angular code to React. All we need to do in the React app is to import the Redux <code>store</code> and replace <code>stateData.ngRxStore</code> with store. For example, in the <code>CurrentProjectSetter</code> class in <code>src/app/libs/project-helpers/project-handlers</code> we can now use <code>store.dispatch</code> instead of <code>stateData.ngRxStore.dispatch</code>. The rest of the code remains the same.</p> <p>To do so, however, we must first initialize Redux in the React app. Let's start by adding <code>redux</code> and <code>react-redux</code> to the React project:</p> <div class="code-block"><pre class="d"><code>yarn add react-redux redux 
</code></pre></div> <p>And the types:</p> <div class="code-block"><pre class="d"><code>yarn add @types/react-redux --dev
</code></pre></div> <p>Converting <code>NgRx</code> reducers to <code>Redux</code> reducers is quite straightforward. Given the following <code>NgRx</code> reducer:</p> <div class="code-block"><pre class="d"><code>const projectState: SystemData = undefined;

const _projectReducer = createReducer(projectState,
  on(REDUCER_ACTIONS.setCurrentProject, (state, data) =&gt; {
    return data.payload;
  })
);

export function projectReducer(state: SystemData, action: typeof REDUCER_ACTIONS.setCurrentProject): any {
  return _projectReducer(state, action);
}
</code></pre></div> <p>In React, we have the following:</p> <div class="code-block"><pre class="d"><code>const projectState: SystemData = undefined;

export const projectReducer = (state: SystemData = projectState, action: Action&lt;REDUX_ACTIONS&gt;): SystemData =&gt; {
  switch (action.type) {
    case REDUX_ACTIONS.setCurrentProject:
      return action.payload
    default:
      return state;
  }
}
</code></pre></div> <p>After porting all the reducers, we can create our <code>react-redux</code> store:</p> <div class="code-block"><pre class="d"><code>const REDUCERS = {
  project: projectReducer,
  projects: projectsReducer,
  sectionsForChildOfSelector: sectionsForChildOfSelectorReducer
};

const combinedReducers = combineReducers(REDUCERS)

export const store = createStore(combinedReducers);
</code></pre></div> <p>Now, after <a href="https://react-redux.js.org/api/provider">providing the store as described in the docs</a>, we can reference the exported const <code>store</code> in our React app.</p> <h2 id="routing">Routing</h2> <p>In Angular, we use <a href="https://angular.io/api/router"><code>@angular/router</code></a> to handle routing:</p> <div class="code-block"><pre class="d"><code>export const routes: Routes = [

  { path: 'private', redirectTo: 'private/projects/list', pathMatch: 'full' },
  { path: 'private', children:
      [
          {
            path: '', component: AdminComponent, children: [

              { path: 'projects', redirectTo: 'projects/list', pathMatch: 'full' },
              { path: 'projects', children: [
                  { path: 'list', component: ProjectsListComponent, canActivate: [ProjectsGuardService] },
                  ...
                ] 
              },
              { path: 'project', redirectTo: 'projects/list', pathMatch: 'full' },
              { path: 'project', canActivate: [ProjectGuardService], children: [
                  { path: '', redirectTo: 'projects/list', pathMatch: 'full' },
                  { path: `:${URL_PARAMS.projectId}`, redirectTo: ':projectId/info', pathMatch: 'full' },
                  { path: `:${URL_PARAMS.projectId}/info`, component: ProjectInfoComponent },
                  ...
                ]
              }
            ]
          }
      ]
  },

  { path: '', redirectTo: 'private/projects/list', pathMatch: 'full' },

  { path: '**', redirectTo: 'private/projects/list', pathMatch: 'full' }

];
</code></pre></div> <p>In React, we use <a href="https://reactrouter.com/"><code>react-router</code></a> to handle routing. React Router is <a href="https://openbase.com/categories/js/best-react-routing-libraries">by far the most popular routing library at this moment</a>, and we don't want to be exotic with our router choice.</p> <p>First, we need to install <code>react-router</code>. </p> <div class="code-block"><pre class="d"><code>yarn add react-router-dom
</code></pre></div> <p>Since Anita is hosted on GitHub Pages, we need to use <code>HashRouter</code> instead of <code>BrowserRouter</code>. In this way the routes of the app are prefixed with the <code>#</code> symbol. To know more about this, check out my previous post on <a href="https://anita-app.com/blog/articles/the-journey-of-anita-to-the-ultimate-bootstrapping-thanks-to-git-hub-pages.html#handlingurlsofpwashostedongithubpages">handling URLs of PWAs hosted on GitHub Pages</a>, and the <a href="https://reacttraining.com/react-router/web/guides/quick-start">React Router docs</a>.</p> <p>Since all views are rendered in the same place, the content area of the <code>AdminLayout</code> component is the place where we render the router.</p> <p>To keep things readable, all routes are defined in a separate React component <code>AnitaRoutes</code>.</p> <div class="code-block"><pre class="d"><code>import { HashRouter as Router } from 'react-router-dom';

export const AdminLayout = () =&gt; (
  &lt;Router&gt;
    &lt;Header /&gt;
    &lt;div className="relative admin-container flex"&gt;
      &lt;Sidebar&gt;
        &lt;SidebarMenu /&gt;
      &lt;/Sidebar&gt;
      &lt;Content&gt;
        &lt;AnitaRoutes /&gt;
      &lt;/Content&gt;
    &lt;/div&gt;
  &lt;/Router&gt;
);
</code></pre></div> <p>In <code>AnitaRoutes</code> we define all the routes:</p> <div class="code-block"><pre class="d"><code>import { Navigate, Route, Routes } from 'react-router-dom';

export const AnitaRoutes = () =&gt; (
  &lt;Routes&gt;
    &lt;Route path={ANITA_URLS.projectsList} element={&lt;ProjectsList /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectAdd} element={&lt;AddEditProject /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectEdit} element={&lt;AddEditProject /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectsNone} element={&lt;ProjectsNone /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectDetails} element={&lt;ProjectDetails /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectSectionElesList} element={&lt;SectionElementsList /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectSectionEleDetails} element={&lt;SectionElementDetails /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectSectionAddEle} element={&lt;AddEditSectionElement /&gt;} /&gt;
    &lt;Route path={ANITA_URLS.projectSectionEditEle} element={&lt;AddEditSectionElement /&gt;} /&gt;
    &lt;Route path="*" element={&lt;Navigate to={ANITA_URLS.projectsList} /&gt;}
    /&gt;
  &lt;/Routes&gt;
)
</code></pre></div> <p>Notice how all routes are defined in the <code>ANITA_URLS</code> constant. This is because we want to keep the code as clean as possible, and we want to keep the routes as simple as possible.</p> <div class="code-block"><pre class="d"><code>export const ANITA_URLS = {
// PROJECTS
projectsNone: '/projects/none',
projectsList: '/projects/list',
projectAdd: `/projects/${EDITOR_MODE.add}`,
projectEdit: `/projects/${EDITOR_MODE.edit}/:${URL_PARAMS.projectId}`,
// PROJECT
projectDetails: `/project/:${URL_PARAMS.projectId}/info`,
projectSectionElesList: `/project/:${URL_PARAMS.projectId}/list/:${URL_PARAMS.sectionId}`,
projectSectionAddEle: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/${EDITOR_MODE.add}`,
projectSectionEditEle: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/${EDITOR_MODE.edit}/:${URL_PARAMS.elementId}`,
projectSectionEleDetails: `/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/details/:${URL_PARAMS.elementId}`,
</code></pre></div> <p>}</p> <p>As you can see, some portions of the routes are defined by other constants, <code>URL_PARAMS</code> and <code>EDITOR_MODE</code>. In this way we avoid typos, and we ensure that routes are consistent throughout the app.</p> <p>These two constants are pretty simple:</p> <div class="code-block"><pre class="d"><code>export const URL_PARAMS = {
  projectId: 'projectId',
  sectionId: 'sectionId',
  elementId: 'elementId',
  parentId = 'parentId'
}

export const EDITOR_MODE = {
  add: 'add',
  edit: 'edit',
}
</code></pre></div> <p>So, for example, the route <code>projectSectionEditEle</code>:</p> <div class="code-block"><pre class="d"><code>/project/:${URL_PARAMS.projectId}/:${URL_PARAMS.sectionId}/${EDITOR_MODE.edit}/:${URL_PARAMS.elementId}
</code></pre></div> <p>translates to:</p> <div class="code-block"><pre class="d"><code>/project/:projectId/:sectionId/edit/:elementId
</code></pre></div> <p>Now we only need a way to generate the links to the routes. We can do that with a function that fills all <code>params</code> expected by a route. Given a URL, and an array of <code>params</code> and values, the function should automatically fill all <code>params</code> needed to properly generate the final URL:</p> <div class="code-block"><pre class="d"><code>export function urlParamFiller(url: string, paramsToFill: Array&lt;{ name: URL_PARAMS; value: string }&gt;): string {

  let result = url;

  paramsToFill.forEach(params =&gt; { 
    result = result.replace(new RegExp(`:${params.name}`, 'g'), params.value) }
  );

  return result;

}
</code></pre></div> <p>We don't need to worry about the order of the <code>params</code>, because the <code>urlParamFiller</code> function will replace all occurrences of the <code>params</code> in the route.</p> <p>This function is used to generate the links to the routes, for example to generate the link to the details' page of a project:</p> <div class="code-block"><pre class="d"><code>&lt;Link 
  to={urlParamFiller(ANITA_URLS.projectDetails, [{ name: URL_PARAMS.projectId, value: project.id }])} 
  className="px-4 py-3 text-white inline-flex items-center leading-none text-sm bg-prussian-blue-400 hover:bg-prussian-blue-500 rounded"
  &gt;
  &lt;i className="bi-info-circle mr-2"&gt;&lt;/i&gt;Project details
&lt;/Link&gt;
</code></pre></div> <p>This is a great example of one of the many ways in which React is much easier to use compared to Angular. Our routes are mere strings concatenated with constants that we use to generate the links. To avoid human mistakes, we use the <code>urlParamFiller</code> function to fill the route with its expected <code>params</code>. We don't need to specify a hierarchy of routes, although we could if we wanted with <a href="https://reactrouter.com/docs/en/v6/getting-started/overview#nested-routes">nested routes</a>. We can simply use concatenated string, delegate to <code>urlParamFiller</code> the task of building our full URLs, and we will be able to navigate wherever we need to.</p> <h2 id="buildingtheui">Building the UI</h2> <p>Comparing how we build the UI in Angular and React for Anita unfortunately is not so interesting as we use very different UI libraries.</p> <p>As I have mentioned above, in Angular, we used Nebular, a UI library based on Bootstrap 4, that comes equipped with a ton of pre-made UI components. In React, we use TailwindCSS, which provides the building blocks to create beautiful UI components, but does not ship with any pre-made components. So, we need to build our own.</p> <p>In short, we need to rebuild from scratch the whole UI of Anita. </p> <p>One notable thing of the process is that in doing so we did not need to extrapolate much code from Angular components. A very important best practice that I always try to follow is to keep the UI and the code as separate as possible. When creating a new UI component, it is important to keep any logic of the app in the app's code, and not in the UI component. In Anita all such code is in the <code>src/app/libs</code> folder, both in the Angular and in the React version. In the components we import the <code>libs</code> classes and functions we need to make the app work.</p> <p>When comparing the Angular and React versions of Anita, we can also note that the Angular version is much more complex, because it has a lot more boilerplate.</p> <p>Let's look at one of the simplest components of the Angular app, the <code>AddBtnComponent</code>, which is composed of three files:</p> <ol> <li><code>add-btn.component.ts</code>: the component itself</li> <li><code>add-btn.component.html</code>: the HTML template of the component</li> <li><code>add-btn.component.scss</code>: the styles of the component (omitted)</li> </ol> <p><code>add-btn.component.ts</code>:</p> <div class="code-block"><pre class="d"><code>import ...

@Component({
  selector: 'app-add-btn',
  templateUrl: './add-btn.component.html',
  styleUrls: ['./add-btn.component.scss']
})
export class AddBtnComponent {

  @Input()
  public url: string;

  @Input()
  public icon = 'plus-outline';

  @Input()
  public element: SectionElement;

  constructor(
    private router: Router
  ) { }

  public navigate(): void {
    this.router.navigateByUrl(this.url, {
      state: { element: this.element }
    });

  }

}
</code></pre></div> <p><code>add-btn.component.html</code>:</p> <div class="code-block"><pre class="d"><code>&lt;button *ngIf="url" nbButton shape="round" status="primary" size="giant" class="position-absolute shadow" (click)="navigate()"&gt;
  &lt;nb-icon [icon]="icon"&gt;&lt;/nb-icon&gt; &lt;!-- Nebular icon element --&gt;
&lt;/button&gt;
</code></pre></div> <p>The equivalent in React is a single file of 6 lines (<code>add-edit-element-button.component.tsx</code>):</p> <div class="code-block"><pre class="d"><code>export const AddEditElementButton = ({ icon, url }) =&gt; (
    &lt;Link to={url} className="absolute bottom-5 right-7 md:bottom-7 md:right-10 bg-prussian-blue-400 text-white text-xl shadow-xl rounded-3xl h-14 w-14 flex items-center justify-center"&gt;
      &lt;i className={icon}&gt;&lt;/i&gt;
    &lt;/Link&gt;
  )
</code></pre></div> <p>Since the <a href="https://reactjs.org/docs/hooks-intro.html">introduction of Hooks in React 16.8</a>, the boilerplate is close to zero. </p> <p>I'll leave to the reader to decide what they prefer. All I can say is that the React version is quicker to write, and easier to maintain. Which, for a project like Anita, is a very good thing.</p> <h2 id="finalresult">Final result</h2> <p>Porting Anita to React has been a very fun project, that has been a great learning experience. Comparing how the same functionalities can be implemented with the two different frameworks gives a lot of perspective. I strongly believe that the result is a good one, and I hope that it will be a great help for other developers.</p> <p>And now some screenshots of the final project, which you can also try live by visiting the actual <a href="https://anita-app.com/app">Anita React app</a>:</p> <ol> <li>The initial page, without any project: </li> </ol> <p><img src="/assets/images/blog/porting/2021-11-21_final_result.png" alt="Anita React app - no projects"></p> <ol start="2"> <li>A view of an example project:</li> </ol> <p><img src="/assets/images/blog/porting/2021-11-21_final_result_with_project.png" alt="Anita React app - one project"></p> <p>For comparison, the same views in the Angular version.</p> <ol> <li>The initial page, without any project: </li> </ol> <p><img src="/assets/images/blog/porting/Anita_angular_no_projects.png" alt="Anita Angular app - no projects"></p> <ol start="2"> <li>A view of an example project:</li> </ol> <p><img src="/assets/images/blog/porting/Anita_angular_projects_list.png" alt="Anita Angular app - one project"></p> </article> </div> </div> </section> <footer class="relative bg-gray-300 pt-8 pb-6"> <div class="bottom-auto top-0 left-0 right-0 w-full absolute pointer-events-none overflow-hidden -mt-20" style="height:80px;transform:translateZ(0)"> <svg class="absolute bottom-0 overflow-hidden" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" version="1.1" viewBox="0 0 2560 100" x="0" y="0"> <polygon class="text-gray-300 fill-current" points="2560 0 2560 100 0 100"></polygon> </svg> </div> <div class="container mx-auto px-4"> <div class="flex flex-wrap items-center md:justify-left justify-left"> <div class="w-6/12 md:w-4/12"> <button class="bg-white text-gray-900 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2" onclick='window.open("https://github.com/anita-app/anita","_blank")'> <ion-icon name="logo-github" class="mt-1" style="width:1.5em;height:1.5em"></ion-icon> </button> </div> <div class="w-6/12 md:w-4/12 text-right md:text-center py-1"> <div class="flex justify-center text-sm text-gray-600 font-semibold"> Developed with <ion-icon name="heart-outline" class="text-red-800 self-end ml-1 mr-1" style="width:1.2em;height:1.2em"></ion-icon> by humans & <a href="https://copilot.github.com/" target="_blank" class="ml-1"><u>GitHub Copilot</u></a>, </div> <div class="text-sm text-gray-600 font-semibold"> made possible by <a href="/licenses.html"><u>open source</u></a>. </div> </div> </div> </div> <script src="/assets/js/main-0-14-19.min.js"></script> <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script> <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script> <script data-goatcounter="https://anita.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script> </footer> </body> </html>